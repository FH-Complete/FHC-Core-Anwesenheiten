import t from"../../../../../../index.ci.php/public/js/components/primevue/config/config.esm.min.js?2025102901";import e from"../../../../../../index.ci.php/public/js/components/primevue/toast/toast.esm.min.js?2025102901";import n from"../../../../../../index.ci.php/public/js/components/primevue/confirmdialog/confirmdialog.esm.min.js?2025102901";import i from"../../../../../../index.ci.php/public/js/components/primevue/confirmationservice/confirmationservice.esm.min.js?2025102901";import a from"../../../../../../index.ci.php/public/js/components/primevue/tabview/tabview.esm.min.js?2025102901";import s from"../../../../../../index.ci.php/public/js/components/primevue/tabpanel/tabpanel.esm.min.js?2025102901";import r from"../../../../../js/components/vueDatepicker.js.php?2025102901";const l={emits:["dataFetched"],props:{refresh:{type:Boolean},apiFunction:{required:!0,type:Function},apiFunctionParameters:{}},watch:{refresh:function(t,e){this.fetchData()}},data:function(){return{loading:!1,error:!1,errorMessage:null}},created:function(){this.fetchData()},methods:{fetchData:function(){if(this.loading=!0,this.error=!1,this.errorMessage=null,"function"==typeof this.apiFunction){let t=this.apiFunction(this.apiFunctionParameters);t instanceof Promise?t.then(this.successHandler).catch(this.errorHandler).finally(this.finallyHandler):this.setError("The called apiFunction does not return a Promise")}else this.setError("Property apiFunction is not a function")},setError:function(t){this.loading=!1,this.error=!0,this.errorMessage=t},successHandler:function(t){this.$emit("dataFetched",t?t.data:void 0)},errorHandler:function(t){t.response?.data?.retval?this.setError(t.response.data.retval):t.data?.message?this.setError(t.data.message):this.setError(t.message)},finallyHandler:function(){this.loading=!1}},template:'\n\t\t<slot v-if="loading" name="loading">\n\t\t\t<div class="fetch-loader">Loading...</div>\n\t\t</slot>\n\t\t<slot v-else-if="error" name="error" :error-message="errorMessage">\n\t\t\t<div class="fetch-error">{{ errorMessage }}</div>\n\t\t</slot>\n\t\t<slot v-else></slot>\n\t'},o="Filter Component New Filter";var d={props:{filters:{type:Array,default:[]},columns:{type:Array,default:[]},fields:{type:Array,default:[]}},emits:{switchFilter:["filterId"],applyFilterConfig:["filterFields"],saveCustomFilter:["customFilterName"]},data:function(){return{currentFields:[]}},computed:{types(){return this.columns.reduce((t,e)=>{let n=e.type.toLowerCase();return n.indexOf("int")>=0?t[e.name]="Numeric":n.indexOf("varchar")>=0||n.indexOf("text")>=0||n.indexOf("bpchar")>=0?t[e.name]="Text":n.indexOf("timestamp")>=0||n.indexOf("date")>=0?t[e.name]="Date":t[e.name]="",t},{})}},watch:{fields(t){this.currentFields=t}},methods:{switchFilter(t){this.$emit("switchFilter",t.currentTarget.value)},applyFilterConfig(){const t=this.currentFields.filter(t=>t.name!=o);t.filter(t=>""==t.condition).length?alert("Please fill all the filter options"):this.$emit("applyFilterConfig",t)},addField(t){this.currentFields.push({name:o})},removeField(t){this.currentFields.splice(t,1)}},template:'\n\t<div class="filter-config">\n\t\t<div class="card">\n\t\t\t<div class="card-body">\n\t\t\t\t<div v-if="filters.length" class="mb-4">\n\t\t\t\t\t<select class="form-select" @change="switchFilter">\n\t\t\t\t\t\t<option value="">Bitte auswählen...</option>\n\t\t\t\t\t\t<option v-for="filter in filters" :value="filter.id">\n\t\t\t\t\t\t\t{{ filter.description }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<button class="btn btn-outline-dark" type="button" @click=addField>\n\t\t\t\t\t\t<span class="fa-solid fa-plus" aria-hidden="true"></span> Neuer Filter\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="filter-config-fields my-3">\n\t\t\t\t\t<div v-for="(filterField, index) in currentFields" class="filter-config-field row">\n\n\t\t\t\t\t\t<div class="col-5">\n\t\t\t\t\t\t\t<div class="input-group">\n\t\t\t\t\t\t\t\t<span class="input-group-text">Filter {{ index + 1 }}</span>\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tclass="form-select"\n\t\t\t\t\t\t\t\t\tv-model="filterField.name"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<option value="">Feld zum Filter hinzufügen...</option>\n\t\t\t\t\t\t\t\t\t<option v-for="col in columns" :value="col.name">\n\t\t\t\t\t\t\t\t\t\t{{ col.title }}\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- Numeric --\x3e\n\t\t\t\t\t\t<template v-if="types[filterField.name] == \'Numeric\'">\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.operation">\n\t\t\t\t\t\t\t\t\t<option value="equal">Gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="nequal">Nicht gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="gt">Größer als</option>\n\t\t\t\t\t\t\t\t\t<option value="lt">Weniger als</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-3">\n\t\t\t\t\t\t\t\t<input type="number" class="form-control" v-model="filterField.condition">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\x3c!-- Text --\x3e\n\t\t\t\t\t\t<template v-if="types[filterField.name] == \'Text\'">\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.operation">\n\t\t\t\t\t\t\t\t\t<option value="equal">Gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="nequal">Nicht gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="contains">Enthält</option>\n\t\t\t\t\t\t\t\t\t<option value="ncontains">Enthält nicht</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-3">\n\t\t\t\t\t\t\t\t<input type="text" class="form-control" v-model="filterField.condition">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\x3c!-- Timestamp and date --\x3e\n\t\t\t\t\t\t<template v-if="types[filterField.name] == \'Date\'">\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.operation">\n\t\t\t\t\t\t\t\t\t<option value="gt">Größer als</option>\n\t\t\t\t\t\t\t\t\t<option value="lt">Weniger als</option>\n\t\t\t\t\t\t\t\t\t<option value="set">Eingestellt ist</option>\n\t\t\t\t\t\t\t\t\t<option value="nset">Eingestellt nicht ist</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-1">\n\t\t\t\t\t\t\t\t<input type="number" class="form-control" v-model="filterField.condition">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.option">\n\t\t\t\t\t\t\t\t\t<option value="minutes">Minuten</option>\n\t\t\t\t\t\t\t\t\t<option value="hours">Stunden</option>\n\t\t\t\t\t\t\t\t\t<option value="days">Tage</option>\n\t\t\t\t\t\t\t\t\t<option value="months">Monate</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<div class="col text-end">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass="btn btn-outline-dark"\n\t\t\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\t\t\t@click="removeField(index)"\n\t\t\t\t\t\t\t\ttitle="Filter entfernen"\n\t\t\t\t\t\t\t\taria-title="Filter entfernen"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="fa-solid fa-minus" aria-hidden="true"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Filter save options --\x3e\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-7">\n\t\t\t\t\t\t<div class="input-group">\n\t\t\t\t\t\t\t<input ref="filterName" type="text" class="form-control" placeholder="Filternamen eingeben...">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-outline-secondary" @click="$emit(\'saveCustomFilter\', $refs.filterName.value)">Filter speichern</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t<button type="button" class="btn btn-outline-dark" @click="applyFilterConfig">Filter anwenden</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t'},u={props:{fields:Array,selected:{type:Array,default:[]},names:{type:Object,default:{}}},emits:{hide:["fieldName"],show:["fieldName"]},data:function(){return{selectedFields:[]}},watch:{selected(t){this.selectedFields=t}},methods:{toggle(t){-1!=this.selectedFields.indexOf(t)?(this.selectedFields.splice(this.selectedFields.indexOf(t),1),this.$emit("hide",t)):(this.selectedFields.push(t),this.$emit("show",t))}},template:'\n\t<div class="filter-columns">\n\t\t<div class="card">\n\t\t\t<div class="d-flex flex-wrap gap-2 p-3 justify-content-center">\n\t\t\t\t<div\n\t\t\t\t\tv-for="fieldToDisplay in fields"\n\t\t\t\t\tclass="btn"\n\t\t\t\t\t:class="selectedFields.indexOf(fieldToDisplay) != -1 ? \'btn-dark\' : \'btn-outline-dark\' "\n\t\t\t\t\t@click="toggle(fieldToDisplay)"\n\t\t\t\t>\n\t\t\t\t\t{{ names[fieldToDisplay] || fieldToDisplay }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t'};const h={jsonLines:"fa-file-lines",xlsx:"fa-file-excel",pdf:"fa-file-pdf",html:"fa-file-code",json:"fa-file",csv:"fa-file-csv"},c={jsonLines:"Download as JSONLINES",xlsx:"Download as XLSX",pdf:"Download as PDF",html:"Download as HTML",json:"Download as JSON",csv:"Download as CSV "};var p={props:{tabulator:Object,config:{type:[Boolean,String,Function,Array,Object],default:!1},iconClass:[String,Array,Object]},computed:{currentConfig(){if(!this.config)return!1;let t=this.config;if(t instanceof Function)return[t];if(null===t)return[];if(!0===this.config&&(t=["csv"]),"[object String]"===Object.prototype.toString.call(t)&&(t=t.split(",")),"object"==typeof t&&!Array.isArray(t)){let a=[];for(var e in t){var n,i=t[e];i&&("[object String]"===Object.prototype.toString.call(i)?null!==(n=this.stringToFileFormatter(i))?a.push({icon:"fa-solid "+h[n],label:i===e?c[n]:e,formatter:n}):null!==(n=this.stringToFileFormatter(e))?a.push({icon:"fa-solid "+h[n],label:i,formatter:n}):alert("neither "+e+" nor "+i+" are supported download file types"):"object"!=typeof i||Array.isArray(i)?null!==(n=this.stringToFileFormatter(e))?a.push({icon:"fa-solid "+h[n],label:c[n],formatter:n}):alert(e+" is not a supported download file type"):null!==(n=this.stringToFileFormatter(e))?(void 0===i.formatter&&(i.formatter=n),void 0===i.label&&(i.label=c[n]),void 0===i.icon&&(i.icon=h[n]),a.push(i)):(void 0===i.label&&(i.label=e),a.push(i)))}t=a}if(Array.isArray(t)){if(t=t.map(t=>{if("[object String]"===Object.prototype.toString.call(t)){let e=this.stringToFileFormatter(t);return null===e?null:{icon:"fa-solid "+h[e],label:c[e],formatter:e}}if(t instanceof Function)return{formatter:t};if("object"==typeof t&&!Array.isArray(t)&&null!==t){if(t.formatter instanceof Function)return t;if(this.validateFileFormatter(t.formatter))return t}return null}).filter(t=>null!==t),t.length<2)return t;if(t.filter(t=>t.label||t.icon).length==t.length)return t;alert("Config not valid")}return[]}},methods:{stringToFileFormatter(t){let e=t.toLowerCase();return"jsonlines"==e?"jsonLines":["xlsx","pdf","html","json","csv"].includes(e)?e:null},validateFileFormatter(t){let e=this.stringToFileFormatter(t);if(!e)return alert(t+" is not a supported file formatter"),!1;if("xlsx"==e&&!window.XLSX)return alert("XLSX Library not loaded"),!1;if("pdf"==e){if(!window.jspdf)return alert("jsPDF Library not loaded"),!1;if(!new jspdf.jsPDF({}).autoTable)return alert("jsPDF-AutoTable Plugin not loaded"),!1}return!0},download(t){this.tabulator.download(t.formatter,t.file,t.options)}},template:'\n\t<template v-if="currentConfig">\n\t\t<template v-if="currentConfig.length == 1">\n\t\t\t<a\n\t\t\t\thref="#"\n\t\t\t\tclass="table-download"\n\t\t\t\tv-bind="$attrs"\n\t\t\t\ttitle="Download"\n\t\t\t\taria-title="Download"\n\t\t\t\t@click.prevent="download(currentConfig[0])"\n\t\t\t>\n\t\t\t\t<span :class="iconClass || \'fa-solid fa-xl fa-download\'" aria-hidden="true"></span>\n\t\t\t</a>\n\t\t</template>\n\t\t<div v-else class="dropdown d-inline">\n\t\t\t<a\n\t\t\t\thref="#"\n\t\t\t\tclass="table-download"\n\t\t\t\tv-bind="$attrs"\n\t\t\t\ttitle="Download"\n\t\t\t\taria-title="Download"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\taria-expanded="false"\n\t\t\t>\n\t\t\t\t<span :class="iconClass || \'fa-solid fa-xl fa-download\'" aria-hidden="true"></span>\n\t\t\t</a>\n\t\t\t<ul class="dropdown-menu dropdown-menu-end">\n\t\t\t\t<li v-for="(conf, i) in currentConfig" :key="i">\n\t\t\t\t\t<a class="dropdown-item" href="#" @click.prevent="download(conf)">\n\t\t\t\t\t\t<span v-if="conf.icon" :class="conf.icon" aria-hidden="true"></span>\n\t\t\t\t\t\t{{conf.label}}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</template>\n\t'};const g=new WeakMap;var m={mounted(t,e){let n=!1;g.set(t,e=>{if(!n)return;if(t.contains(e.target))return;const i=bootstrap.Collapse.getInstance(t);i&&i.hide()}),t.addEventListener("shown.bs.collapse",()=>{n=!0}),t.addEventListener("hide.bs.collapse",()=>{n=!1}),document.addEventListener("click",g.get(t),!0)},beforeUnmount(t,e){document.removeEventListener("click",g.get(t)),delete t.collapsibleAutoHideFunc}};window.Tabulator?.extendModule("layout","modes",{fitDataStretchFrozen(t,e){var n=0,i=this.table.rowManager.element.clientWidth,a=0,s=!1;t.forEach((t,e)=>{t.widthFixed||t.reinitializeWidth(),(this.table.options.responsiveLayout?t.modules.responsive.visible:t.visible&&!t.definition.frozen)&&(s=t),t.visible&&(n+=t.getWidth())}),s?(a=i-n+s.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(s.setWidth(0),this.table.modules.responsiveLayout.update()),a>0?s.setWidth(a):s.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}});var f={saveCustomFilter:t=>({method:"post",url:"/api/frontend/v1/filter/saveCustomFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,customFilterName:t.customFilterName}}),removeCustomFilter:t=>({method:"post",url:"/api/frontend/v1/filter/removeCustomFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId}}),applyFilterFields:t=>({method:"post",url:"/api/frontend/v1/filter/applyFilterFields",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterFields:t.filterFields}}),addFilterField:t=>({method:"post",url:"/api/frontend/v1/filter/addFilterField",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField}}),removeFilterField:t=>({method:"post",url:"/api/frontend/v1/filter/removeFilterField",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField}}),getFilterById:t=>({method:"get",url:"/api/frontend/v1/filter/getFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId}}),getFilter:t=>({method:"get",url:"/api/frontend/v1/filter/getFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType}})},v=0;const b={components:{CoreFetchCmpt:l,FilterConfig:d,FilterColumns:u,TableDownload:p},directives:{collapseAutoClose:m},emits:["nwNewEntry","click:new","tableBuilt","uuidDefined"],props:{onNwNewEntry:Function,title:String,description:String,sideMenu:{type:Boolean,default:!0},filterType:{type:String},tabulatorOptions:Object,tabulatorEvents:Array,tableOnly:Boolean,noColumnFilter:Boolean,reload:Boolean,reloadBtnInfotext:String,download:{type:[Boolean,String,Function,Array,Object],default:!1},newBtnShow:Boolean,newBtnClass:[String,Array,Object],newBtnDisabled:Boolean,newBtnLabel:String,uniqueId:String,idField:String,parentIdField:String,countOnly:Boolean,useSelectionSpan:{type:Boolean,default:!0}},data:function(){return{uuid:0,filterName:null,filterActive:!1,fields:null,dataset:null,datasetMetadata:null,selectedFields:null,filterFields:null,availableFilters:null,selectedFilter:null,fetchCmptRefresh:!1,fetchCmptApiFunction:null,fetchCmptApiFunctionParams:null,fetchCmptDataFetched:null,fetchResult:null,tabulator:null,tableBuilt:!1,tabulatorHasSelector:!1,selectedData:[],persistence:{sort:!0,columns:!0,filter:!1,headerFilter:!1,group:!1,page:!1}}},computed:{notSelectedFields(){return this.fields&&this.selectedFields?this.fields.filter(t=>-1===this.selectedFields.indexOf(t)):null},filteredData(){return this.dataset?JSON.parse(JSON.stringify(this.dataset)):[]},filteredColumns(){let t=JSON.parse(JSON.stringify(this.fields))||[],e=JSON.parse(JSON.stringify(this.selectedFields))||[],n=null;if(this.tabulatorOptions&&this.tabulatorOptions.hasOwnProperty("columns")&&(n=this.tabulatorOptions.columns),!Array.isArray(n)||Array.isArray(n)&&n.length<t.length){n=[];for(let i of t){let t={title:i,field:i};t.visible=e.indexOf(i)>=0,n.push(t)}}else for(let i of n)i.visible=e.indexOf(i.field)>=0||-1==t.indexOf(i.field),i.hasOwnProperty("resizable")&&(i.resizable=i.visible);return n},fieldIdsForVisibilty(){return this.tableBuilt?this.tabulator.getColumns().filter(t=>{let e=t.getDefinition();return!e.frozen&&e.title&&"responsiveCollapse"!=e.formatter}).map(t=>t.getField()):[]},fieldNames(){return this.tableBuilt?this.tabulator.getColumns().reduce((t,e)=>(t[e.getField()]=e.getDefinition().title,t),{}):{}},idExtra(){return this.uuid?"-"+this.uuid:""},columnsForFilter(){if(!this.filteredColumns||!this.datasetMetadata)return[];const t=this.filteredColumns.reduce((t,e)=>(t[e.field]=e.title,t),{});return this.datasetMetadata.map(e=>({...e,title:t[e.name]}))}},methods:{reloadTable(){this.tableOnly?this.tabulator.setData():this.getFilter()},async initTabulator(){let t="< Phrasen Plugin not loaded! >";this.$p&&(await this.$p.loadCategory("ui"),t=this.$p.t("ui/keineDatenVorhanden")),this.tableOnly||await new Promise(t=>{const e=window.location.hash?window.location.hash.slice(1):null,n=e=>{this.setRenderData(e),t()};null===e?this.startFetchCmpt(t=>this.$api.call(f.getFilter(t)),null,n):this.startFetchCmpt(t=>this.$api.call(f.getFilterById(t)),{filterId:e},n)});let e={layout:"fitDataStretchFrozen",movableColumns:!0,columnDefaults:{tooltip:!0},placeholder:t,persistence:this.persistence,...this.tabulatorOptions||{}};if(void 0===e.height&&void 0===e.minHeight&&void 0===e.maxHeight&&(e.height=500),this.tableOnly?e.columns.forEach(t=>{void 0===t.visible&&(t.visible=!0)}):(e.data=this.filteredData,e.columns=this.filteredColumns),(e.selectable||e.columns&&e.columns.filter(t=>"rowSelection"==t.formatter).length)&&(this.tabulatorHasSelector=!0),this.idField&&(this.parentIdField&&(e.dataTree=!0),e.index=this.idField),this.tabulator=new Tabulator(this.$refs.table,e),Array.isArray(this.tabulatorEvents)&&this.tabulatorEvents.length>0)for(let t of this.tabulatorEvents)this.tabulator.on(t.event,t.handler);this.tabulator.on("tableBuilt",()=>{this.tableBuilt=!0,this.$emit("tableBuilt")}),this.tabulator.on("rowSelectionChanged",t=>{this.selectedData=t}),this.parentIdField&&this.idField&&this.tabulator.on("dataLoading",t=>{let e=[];for(let n=0;n<t.length;n++){let i=t[n];i[this.parentIdField]&&this.appendChild(t,i)&&e.push(n)}for(let n=0;n<e.length;n++)t.splice(e[n]-n,1)}),this.tableOnly&&this.tabulator.on("tableBuilt",()=>{const t=this.tabulator.getColumns();this.fields=t.map(t=>t.getField()),this.selectedFields=t.filter(t=>t.isVisible()).map(t=>t.getField()),this.tabulator.options.persistence.headerFilter&&this._setHeaderFilter()}),this.tabulator.on("dataFiltered",t=>{this.filterActive=t.length>0})},updateTabulator(){this.tabulator&&(this.tableBuilt?this._updateTabulator():this.tabulator.on("tableBuilt",this._updateTabulator))},_updateTabulator(){this.tabulatorHasSelector=this.tabulatorOptions.selectable||this.filteredColumns.filter(t=>"rowSelection"==t.formatter).length,this.tabulator.setColumns(this.filteredColumns),this.tabulator.setData(this.filteredData),this._setHeaderFilter()},clearFilters(){this.tabulator.getHeaderFilters().forEach(t=>{this.tabulator.setHeaderFilterValue(t.field,"")}),this.tabulator.clearFilter(),this.filterActive=!1},_setHeaderFilter(){this.tabulator.getHeaderFilters().forEach(t=>{this.tabulator.setHeaderFilterValue(t.field,t.value)})},getFilter(){null===this.selectedFilter?this.startFetchCmpt(t=>this.$api.call(f.getFilter(t)),null,this.render):this.startFetchCmpt(t=>this.$api.call(f.getFilterById(t)),{filterId:this.selectedFilter},this.render)},setRenderData(t){this.fetchResult=t,this.filterName=t.filterName,this.dataset=t.dataset,this.datasetMetadata=t.datasetMetadata,this.fields=t.fields,this.selectedFields=t.selectedFields,this.filterFields=[];for(let e=0;e<t.datasetMetadata.length;e++)for(let n=0;n<t.filters.length;n++)if(t.datasetMetadata[e].name==t.filters[n].name){let i=t.filters[n];i.type=t.datasetMetadata[e].type,this.filterFields.push(i)}},render(t){let e=t;this.setRenderData(e),!0===this.sideMenu?this.setSideMenu(e):this.setDropDownMenu(e),this.updateTabulator()},setSideMenu(t){let e=t.sideMenu.filters,n=t.sideMenu.personalFilters,i=[];for(let t=0;t<e.length;t++){let n=e[t].link;null==n&&(n="#"),i[i.length]={id:e[t].filter_id,link:n+e[t].filter_id,description:e[t].desc,sort:t,onClickCall:this.handlerGetFilterById}}for(let t=0;t<n.length;t++){let e=n[t].link;null==e&&(e="#"),i[i.length]={id:n[t].filter_id,link:e+n[t].filter_id,description:n[t].desc,subscriptDescription:n[t].subscriptDescription,subscriptLinkClass:n[t].subscriptLinkClass,subscriptLinkValue:n[t].subscriptLinkValue,sort:t,onClickCall:this.handlerGetFilterById,onClickSubscriptCall:this.handlerRemoveCustomFilter}}this.availableFilters=i,this.$emit("nwNewEntry",{link:"#",description:"Filters",icon:"filter",children:i})},setDropDownMenu(t){let e=t.sideMenu.filters,n=t.sideMenu.personalFilters,i=[];for(let t=0;t<e.length;t++)e[t].link,i[i.length]={id:e[t].filter_id,option:e[t].filter_id,description:e[t].desc};for(let t=0;t<n.length;t++)n[t].link,i[i.length]={id:n[t].filter_id,option:n[t].filter_id,description:n[t].desc};this.availableFilters=i},startFetchCmpt(t,e,n){this.fetchCmptApiFunction=t,null==e&&(e={}),e.filterUniqueId=FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method,e.filterType=this.filterType,this.uniqueId&&(e.filterUniqueId+="_"+this.uniqueId),this.fetchCmptApiFunctionParams=e,this.fetchCmptDataFetched=n,!0===this.fetchCmptRefresh?this.fetchCmptRefresh=!1:this.fetchCmptRefresh=!0},handlerSaveCustomFilter(t){this.selectedFilter=null,this.startFetchCmpt(t=>this.$api.call(f.saveCustomFilter(t)),{customFilterName:t},this.getFilter)},handlerRemoveCustomFilter(t){let e=t.currentTarget.getAttribute("href").substring(1);e===this.selectedFilter&&(this.selectedFilter=null),this.startFetchCmpt(t=>this.$api.call(f.removeCustomFilter(t)),{filterId:e},this.getFilter)},handlerGetFilterById:function(t){let e=null,n=t.currentTarget.getAttribute("href");e=null==n?t.currentTarget.value:n.substring(1),this.switchFilter(e)},switchFilter(t){this.selectedFilter=t,this.getFilter()},applyFilterConfig(t){this.selectedFilter=null,this.startFetchCmpt(t=>this.$api.call(f.applyFilterFields(t)),{filterFields:t},this.getFilter)},appendChild(t,e){let n=e[this.parentIdField];for(let i=0;i<t.length;i++){let a=t[i];if(a[this.idField]==n)return a._children||(a._children=[]),a._children.includes(e)||a._children.push(e),!0;a._children&&this.appendChild(a._children,e)}return!1}},beforeCreate(){!this.tableOnly==!this.filterType&&alert("You can not have a filter-type in table-only mode!")},created(){!this.sideMenu||this.$props.onNwNewEntry&&this.$props.onNwNewEntry instanceof Function||alert('"nwNewEntry" listener is mandatory when sideMenu is true'),this.uuid=v++,this.$emit("uuidDefined",this.uuid)},mounted(){this.initTabulator().then(()=>{this.tableOnly||(this.selectedFilter=window.location.hash?window.location.hash.slice(1):null,this.render(this.fetchResult))})},template:'\n\t\t\x3c!-- Load filter data --\x3e\n\t\t<core-fetch-cmpt\n\t\t\tv-if="!tableOnly && fetchCmptApiFunction"\n\t\t\tv-bind:api-function="fetchCmptApiFunction"\n\t\t\tv-bind:api-function-parameters="fetchCmptApiFunctionParams"\n\t\t\tv-bind:refresh="fetchCmptRefresh"\n\t\t\t@data-fetched="fetchCmptDataFetched">\n\t\t</core-fetch-cmpt>\n\n\t\t<div class="row" v-if="title != null && title != \'\'">\n\t\t\t<div class="col-lg-12">\n\t\t\t\t<h3 class="page-header mt-1 mb-4">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</h3>\n\t\t\t</div>\n\t\t</div>\n\t\t<div :id="\'filterCollapsables\' + idExtra">\n\n\t\t\t<div class="d-flex flex-row justify-content-between flex-wrap">\n\t\t\t\t<div v-if="newBtnShow || reload || $slots.search || $slots.actions" class="d-flex gap-2 align-items-baseline flex-wrap">\n\t\t\t\t\t<button v-if="newBtnShow" class="btn btn-primary" :class="newBtnClass" :title="newBtnLabel ? undefined : \'New\'" :aria-label="newBtnLabel ? undefined : \'New\'" @click="$emit(\'click:new\', $event)" :disabled="newBtnDisabled">\n\t\t\t\t\t\t<span class="fa-solid fa-plus" aria-hidden="true"></span>\n\t\t\t\t\t\t{{ newBtnLabel }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button v-if="reload" class="btn btn-outline-secondary" aria-label="Reload" @click="reloadTable">\n\t\t\t\t\t\t<span class="fa-solid fa-rotate-right" aria-hidden="true"  :title="reloadBtnInfotext ? reloadBtnInfotext : \'Reload\'" ></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<span v-if="$slots.actions && tabulatorHasSelector && useSelectionSpan">\n\t\t\t\t\t\t<span v-if="countOnly">{{ selectedData.length }} ausgewählt</span>\n\t\t\t\t\t\t<span v-else id="selected-info-text"> Mit {{ selectedData.length }} ausgewählten:</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<slot name="actions" v-bind="{selected: tabulatorHasSelector ? selectedData : []}"></slot>\n\t\t\t\t\t<slot name="search"></slot>\n\t\t\t\t</div>\n\t\t\t\t<div class="d-flex gap-1 align-items-baseline flex-grow-1 justify-content-end">\n\t\t\t\t\t<span v-if="!tableOnly">[ {{ filterName }} ]</span>\n\t\t\t\t\t<span v-else-if="description" v-html="description"></span>\n\t\t\t\t\t<a aria-label="filter" v-if="!tableOnly || $slots.filter" href="#" class="btn btn-link px-0 fhc-text" data-bs-toggle="collapse" :data-bs-target="\'#collapseFilters\' + idExtra">\n\t\t\t\t\t\t<span class="fa-solid fa-xl fa-filter"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a aria-label="filter" v-if="filterActive"  class="btn btn-link px-0 fhc-text" :title="$p.t(\'ui\',\'filterdelete\')" @click="clearFilters">\n\t\t\t\t\t\t<span class="fa-solid fa-xl fa-filter-circle-xmark"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a aria-label="filter" href="#" class="btn btn-link px-0 fhc-text" data-bs-toggle="collapse" :data-bs-target="\'#collapseColumns\' + idExtra">\n\t\t\t\t\t\t<span class="fa-solid fa-xl fa-table-columns"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<table-download class="btn btn-link px-0 fhc-text" :tabulator="tabulator" :config="download"></table-download>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<filter-columns\n\t\t\t\t:id="\'collapseColumns\' + idExtra"\n\t\t\t\tclass="card-body collapse"\n\t\t\t\t:data-bs-parent="\'#filterCollapsables\' + idExtra"\n\t\t\t\t:fields="fieldIdsForVisibilty"\n\t\t\t\t:selected="selectedFields"\n\t\t\t\t:names="fieldNames"\n\t\t\t\t@hide="tabulator.hideColumn($event)"\n\t\t\t\t@show="tabulator.showColumn($event)"\n\t\t\t\tv-collapse-auto-close\n\t\t\t></filter-columns>\n\n\t\t\t<filter-config\n\t\t\t\tv-if="!tableOnly"\n\t\t\t\t:id="\'collapseFilters\' + idExtra"\n\t\t\t\tclass="card-body collapse"\n\t\t\t\t:data-bs-parent="\'#filterCollapsables\' + idExtra"\n\t\t\t\t:filters="!sideMenu ? (availableFilters || []) : []"\n\t\t\t\t:columns="columnsForFilter"\n\t\t\t\t:fields="filterFields || []"\n\t\t\t\t@switch-filter="switchFilter"\n\t\t\t\t@apply-filter-config="applyFilterConfig"\n\t\t\t\t@save-custom-filter="handlerSaveCustomFilter"\n\t\t\t\tv-collapse-auto-close\n\t\t\t></filter-config>\n\t\t\t<div\n\t\t\t\tv-else-if="$slots.filter"\n\t\t\t\t:id="\'collapseFilters\' + idExtra"\n\t\t\t\tclass="card-body collapse"\n\t\t\t\t:data-bs-parent="\'#filterCollapsables\' + idExtra"\n\t\t\t\tv-collapse-auto-close\n\t\t\t\t>\n\t\t\t\t<slot name="filter"></slot>\n\t\t\t</div>\n\t\t</div>\n\n\t\t\x3c!-- Tabulator --\x3e\n\t\t<div ref="table" :id="\'filterTableDataset\' + idExtra" class="filter-table-dataset"></div>\n\t'};var y={getHeader:t=>({method:"get",url:"/api/frontend/v1/navigation/header",params:{navigation_page:t}}),getMenu:t=>({method:"get",url:"/api/frontend/v1/navigation/menu",params:{navigation_page:t}})};const w={components:{CoreFetchCmpt:l},props:{addHeaderMenuEntries:Object,addSideMenuEntries:Object,hideTopMenu:Boolean,leftNavCssClasses:{type:String,default:"navbar navbar-left-side"}},data:()=>({headerMenu:{},sideMenu:{}}),computed:{headerMenuEntries(){let t=this.headerMenu?{...this.headerMenu}:{};return null!=this.headerMenu&&null!=this.addHeaderMenuEntries&&Object.keys(this.addHeaderMenuEntries).length>0&&(t[this.addHeaderMenuEntries.description]=this.addHeaderMenuEntries),t},sideMenuEntries(){let t=this.sideMenu?{...this.sideMenu}:{};return null!=this.sideMenu&&null!=this.addSideMenuEntries&&Object.keys(this.addSideMenuEntries).length>0&&(t[this.addSideMenuEntries.description]=this.addSideMenuEntries),t}},methods:{getNavigationPage:()=>FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method,fetchCmptApiFunctionHeader(){return this.$api.call(y.getHeader(this.getNavigationPage()))},fetchCmptApiFunctionSideMenu(){return this.$api.call(y.getMenu(this.getNavigationPage()))},fetchCmptDataFetchedHeader(t){this.headerMenu=t||{}},fetchCmptDataFetchedMenu(t){this.sideMenu=t||{}},getDataBsToggle:t=>t.children?"dropdown":null},template:'\n\t\t\x3c!-- Load head menu --\x3e\n\t\t<core-fetch-cmpt v-bind:api-function="fetchCmptApiFunctionHeader" @data-fetched="fetchCmptDataFetchedHeader"></core-fetch-cmpt>\n\t\t\x3c!-- Load side menu --\x3e\n\t\t<core-fetch-cmpt v-bind:api-function="fetchCmptApiFunctionSideMenu" @data-fetched="fetchCmptDataFetchedMenu"></core-fetch-cmpt>\n\n\t\t\x3c!-- Top menu --\x3e\n\t\t<nav class="navbar navbar-expand-lg navbar-header" v-if="!hideTopMenu">\n\t\t\t<ul class="navbar-nav">\n\t\t\t\t\x3c!-- 1st level --\x3e\n\t\t\t\t<template v-for="header in headerMenuEntries">\n\t\t\t\t\t<li class="nav-item dropdown">\n\t\t\t\t\t\t<a class="nav-link header-menu-link-entry"\n\t\t\t\t\t\t\tv-bind:data-bs-toggle="this.getDataBsToggle(header)"\n\t\t\t\t\t\t\tv-bind:class="{ \'dropdown-toggle\': header.children }"\n\t\t\t\t\t\t\tv-bind:href="header.link"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i class="fa-solid fa-fw header-menu-icon" v-bind:class="\'fa-\' + header.icon" v-if="header.icon"></i> {{ header.description }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="dropdown-menu" v-if="header.children">\n\t\t\t\t\t\t\t\x3c!-- 2nd level --\x3e\n\t\t\t\t\t\t\t<template v-for="child in header.children">\n\t\t\t\t\t\t\t\t<li><a class="dropdown-item" v-bind:href="child.link">{{ child.description }}</a></li>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</template>\n\t\t\t</ul>\n\t\t\t<slot></slot>\n\t\t</nav>\n\n\t\t\x3c!-- Left side menu --\x3e\n\t\t<nav :class="leftNavCssClasses">\n\t\t\t<ul class="navbar-nav">\n\t\t\t\t\x3c!-- 1st level --\x3e\n\t\t\t\t<template v-for="menu in sideMenuEntries">\n\t\t\t\t\t<li class="nav-item">\n\t\t\t\t\t\t<a class="nav-link left-side-menu-link-entry" v-bind:href="menu.link" @click=menu.onClickCall>\n\t\t\t\t\t\t\t<i class="fa fa-fw" v-bind:class="\'fa-\'+ menu.icon"></i> {{ menu.description }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="nav-link left-side-menu-second-level" v-if="menu.children">\n\t\t\t\t\t\t\t\x3c!-- 2nd level --\x3e\n\t\t\t\t\t\t\t<template v-for="child in menu.children">\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t<a class="nav-link left-side-menu-link-entry" v-bind:href="child.link" @click=child.onClickCall>\n\t\t\t\t\t\t\t\t\t\t&emsp;&emsp;{{ child.description }}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\tclass="nav-link left-side-menu-link-entry"\n\t\t\t\t\t\t\t\t\t\tv-bind:class="child.subscriptLinkClass"\n\t\t\t\t\t\t\t\t\t\tv-if="child.subscriptDescription"\n\t\t\t\t\t\t\t\t\t\tv-bind:href="child.link"\n\t\t\t\t\t\t\t\t\t\t@click=child.onClickSubscriptCall\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ child.subscriptDescription }}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</template>\n\t\t\t</ul>\n\t\t</nav>\n\t'};var $={props:{title:"",subtitle:"",mainCols:{type:Array,default:[]},asideCols:{type:Array,default:[]}},computed:{mainGridCols(){return this.mainCols.length>0?`col-md-${this.mainCols[0]}`:"col-md-12"},asideGridCols(){return this.asideCols.length>0?`col-md-${this.asideCols[0]}`:""}},template:'\n\t<div class="overflow-hidden">\n\t\t<header v-if="title">\n\t\t\t<h1 class="h2 mb-5">{{ title }}<span class="fhc-subtitle">{{ subtitle }}</span></h1>\n\t\t</header>\n\t\t<div class="row gx-5">\n\t\t\t<main :class="mainGridCols">\n\t\t\t\t<slot name="main">{{ mainGridCols }}</slot>\n\t\t\t</main>\n\t\t\t<aside v-if="asideCols.length > 0" :class="asideGridCols">\n\t\t\t\t<slot name="aside">{{ asideGridCols }}</slot>\n\t\t\t</aside>\n\t\t</div>\n\t</div>\n\t'};const A={centeredFormatter:function(t){return'<div style="display: flex; justify-content: center; align-items: center; height: 100%">'+t.getValue()+"</div>"},formDateOnly:function(t){var e=t.getValue();if(e){var n=new Date(e);return n.getDate().toString().padStart(2,"0")+"."+(n.getMonth()+1).toString().padStart(2,"0")+"."+n.getFullYear()}return e},fotoFormatter:function(t){let e=t.getValue();if(void 0!==e)return'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><img src="'+e+'" style="max-height: 64px"></img></div>'},dateOnlyTimeFormatter:function(t){const e=t.getValue();if(void 0===e)return"";const n=new Date(e);let i=n.getHours(),a=n.getMinutes();return i=i<10?"0"+i:i,a=a<10?"0"+a:a,i+":"+a}},_={formFile:function(t){return t.getValue()?'<div style="display: flex; justify-content: center; align-items: center; height: 100%; cursor: pointer;"><a><i class="fa fa-file-pdf" style="color:#00649C"></i></a></div>':'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><a>-</a></div>'},formDate:function(t){var e=t.getValue();if(e){var n=new Date(e);return n.getDate().toString().padStart(2,"0")+"."+(n.getMonth()+1).toString().padStart(2,"0")+"."+n.getFullYear()+" "+n.getHours().toString().padStart(2,"0")+":"+n.getMinutes().toString().padStart(2,"0")}return e},formStudiengangKz:function(t){const e=t.getRow().getData();return e.kurzbzlang+" "+e.bezeichnung}};var S={name:"BootstrapModal",data:()=>({modal:null,fullscreen:!1}),props:{backdrop:{type:[Boolean,String],default:!0,validator:t=>["static",!0,!1].includes(t)},focus:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},noCloseBtn:Boolean,dialogClass:[String,Array,Object],headerClass:{type:[String,Array,Object],default:""},bodyClass:{type:[String,Array,Object],default:"px-4 py-5"},footerClass:{type:[String,Array,Object],default:""},allowFullscreenExpand:{type:Boolean,default:!1}},emits:["hideBsModal","hiddenBsModal","hidePreventedBsModal","showBsModal","shownBsModal"],methods:{dispose(){return this.modal.dispose()},handleUpdate(){return this.modal.handleUpdate()},hide(){return this.modal.hide()},show(t){return this.modal.show(t)},toggle(){return this.modal.toggle()},toggleFullscreen(){this.fullscreen=!this.fullscreen}},mounted(){this.$refs.modal&&(this.modal=new bootstrap.Modal(this.$refs.modal,{backdrop:this.backdrop,focus:this.focus,keyboard:this.keyboard}))},popup(t,e,n,i){const a=this,s={};void 0!==t&&(s.default=()=>t),void 0!==n&&(s.title=()=>n),void 0!==i&&(s.footer=()=>i);let r=!1;return"undefined"!=typeof primevue&&(r=!0),new Promise((t,n)=>{const i=Vue.createApp({name:"ModalTmpApp",setup:()=>()=>Vue.h(a,{class:"fade",...e,ref:"modal","onHidden.bs.modal":i.unmount},s),mounted(){this.$refs.modal.show()},beforeUnmount(){this.$refs.modal&&(!1!==this.$refs.modal.result?t(this.$refs.modal.result):n())},unmounted(){l.parentElement.removeChild(l)}}),l=document.createElement("div");r&&i.use(primevue.config.default,{zIndex:{overlay:9999}}),Promise.resolve().then(function(){return ct}).then(t=>{i.use(t.default),i.mount(l),document.body.appendChild(l)})})},template:'<div ref="modal" class="bootstrap-modal modal" tabindex="-1" @[`hide.bs.modal`]="$emit(\'hideBsModal\')" @[`hidden.bs.modal`]="$emit(\'hiddenBsModal\')" @[`hidePrevented.bs.modal`]="$emit(\'hidePreventedBsModal\')" @[`show.bs.modal`]="$emit(\'showBsModal\')" @[`shown.bs.modal`]="$emit(\'shownBsModal\')">\n\t\t<div class="modal-dialog" :class="fullscreen ? \'modal-fullscreen\' : dialogClass">\n\t\t\t<div class="modal-content">\n\t\t\t\t<div v-if="$slots.title" class="modal-header" :class="headerClass">\n\t\t\t\t\t<h5 class="modal-title"><slot name="title"/></h5>\n\t\t\t\t\t<div class="d-flex align-items-center ms-auto">\n\t\t\t\t\t\t<button type="button" class="btn ms-auto" style="filter: invert(1)" v-if="allowFullscreenExpand" @click="toggleFullscreen">\n\t\t\t\t\t\t  <i v-if="!fullscreen" class="fa-solid fa-expand"></i>\n\t\t\t\t\t\t  <i v-else class="fa-solid fa-compress"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button v-if="!noCloseBtn" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<slot name="modal-header-content"></slot>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-body" :class="bodyClass">\n\t\t\t\t\t<slot></slot>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="$slots.footer" class="modal-footer" :class="footerClass">\n\t\t\t\t\t<slot name="footer"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>'};const D={name:"LehreinheitenDropdown",components:{Dropdown:primevue.dropdown},emits:["leChanged"],props:{title:""},methods:{leChanged(t){this.$entryParams.selected_le_id.value=t.value.lehreinheit_id,this.$entryParams.selected_le_info.value=t.value,this.$emit("leChanged")},getSelected(t){return t?.infoString===this.$entryParams.selected_le_info.value?.infoString},getOptionLabel:t=>t.infoString},template:'\n\t\t<div>\n\t\t\t<Dropdown @change="leChanged" :style="{\'width\': \'100%\'}" :optionLabel="getOptionLabel" \n\t\t\tv-model="this.$entryParams.selected_le_info.value" :options="$entryParams.available_le_info.value">\n\t\t\t\t<template #optionsgroup="slotProps">\n\t\t\t\t\t<div> {{ option.infoString }} </div>\n\t\t\t\t</template>\n\t\t\t</Dropdown>\n\t\t</div>\n\t'},C={name:"MaUIDDropdown",components:{Dropdown:primevue.dropdown},emits:["maUIDChanged"],props:{title:""},methods:{maUIDChanged(t){this.$entryParams.selected_maUID.value=t.value,this.$entryParams.handleLeSetup(this.$entryParams.lv_id,this.$entryParams.selected_maUID.value.mitarbeiter_uid,this.$entryParams.sem_kurzbz,[]).then(()=>{this.$emit("maUIDchanged")})},getSelected(t){return t.mitarbeiter_uid===this.$entryParams.selected_maUID.value?.mitarbeiter_uid},getOptionLabel:t=>t.infoString},template:'\n\t\t<div>\n\t\t\t<Dropdown @change="maUIDChanged" :style="{\'width\': \'100%\'}" :optionLabel="getOptionLabel" \n\t\t\t\tv-model="this.$entryParams.selected_maUID.value" :options="$entryParams.available_maUID.value">\n\t\t\t\t<template #optionsgroup="slotProps">\n\t\t\t\t\t<div> {{ option.infoString }} </div>\n\t\t\t\t</template>\n\t\t\t</Dropdown>\n\t\t</div>\n\t'},k={name:"KontrollenDropdown",components:{Dropdown:primevue.dropdown},emits:["kontrolleChanged"],data:()=>({errors:null,internal_available_kontrolle:[],internal_selected_kontrolle:null}),methods:{setKontrollen(t){this.internal_available_kontrolle=t,this.internal_selected_kontrolle=t[0],this.$emit("kontrolleChanged",this.internal_selected_kontrolle)},kontrolleChanged(t){this.internal_selected_kontrolle=t.value,this.$emit("kontrolleChanged",this.internal_selected_kontrolle)},getOptionLabel:t=>t.datum+": "+t.von+" - "+t.bis,checkDisabled(t){if(this.$entryParams.permissions.admin||this.$entryParams.permissions.assistenz)return!1;const e=new Date;e.setDate(e.getDate()-this.$entryParams.permissions.kontrolleDeleteMaxReach);return new Date(t.datum)<e}},mounted(){},template:'\n\t\t<div class="mt-2">\n\t\t\t<Dropdown @change="kontrolleChanged" :style="{\'width\': \'100%\'}" :optionLabel="getOptionLabel" \n\t\t\tv-model="internal_selected_kontrolle" :options="internal_available_kontrolle" :optionDisabled="checkDisabled">\n\t\t\t\t<template #optionsgroup="slotProps">\n\t\t\t\t\t<div> {{kontrolle.datum}}: {{kontrolle.von}} - {{kontrolle.bis}} </div>\n\t\t\t\t</template>\n\t\t\t</Dropdown>\n\t\t</div>\n\t'},P={name:"TermineDropdown",components:{Dropdown:primevue.dropdown},emits:["terminChanged"],methods:{terminChanged(t){this.$entryParams.selected_termin.value=t.value,this.$emit("terminChanged")},getOptionLabel:t=>t.datumFrontend+": "+t.beginn+" - "+t.ende},mounted(){},template:'\n\t\t<div class="mt-2">\n\t\t\t<Dropdown @change="terminChanged" :style="{\'width\': \'100%\'}" :optionLabel="getOptionLabel" \n\t\t\tv-model="this.$entryParams.selected_termin.value" :options="$entryParams.available_termine.value" :placeholder="$p.t(\'global/termineAusStundenplanV2\')">\n\t\t\t\t<template #optionsgroup="slotProps">\n\t\t\t\t\t<div> {{option.datumFrontend}}: {{option.beginn}} - {{option.ende}} </div>\n\t\t\t\t</template>\n\t\t\t</Dropdown>\n\t\t</div>\n\t'},E={name:"AnwCountDisplay",data:function(){return{anwHovered:!1,abwHovered:!1,entHovered:!1}},props:{anwesend:"/",abwesend:"/",entschuldigt:"/"},template:'\t\n\t\t<div class="text-center">\n\t\t\t<div style="display: flex; justify-content: center; align-items: center;">\n\t\t\t\t<div @mouseover="anwHovered = true" @mouseleave="anwHovered = false" style="position: relative; display: inline-block; color: #28a745;">\n\t\t\t\t\t<h3>{{anwesend}} <i class="fa fa-check"></i>\n\t\t\t\t\t\t<div class="legend-info" v-show="anwHovered"> {{$capitalize($p.t(\'global/anwesend\'))}}</div>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\n\t\t\t\t<div @mouseover="abwHovered = true" @mouseleave="abwHovered = false" style="position: relative; display: inline-block; color: #dc3545; margin-left: 36px;">\n\t\t\t\t\t<h3>{{abwesend}} <i class="fa fa-xmark"></i>\n\t\t\t\t\t\t<div class="legend-info" v-show="abwHovered"> {{$capitalize($p.t(\'global/abwesend\'))}}</div>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\n\t\t\t\t<div @mouseover="entHovered = true" @mouseleave="entHovered = false" \n\t\t\t\tv-if="this.$entryParams.permissions.entschuldigungen_enabled" \n\t\t\t\tstyle="position: relative; display: inline-block; color: #0335f5; margin-left: 36px;">\n\t\t\t\t\t<h3>{{entschuldigt}} <i class="fa-solid fa-user-shield"></i>\n\t\t\t\t\t\t<div class="legend-info" v-show="entHovered"> {{$capitalize($p.t(\'global/entschuldigt\'))}}</div>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t</div>\n\t\n\t'},T={name:"KontrolleDisplay",data:function(){return{hovered:!1}},props:{kontrolle:null},template:'\n\t\t<div v-if="kontrolle" class="row">\n\t\t\t<div class="col-1 ml-4 d-flex align-items-center">\n\t\t\t\t<div style="position: relative; display: inline-block;">\n\t\t\t\t\t<h6 @mouseover="hovered = true" @mouseleave="hovered = false">\n\t\t\t\t\t\t<i class="fa-solid fa-circle-info"></i> \n\t\t\t\t\t\t<div class="legend-info" v-show="hovered" style="min-width: 400px; z-index: 8500;">\n\t\t\t\t\t\t\t<div class="row"><p>Anwesenheit_id: {{kontrolle.anwesenheit_id}}</p></div>\n\t\t\t\t\t\t\t<div class="row"><p>Lehreinheit_id: {{kontrolle.lehreinheit_id}}</p></div>\n\t\t\t\t\t\t\t<div class="row"><p>insertvon: {{kontrolle.insertvon}}</p></div>\n\t\t\t\t\t\t\t<div class="row"><p>insertamum: {{kontrolle.insertamum}}</p></div>\n\t\t\t\t\t\t\t<div class="row"><p>updatevon: {{kontrolle.updatevon}}</p></div>\n\t\t\t\t\t\t\t<div class="row"><p>updateamum: {{kontrolle.updateamum}}</p></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</h6>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="col-11"><h4>{{kontrolle.datum}}: {{kontrolle.von}} - {{kontrolle.bis}}</h4></div>\n\t\t\t\n\t\t</div>\n\t\t\n\t\n\t'},F={name:"Statuslegende",template:'\t\n\t\t<div class="text-center">\n\t\t\t<div class="col">\n\t\t\t\t<div class="row" style="color: #28a745;"><h3>{{$capitalize($p.t(\'global/anwesend\'))}} = <i class="fa fa-check"></i></h3></div>\n\n\t\t\t\t<div class="row" style="color: #dc3545;"><h3>{{$capitalize($p.t(\'global/abwesend\'))}} = <i class="fa fa-xmark"></i></h3></div>\n\n\t\t\t\t<div v-if="this.$entryParams.permissions.entschuldigungen_enabled" class="row" style="color: #0335f5;"><h3>{{$capitalize($p.t(\'global/entschuldigt\'))}} = <i class="fa-solid fa-user-shield"></i></h3></div>\n\n\t\t\t\t<div class="row"><h3>{{$capitalize($p.t(\'global/studentenInLVTeil\'))}} = 👥</h3></div>\n\t\t\t\t<div class="row"><h3>{{$capitalize($p.t(\'global/termineAusStundenplanV2\'))}} = 📅</h3></div>\n\t\t\t\t<div class="row" style="color: #0335f5"><h3>Name -> {{$capitalize($p.t(\'global/entschuldigtLegendeBlau\'))}}</h3></div>\n\t\t\t\t<div class="row" style="color: #12d5d5"><h3>Name -> {{$capitalize($p.t(\'global/entschuldigtLegendeTuerkis\'))}}</h3></div>\n\n\t\t\t</div>\n\t\t</div>\t\n\t'};var x={fetchAllAnwesenheitenByLvaAssigned:(t,e,n,i,a)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/fetchAllAnwesenheitenByLvaAssigned",params:{lv_id:t,sem_kurzbz:e,le_id:n,ma_uid:i,date:a}}),getAllAnwesenheitenByStudentByLva:(t,e,n)=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/getAllAnwesenheitenByStudentByLva",params:{prestudent_id:t,lv_id:e,sem_kurzbz:n}}),updateAnwesenheiten:(t,e)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/updateAnwesenheiten",params:{le_id:t,changedAnwesenheiten:e}}),getExistingQRCode:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/getExistingQRCode",params:{le_id:t}}),regenerateQRCode:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/regenerateQRCode",params:{anwesenheit_id:t}}),degenerateQRCode:(t,e)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/degenerateQRCode",params:{anwesenheit_id:t,zugangscode:e}}),getNewQRCode:(t,e,n,i)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/getNewQRCode",params:{le_id:t,datum:e,beginn:n,ende:i}}),deleteQRCode:(t,e)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/deleteQRCode",params:{anwesenheit_id:t,lv_id:e}}),deleteAnwesenheitskontrolle:(t,e,n)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/deleteAnwesenheitskontrolle",params:{le_id:t,date:e,anwesenheit_id:n}}),pollAnwesenheiten:(t,e)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/pollAnwesenheiten",params:{anwesenheit_id:t,lv_id:e}}),getAnwQuoteForPrestudentIds:(t,e,n)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/getAnwQuoteForPrestudentIds",params:{ids:t,lv_id:e,sem_kurzbz:n}}),restartKontrolle:(t,e,n)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/restartKontrolle",params:{anwesenheit_id:t,le_id:e,datum:n}}),updateKontrolle:(t,e,n,i)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/updateKontrolle",params:{anwesenheit_id:t,von:e,bis:n,le_id:i}}),getLehreinheitenForLehrveranstaltungAndMaUid:(t,e,n)=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/getLehreinheitenForLehrveranstaltungAndMaUid",params:{lva_id:t,ma_uid:e,sem_kurzbz:n}}),insertAnwWithoutQR:(t,e,n,i)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/KontrolleApi/insertAnwWithoutQR",params:{le_id:t,datum:e,beginn:n,ende:i}})},z={getAllAnwQuotasForLvaByUID:(t,e)=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/getAllAnwQuotasForLvaByUID",params:{studiensemester:t,uid:e}}),getAllAnwByUID:(t,e,n)=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/getAllAnwByUID",params:{studiensemester:t,uid:e,person_id:n}}),getProfileViewData:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/getProfileViewData",params:{uid:t}}),checkInAnwesenheit:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/checkInAnwesenheit",params:{zugangscode:t}}),addEntschuldigung:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/addEntschuldigung",params:t,headers:{Headers:{"Content-Type":"multipart/form-data"}}}),editEntschuldigung:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/editEntschuldigung",params:t,headers:{Headers:{"Content-Type":"multipart/form-data"}}}),deleteEntschuldigung:(t,e)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/deleteEntschuldigung",params:{entschuldigung_id:t,person_id:e},headers:{Headers:{"Content-Type":"multipart/form-data"}}}),getEntschuldigungenByPersonID:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/getEntschuldigungenByPersonID",params:{person_id:t}}),getAnwesenheitSumByLva:(t,e,n)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/getAnwesenheitSumByLva",params:{lv_id:t,sem_kz:e,id:n}}),getAnwesenheitenByLva:(t,e,n,i)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/ProfilApi/getAllAnwesenheitenByStudentByLva",params:{sem_kurzbz:t,lv_id:e,prestudent_id:n,uid:i}})},L={getAktuellesSemester:()=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getAktuellesSemester"}),getViewDataStudent:()=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getViewDataStudent"}),getEntschuldigungFile:t=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/Profil/getEntschuldigungFile",params:{dms_id:t}}),getStunden:()=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getStunden"}),getStudiensemester:()=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getStudiensemester"}),getStudentInfo:(t,e,n)=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getStudentInfo",params:{prestudent_id:t,lva_id:e,sem_kurzbz:n}}),getStudiengaenge:(t=[],e)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getStudiengaenge",params:{allowed_stg:t,admin:e}}),getLektorsForLvaInSemester:(t,e)=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getLektorsForLvaInSemester",params:{lva_id:t,sem:e}}),getStudentsForLvaInSemester:(t,e)=>({method:"get",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getStudentsForLvaInSemester",params:{lva_id:t,sem:e}}),getLvViewDataInfo:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/InfoApi/getLvViewDataInfo",params:{lv_id:t}})};const R={name:"StudentByLvaComponent",components:{CoreBaseLayout:$,CoreFilterCmpt:b,CoreNavigationCmpt:w},data(){return{tabulatorUuid:Vue.ref(0),appSideMenuEntries:{},headerMenuEntries:{},tableBuiltPromise:null,cellEditing:null,anwesenheitenByStudentByLvaTabulatorOptions:{height:this.$entryParams?.tabHeights?.studentByLva??400,index:"datum",layout:"fitDataStretch",placeholder:this.$p.t("global/noDataAvailable"),selectableCheck:this.selectableCheck,rowFormatter:this.unselectableFormatter,debugInvalidComponentFuncs:!1,selectable:!0,columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",titleFormatterParams:{rowRange:"active"},headerSort:!1,frozen:!0,width:70},{title:this.$capitalize(this.$p.t("global/datum")),field:"datum",headerFilter:!0,formatter:A.formDateOnly,widthGrow:1},{title:this.$capitalize(this.$p.t("global/status")),field:"status",formatter:this.anwesenheitFormatterValue,widthGrow:1,minWidth:150},{title:this.$capitalize(this.$p.t("global/anteilAnw")),field:"anteil",bottomCalcFormatter:this.sumBottomCalcFormatter,bottomCalc:this.anwCalc,formatter:this.percentFormatter},{title:this.$capitalize(this.$p.t("ui/von")),field:"von",formatter:A.dateOnlyTimeFormatter,widthGrow:1},{title:this.$capitalize(this.$p.t("global/bis")),field:"bis",formatter:A.dateOnlyTimeFormatter,widthGrow:1},{title:this.$capitalize(this.$p.t("global/lehreinheit_id")),field:"lehreinheit_id",widthGrow:1,visible:!1},{title:this.$capitalize(this.$p.t("global/kontrolle")+" "+this.$p.t("global/insertvon")),field:"kinsertvon",widthGrow:1,visible:!1},{title:this.$capitalize(this.$p.t("global/kontrolle")+" "+this.$p.t("global/updatevon")),field:"kupdatevon",widthGrow:1,visible:!1},{title:this.$capitalize(this.$p.t("global/anwUserEntry")+" "+this.$p.t("global/insertvon")),field:"ainsertvon",widthGrow:1,visible:!1},{title:this.$capitalize(this.$p.t("global/anwUserEntry")+" "+this.$p.t("global/updatevon")),field:"aupdatevon",widthGrow:1,visible:!1},{title:this.$capitalize(this.$p.t("global/einheiten")),field:"dauer",visible:!1,bottomCalc:this.einheitenCalc,formatter:this.einheitenFormatter,widthGrow:1,minWidth:250},{title:this.$capitalize(this.$p.t("global/notiz")),field:"notiz",editor:"input",tooltip:!1,minWidth:150}],persistence:{sort:!1,filter:!0,headerFilter:!1,group:!0,page:!0,columns:!0},persistenceID:this.$entryParams.patchdate+"-lektorDetailViewStudentByLva"},anwesenheitenByStudentByLvaTabulatorEventHandlers:[{event:"rowSelected",handler:()=>{this.selected++}},{event:"rowDeselected",handler:()=>{this.selected--}},{event:"cellEditing",handler:t=>{const e=t.getData();this.cellEditing={...e}}},{event:"cellEdited",handler:t=>{const e=t.getData();null===this.cellEditing?.notiz&&""===e?.notiz||this.$api.call(x.updateAnwesenheiten(this.$entryParams.selected_le_id.value,[e])).then(t=>{"success"===t.meta.status&&this.$fhcAlert.alertSuccess(this.$p.t("global/anwNotizUpdated"))}),this.cellEditing=null}},{event:"tableBuilt",handler:async()=>{await this.$entryParams.phrasenPromise,this.tableBuiltResolve()}}],filterTitle:"",filterSubtitle:"",changedData:[],tableData:null,initialTableData:null,vorname:null,nachname:null,semester:null,verband:null,gruppe:null,sum:"",foto:null,selected:0}},emits:["titleSet","anwesenheitenUpdated"],props:{permissions:[],id:null,lv_id:null,sem_kz:null},methods:{percentFormatter:function(t){const e=t.getData();return'<div style="display: flex; justify-content: center; align-items: center; height: 100%">'+(e.sum??e.anteil??"-")+" %</div>"},anwCalc(){return this.sum+" %"},sumBottomCalcFormatter(t){const e=Number.parseFloat(t.getValue());if(Number.isNaN(e))return t.getValue();if(e<100*this.$entryParams.permissions.positiveRatingThreshold){t.getElement().style.setProperty("color","red")}return t.getValue()},einheitenCalc(t){return this.formatMinutes(t.reduce((t,e)=>e+t,0))},selectableCheck(t){return t.getData().status!==this.$entryParams?.permissions?.entschuldigt_status},formatMinutes(t){let e=t/60/this.$entryParams.permissions.einheitDauer;return e%1>0&&(e=e.toFixed(2).replace(".",",")),t+" "+this.$p.t("global/minuten")+" / "+e+" "+this.$p.t("global/einheiten")},einheitenFormatter:function(t){const e=Number(t.getValue());return'<div style="display: flex; justify-content: center; align-items: center; height: 100%">'+this.formatMinutes(e)+"</div>"},unselectableFormatter(t){t.getData().status===this.$entryParams.permissions.entschuldigt_status&&t.getElement().children[0]?.children[0]?.remove()},setRowStatus(t,e,n){if(t.getData().status===n||t.getData().status===this.$entryParams.permissions.entschuldigt_status)return;const i={anwesenheit_user_id:t.getData().anwesenheit_user_id,datum:t.getData().datum,status:n};this.handleChange(i),e.update(i)},handleChange(t){const e=this.changedData.findIndex(e=>e.datum===t.datum);e>=0?this.changedData.splice(e,1):this.changedData.push(t)},formAction:function(t){const e=document.createElement("div");e.className="d-flex gap-3";const n=document.createElement("button");n.className="btn btn-outline-secondary",n.innerHTML='<i class="fa fa-check"></i>',n.addEventListener("click",()=>this.setRowStatus(t,t.getRow(),this.$entryParams.permissions.anwesend_status)),e.append(n);const i=document.createElement("button");return i.className="btn btn-outline-secondary",i.innerHTML='<i class="fa fa-xmark"></i>',i.addEventListener("click",()=>this.setRowStatus(t,t.getRow(),this.$entryParams.permissions.abwesend_status)),e.append(i),e},async saveChanges(t){this.$api.call(x.updateAnwesenheiten(this.$entryParams.selected_le_id.value,t)).then(t=>{"success"===t.meta.status?(this.$fhcAlert.alertSuccess(this.$p.t("global/anwUserUpdateSuccess")),this.$emit("anwesenheitenUpdated")):this.$fhcAlert.alertError(this.$p.t("global/errorAnwUserUpdate")),this.$api.call(z.getAnwesenheitSumByLva(this.lv_id,this.sem_kz,this.id)).then(t=>{if("success"===t.meta.status&&t.data){this.sum=t.data[0].sum;this.$entryParams.lektorState.students.find(t=>t.prestudent_id===this.prestudent_id&&t.person_id===this.person_id).sum=this.sum,this.$refs.anwesenheitenByStudentByLvaTable.tabulator.recalc(),this.setFilterTitle()}})})},setSelectedRowsAnwesend(){const t=this.$refs.anwesenheitenByStudentByLvaTable.tabulator.getSelectedData(),e=this.$refs.anwesenheitenByStudentByLvaTable.tabulator.getSelectedRows(),n=[],i=[];t.forEach((t,a)=>{if(t.status!==this.$entryParams.permissions.entschuldigt_status||t.status===this.$entryParams.permissions.anwesend_status){const s={anwesenheit_user_id:t.anwesenheit_user_id,datum:t.datum,status:this.$entryParams.permissions.anwesend_status,notiz:t.notiz};e[a].update(s),n.push(s),i.push(e[a])}}),this.saveChanges(n),i.forEach(t=>t.toggleSelect())},async setSelectedRowsAbwesend(){const t=this.$refs.anwesenheitenByStudentByLvaTable.tabulator.getSelectedData(),e=this.$refs.anwesenheitenByStudentByLvaTable.tabulator.getSelectedRows(),n=[],i=[];t.forEach((t,a)=>{if(t.status!==this.$entryParams.permissions.entschuldigt_status||t.status===this.$entryParams.permissions.abwesend_status){const s={anwesenheit_user_id:t.anwesenheit_user_id,datum:t.datum,status:this.$entryParams.permissions.abwesend_status};e[a].update(s),n.push(s),i.push(e[a])}}),this.saveChanges(n),i.forEach(t=>t.toggleSelect())},setFilterTitle(){this.filterTitle=this.vorname+" "+this.nachname+" "+this.semester+this.verband+this.gruppe+" ",this.filterSubtitle=this.$p.t("global/summe")+": "+this.sum+" %",this.$emit("titleSet",this.filterTitle)},routeToLandingPage(){this.$router.push({name:"LandingPage"})},anwesenheitFormatterValue(t){const e=t.getValue();return e===this.$entryParams.permissions.anwesend_status?(t.getElement().style.color="#28a745",'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><i class="fa fa-check"></i></div>'):e===this.$entryParams.permissions.abwesend_status?(t.getElement().style.color="#dc3545",'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><i class="fa fa-xmark"></i></div>'):e===this.$entryParams.permissions.entschuldigt_status?(t.getElement().style.color="#0335f5",'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><i class="fa-solid fa-user-shield"></i></div>'):"-"},handleUuidDefined(t){this.tabulatorUuid=t},tableResolve(t){this.tableBuiltResolve=t},async setupMounted(){this.tableBuiltPromise||(this.tableBuiltPromise=new Promise(this.tableResolve),await this.tableBuiltPromise),this.$api.call(x.getAllAnwesenheitenByStudentByLva(this.id,this.lv_id,this.sem_kz)).then(t=>{if("success"!==t.meta.status||!t.data)return[];{const e=t?.data?.retval??[],n=e.reduce((t,e)=>t+e.dauer,0);e.forEach(t=>{t.anteil=(t.dauer/n*100).toFixed(2)}),this.tableData=t.data.retval,this.initialTableData=[...t.data.retval],this.$refs.anwesenheitenByStudentByLvaTable.tabulator.setData(t.data.retval)}}),this.$api.call(L.getStudentInfo(this.id,this.lv_id,this.sem_kz)).then(t=>{"success"===t.meta.status&&t.data&&(this.prestudent_id=t.data[0].prestudent_id,this.person_id=t.data[0].person_id,this.vorname=t.data[0].vorname,this.nachname=t.data[0].nachname,this.semester=t.data[0].semester,this.verband=t.data[0].verband,this.gruppe=t.data[0].gruppe,this.sum=t.data[0].sum,this.foto=t.data[0].foto,this.$refs.anwesenheitenByStudentByLvaTable.tabulator.recalc(),this.setFilterTitle())})},isLowResolution(t){const e=new Image;return e.src=t,e.width<150||e.height<200},calculateTableHeight(){const t=this.tabulatorUuid?"-"+this.tabulatorUuid:"",e=document.getElementById("filterTableDataset"+t);if(!e)return;const n=e.getBoundingClientRect(),i=this.$entryParams.isInFrame?window.frameElement.clientHeight:window.visualViewport.height;this.$entryParams.tabHeights.studentByLva.value=i-n.top-100,this.$refs.anwesenheitenByStudentByLvaTable.tabulator&&this.$refs.anwesenheitenByStudentByLvaTable.tabulator.redraw(!0)},load(){this.setupMounted()}},mounted(){window.addEventListener("resize",this.calculateTableHeight),window.addEventListener("orientationchange",this.calculateTableHeight)},unmounted(){window.removeEventListener("resize",this.calculateTableHeight),window.removeEventListener("orientationchange",this.calculateTableHeight)},computed:{dataChanged(){return this.changedData.length},getTooltipObj(){return{value:this.$p.t("global/tooltipStudentByLva"),class:"custom-tooltip"}}},template:'\n\t\t<div class="row">\n\t\t\t<div class="col-10" style="mx-width: 80%">\n\t\t\t\t<core-filter-cmpt\n\t\t\t\t\tref="anwesenheitenByStudentByLvaTable"\n\t\t\t\t\ttitle=""\n\t\t\t\t\t@uuidDefined="handleUuidDefined"\n\t\t\t\t\t:tabulator-options="anwesenheitenByStudentByLvaTabulatorOptions"\n\t\t\t\t\t:tabulator-events="anwesenheitenByStudentByLvaTabulatorEventHandlers"\n\t\t\t\t\t:tableOnly="true"\n\t\t\t\t\t:sideMenu="false" \n\t\t\t\t\tnoColumnFilter>\n\t\t\t\t\t<template #actions>\n\n\t\t\t\t\t\t<button @click="setSelectedRowsAnwesend" role="button" class="btn btn-success align-self-end" :disabled="!selected">\n\t\t\t\t\t\t\t{{ $capitalize($p.t(\'global/anwesend\')) }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button @click="setSelectedRowsAbwesend" role="button" class="btn btn-primary align-self-end" :disabled="!selected">\n\t\t\t\t\t\t\t{{ $capitalize($p.t(\'global/abwesend\')) }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div v-tooltip.bottom="getTooltipObj">\n\t\t\t\t\t\t\t<h5><i class="fa fa-circle-question"></i></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</core-filter-cmpt>\n\t\t\t</div>\n\t\t\t<div class="col-2">\n\t\t\t\t<img v-if="foto" :src="foto" :class="isLowResolution(foto) ? \'image-low-resolution\' : \'\'" style="width: 100%"/>\n\t\t\t</div>\n\t\t</div>'},O={name:"LektorComponent",components:{CoreBaseLayout:$,CoreFilterCmpt:b,CoreNavigationCmpt:w,BsModal:S,Divider:primevue.divider,TermineDropdown:P,LehreinheitenDropdown:D,MaUIDDropdown:C,KontrollenDropdown:k,AnwCountDisplay:E,datepicker:VueDatePicker,Statuslegende:F,KontrolleDisplay:T,StudentByLvaComponent:R},data(){return{showQRLoadingSpinner:!1,selectedStudent:null,kontrolleVonBis:null,editKontrolle:null,highlightMode:"allowed",selectedDateCount:0,externalModalContainer:null,externalWindow:null,tabulatorUuid:Vue.ref(0),stunden:null,loading:!1,tableBuiltResolve:null,tableBuiltPromise:null,lektorState:{students:[],studentsData:null,anwEntries:[],stsem:[],entschuldigtStati:[],kontrollen:[],viewData:[],dates:[],termine:[],showAllVar:!1,tableStudentData:[],beginn:null,ende:null,tabulatorCols:null,gruppen:null},kontrollZeitSourceStundenplanBeginn:!1,kontrollZeitSourceStundenplanEnde:!1,kontrollDatumSourceStundenplan:!1,anwesenheitenTabulatorOptions:{rowHeight:44,rowFormatter:this.entschuldigtColoring,height:this.$entryParams.tabHeights.lektor,index:"prestudent_id",debugInvalidComponentFuncs:!1,layout:"fitDataStretch",placeholder:this.$p.t("global/noDataAvailable"),columns:[{title:this.$capitalize(this.$p.t("global/foto")),field:"foto",formatter:A.fotoFormatter,visible:!0,minWidth:100,maxWidth:100,download:!1,tooltip:this.tooltipTableRow},{title:this.$capitalize(this.$p.t("global/prestudentID")),field:"prestudent_id",formatter:A.centeredFormatter,visible:!1,minWidth:150,download:!0,tooltip:this.tooltipTableRow},{title:this.$capitalize(this.$p.t("person/vorname")),field:"vorname",formatter:A.centeredFormatter,headerFilter:!0,widthGrow:1,minWidth:150,tooltip:this.tooltipTableRow},{title:this.$capitalize(this.$p.t("person/nachname")),field:"nachname",formatter:A.centeredFormatter,headerFilter:!0,widthGrow:1,minWidth:150,tooltip:this.tooltipTableRow},{title:this.$capitalize(this.$p.t("lehre/gruppe")),field:"gruppe",headerFilter:"list",tooltip:this.tooltipTableRow,headerFilterParams:{valuesLookup:!0,clearable:!0,autocomplete:!0},formatter:A.centeredFormatter,widthGrow:1,minWidth:100},{title:this.$capitalize(this.$p.t("global/datum")),field:"status",editor:"list",editorParams:{values:Vue.computed(()=>this.$entryParams.permissions.admin||this.$entryParams.permissions.assistenz?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status,this.$entryParams.permissions.entschuldigt_status]:this.$entryParams.permissions.lektor?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status]:void 0)},editable:this.checkCellEditability,formatter:this.anwesenheitFormatterValue,hozAlign:"center",widthGrow:1,tooltip:this.tooltipTableRow,minWidth:150},{title:this.$capitalize(this.$p.t("global/summe")),field:"sum",formatter:this.percentFormatter,widthGrow:1,minWidth:150,tooltip:this.tooltipTableRow}],persistence:{sort:!1,filter:!0,headerFilter:!1,group:!0,page:!0,columns:!1},persistenceID:this.$entryParams.patchdate+"-lektorOverviewLe"},anwesenheitenTabulatorEventHandlers:[{event:"cellClick",handler:async(t,e)=>{const n=e.getColumn().getField(),i=e.getRow(),a=Reflect.get(i.getData(),"prestudent_id");if("gruppe"===n||"foto"===n||"prestudent_id"===n||"vorname"===n||"nachname"===n||"sum"===n){if(this.changedData.length&&!1===await this.$fhcAlert.confirm({message:"Ungespeicherte Änderungen werden verloren!",acceptLabel:"Verwerfen und Fortfahren",acceptClass:"btn btn-danger",rejectLabel:"Zurück",rejectClass:"btn btn-outline-secondary"}))return;this.changes||(this.$entryParams.lektorState=this.lektorState),this.selectedStudent={id:a,lv_id:this.lv_id,sem_kz:this.sem_kurzbz,title:""},Vue.nextTick(()=>{this.$refs.studentByLva.load(),this.$refs.modalContainerStudentByLva.show()})}}},{event:"cellEdited",handler:async t=>{const e=t.getRow(),n=Reflect.get(e.getData(),"prestudent_id");this.changeAnwStatus(t,n);const i=t.getElement();this.changedData.find(t=>t.prestudent_id===n)?i.style.backgroundColor="#E0BBE4":i.style.backgroundColor=null}},{event:"tableBuilt",handler:async()=>{this.tableBuiltResolve()}}],boundRegenerateQR:null,boundProgressCounter:null,changedData:[],deleteData:null,selectedDate:new Date(Date.now()),qr:null,url:null,code:null,timerIDPolling:null,progressTimerID:null,regenerateProgress:0,progressMax:0,polling:!1,checkInCount:0,abwesendCount:0,entschuldigtCount:0,studentCount:0,changes:!1}},inject:{minDate:{type:Object},maxDate:{type:Object}},props:{permissions:[],translateOffset:{type:Number,default:60}},methods:{handleAutoApply(t){this.selectedDate=t,this.$refs.outsideDateSelect.closeMenu(),this.$refs.insideDateSelect&&this.$refs.insideDateSelect.closeMenu()},anwColTitleFormatter(t){const e=t.getColumn().getDefinition().title.split("|"),n=e[0].trimEnd().split("-"),i=n[2]+"."+n[1]+"."+n[0],a=document.createElement("div");return a.style.textAlign="center",a.innerHTML=`<span style="font-weight: bold;">${i}</span><br><span style="color: gray;">${e[1]}</span>`,a},checkCellEditability:t=>"-"!==t.getValue(),tooltipTableRow(t,e,n){const i=document.createElement("div"),a=e.getRow().getData(),s=document.createElement("p");return s.innerText=a.vorname+" "+a.nachname,i.appendChild(s),a?.entschuldigungen?.forEach(t=>{const e=document.createElement("p");e.innerText+=this.formatEntschuldigungZeit(t)+" Entschuldigung status: "+this.formatAkzeptiertStatus(t.akzeptiert)+"\n",i.appendChild(e)}),i},formatEntschuldigungZeit(t){const e=new Date(t.von),n=new Date(t.bis);return this.areDatesSame(e,n)?String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")+" - "+String(n.getHours()).padStart(2,"0")+":"+String(n.getMinutes()).padStart(2,"0"):e.getMonth()+1+"."+e.getDate()+" "+String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")+" - "+(n.getMonth()+1)+"."+n.getDate()+" "+String(n.getHours()).padStart(2,"0")+":"+String(n.getMinutes()).padStart(2,"0")},formatAkzeptiertStatus(t){let e="";return null===t?e="Offen":!0===t?e="Akzeptiert":!1===t&&(e="Abgelehnt"),e},percentFormatter:function(t){const e=t.getData(),n=e.sum??e.anteil??"-";return'<div style="display: flex;'+(n<100*this.$entryParams.permissions.positiveRatingThreshold?"color: red; ":"")+'justify-content: center; align-items: center; height: 100%">'+n+" %</div>"},anwesenheitFormatterValue(t){const e=t.getValue();return e===this.$entryParams.permissions.anwesend_status?(t.getElement().style.color="#28a745",'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><i class="fa fa-check"></i></div>'):e===this.$entryParams.permissions.abwesend_status?(t.getElement().style.color="#dc3545",'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><i class="fa fa-xmark"></i></div>'):e===this.$entryParams.permissions.entschuldigt_status?(t.getElement().style.color="#0335f5",'<div style="display: flex; justify-content: center; align-items: center; height: 100%"><i class="fa-solid fa-user-shield"></i></div>'):"-"},anwTooltip(t,e){const n=e.getValue();let i="";return n===this.$entryParams.permissions.anwesend_status?i=this.$capitalize(this.$p.t("global/anwesend")):n===this.$entryParams.permissions.abwesend_status?i=this.$capitalize(this.$p.t("global/abwesend")):n===this.$entryParams.permissions.entschuldigt_status&&(i=this.$capitalize(this.$p.t("global/entschuldigt"))),i},getExistingQRCode(){this.$api.call(x.getExistingQRCode(this.$entryParams.selected_le_id.value)).then(t=>{t.data.svg&&this.showQR(t.data)})},pollAnwesenheit(){this.$api.call(x.pollAnwesenheiten(this.anwesenheit_id,this.lv_id)).then(t=>{this.checkInCount=t.data.anwesend,this.abwesendCount=t.data.abwesend,this.entschuldigtCount=t.data.entschuldigt})},startPollingAnwesenheiten(){this.timerIDPolling=setInterval(this.boundPollAnwesenheit,3e3)},stopPollingAnwesenheiten(){clearInterval(this.timerIDPolling),this.timerIDPolling=null},handleKontrolleChanged(t){this.deleteData=t},handleShowAllToggle(){this.lektorState.dates.length?(this.loading=!0,this.toggleShowAll(),this.loading=!1):this.$fhcAlert.alertInfo(this.$p.t("global/anwInfoKeineKontrollenGefunden"))},async setAllColsAndData(){this.selectedDateCount=this.lektorState.dates.length,this.$refs.anwesenheitenTable.tabulator.clearSort(),this.$refs.anwesenheitenTable.tabulator.setColumns(this.lektorState.tabulatorCols),this.$refs.anwesenheitenTable.tabulator.setData(this.lektorState.tableStudentData)},toggleShowAll(){this.lektorState.showAllVar?(this.$refs.anwesenheitenTable.tabulator.clearSort(),this.selectedDate=new Date(this.selectedDate),this.lektorState.showAllVar=!1):this.setShowAll()},setShowAll(){const t=this.anwesenheitenTabulatorOptions.columns.slice(0,5);this.lektorState.dates.forEach(e=>{t.push({title:e,field:e,editor:"list",editorParams:{values:Vue.computed(()=>this.$entryParams.permissions.admin||this.$entryParams.permissions.assistenz?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status,this.$entryParams.permissions.entschuldigt_status]:this.$entryParams.permissions.lektor?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status]:void 0)},editable:this.checkCellEditability,formatter:this.anwesenheitFormatterValue,titleFormatter:this.anwColTitleFormatter,hozAlign:"center",widthGrow:1,tooltip:this.tooltipTableRow,minWidth:150})}),t.push(this.anwesenheitenTabulatorOptions.columns[6]),this.lektorState.tableStudentData=this.setupAllData(t),this.lektorState.tabulatorCols=t,this.setAllColsAndData(),this.lektorState.showAllVar=!0},setupAllData(){const t=[];return this.lektorState.students.forEach(e=>{const n=this.lektorState.entschuldigtStati.filter(t=>t.person_id===e.person_id),i=e.nachname+e.zusatz,a={prestudent_id:e.prestudent_id,foto:e.foto,vorname:e.vorname,nachname:i,entschuldigungen:n,gruppe:e.semester+e.verband+e.gruppe,sum:e.sum};this.lektorState.studentsData.get(e.prestudent_id).forEach(t=>{const e=t.datum+" | "+t.von+" - "+t.bis;a[e]=t.status}),t.push(a)}),t},areDatesSame(t,e){const n=t.getDate(),i=e.getDate(),a=t.getMonth(),s=e.getMonth(),r=t.getFullYear(),l=e.getFullYear();return n===i&&a===s&&r===l},wait:t=>new Promise(e=>setTimeout(e,t)),formatQRTime(t){const e=t.von.split(" "),n=e[0].split("-");return n[2]+"."+n[1]+"."+n[0]+" | "+e[1]+" - "+t.bis.split(" ")[1]},showQR(t){this.qr=t.svg,this.url=t.url,this.code=t.code,this.kontrolleVonBis=this.formatQRTime(t.kontrolle),this.checkInCount=t.count.anwesend,this.abwesendCount=t.count.abwesend,this.entschuldigtCount=t.count.entschuldigt,this.anwesenheit_id=t.anwesenheit_id,this.$refs.modalContainerQR.show(),this.$entryParams.permissions.useRegenerateQR&&this.startRegenerateQR(),this.startPollingAnwesenheiten()},getNewQRCode(){const t={year:this.selectedDate.getFullYear(),month:this.selectedDate.getMonth()+1,day:this.selectedDate.getDate()};this.$api.call(x.getNewQRCode(this.$entryParams.selected_le_id.value,t,this.lektorState.beginn,this.lektorState.ende)).then(t=>{t.data&&(this.showQRLoadingSpinner=!1,this.changes=!0,this.$refs.modalContainerNewKontrolle.hide(),this.showQR(t.data))}).finally(()=>{this.showQRLoadingSpinner=!1})},handleTerminChanged(){this.setTimespanForKontrolleTermin(this.$entryParams.selected_termin.value)},regenerateQR(){this.$api.call(x.regenerateQRCode(this.anwesenheit_id)).then(async t=>{const e=this.code;this.qr=t.data.svg,this.url=t.data.url,this.code=t.data.code,await this.wait(5e3),this.$api.call(x.degenerateQRCode(this.anwesenheit_id,e))})},progressCounter(){this.regenerateProgress===this.progressMax&&this.regenerateQR(),this.regenerateProgress>=this.progressMax&&(this.regenerateProgress=0),this.regenerateProgress++},async saveChanges(){const t=new Set(this.changedData.map(t=>t.prestudent_id));this.$api.call(x.updateAnwesenheiten(this.$entryParams.selected_le_id.value,this.changedData)).then(e=>{"success"===e.meta.status?this.$fhcAlert.alertSuccess(this.$p.t("global/anwUserUpdateSuccess")):this.$fhcAlert.alertError(this.$p.t("global/errorAnwUserUpdate"));const n=[...t];this.changedData.forEach(t=>{const e=this.lektorState.studentsData.get(t.prestudent_id),n=e?.find(e=>e.anwesenheit_user_id==t.anwesenheit_user_id);if(n){const e=n.status;n.status=t.status;const i=this.lektorState.kontrollen.find(e=>e.anwesenheit_id==t.anwesenheit_id);i[e]--,i[t.status]++}}),this.$api.call(x.getAnwQuoteForPrestudentIds(n,this.$entryParams.lv_id,this.$entryParams.sem_kurzbz)).then(t=>{this.updateSumData(t.data.retval),this.changes=!0})}).finally(()=>{this.changedData=[],this.setCurrentCountsFromTableData()})},startRegenerateQR(){this.progressTimerID=setInterval(this.boundProgressCounter,this.progressTimerInterval)},stopRegenerateQR(){const t=this.code;clearInterval(this.progressTimerID),this.progressTimerID=null,this.regenerateProgress=0,this.qr=null,this.url=null,this.code=null,this.$api.call(x.degenerateQRCode(this.anwesenheit_id,t))},handleChangeDatum(t){const e=t=>String(t).padStart(2,"0"),n=e(t.getMonth()+1),i=e(t.getDate()),a=t.getFullYear()+"-"+n+"-"+i,s=this.$entryParams.available_termine.value.find(t=>t.datum==a);this.kontrollDatumSourceStundenplan=!!s},handleChangeEnde(t){const e=t=>String(t).padStart(2,"0"),n=`${e(t.hours)}:${e(t.minutes)}:${e(t.seconds)}`,i=this.$entryParams.available_termine.value.find(t=>t.ende==n);this.kontrollZeitSourceStundenplanEnde=!!i},handleChangeBeginn(t){const e=t=>String(t).padStart(2,"0"),n=`${e(t.hours)}:${e(t.minutes)}:${e(t.seconds)}`,i=this.$entryParams.available_termine.value.find(t=>t.beginn==n);this.kontrollZeitSourceStundenplanBeginn=!!i},queryOnlyKontrolleShown(){const t=this.selectedDate.getFullYear(),e=this.selectedDate.getMonth(),n=this.selectedDate.getDate(),i=this.lektorState.kontrollen.find(i=>{const a=i.jsDate.getFullYear(),s=i.jsDate.getMonth(),r=i.jsDate.getDate();return t===a&&e===s&&n===r});i&&this.$api.call(x.pollAnwesenheiten(i.anwesenheit_id,this.lv_id)).then(t=>{this.checkInCount=t.data.anwesend,this.abwesendCount=t.data.abwesend,this.entschuldigtCount=t.data.entschuldigt})},setTimespanForKontrolleNow(){const t=new Date;this.lektorState.beginn={hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()},this.lektorState.ende={hours:t.getHours()+1,minutes:t.getMinutes(),seconds:t.getSeconds()}},setTimespanForKontrolleTermin(t,e=!0){e&&(this.selectedDate=new Date(t.datum),this.kontrollDatumSourceStundenplan=!0);const n=new Date("1995-10-16 "+t.beginn),i=new Date("1995-10-16 "+t.ende);this.lektorState.beginn={hours:n.getHours(),minutes:n.getMinutes(),seconds:n.getSeconds()},this.kontrollZeitSourceStundenplanBeginn=!0,this.kontrollDatumSourceStundenplan=(t.isSameDay||e)??!1,this.lektorState.ende={hours:i.getHours(),minutes:i.getMinutes(),seconds:i.getSeconds()},this.kontrollZeitSourceStundenplanEnde=!0},startNewAnwesenheitskontrolle(){if(this.lektorState.beginn&&this.lektorState.ende){if(!this.validateTimespan(this.lektorState.beginn,this.lektorState.ende,this.selectedDate))return!1;this.showQRLoadingSpinner=!0,this.qr="",this.getNewQRCode()}else this.$fhcAlert.alertError(this.$p.t("global/errorAnwStartAndEndSet"))},insertAnwWithoutQR(){if(!this.lektorState.beginn||!this.lektorState.ende)return void this.$fhcAlert.alertError(this.$p.t("global/errorAnwStartAndEndSet"));if(!this.validateTimespan(this.lektorState.beginn,this.lektorState.ende,this.selectedDate))return!1;const t={year:this.selectedDate.getFullYear(),month:this.selectedDate.getMonth()+1,day:this.selectedDate.getDate()};this.$refs.modalContainerNewKontrolle.hide(),this.loading=!0,this.$api.call(x.insertAnwWithoutQR(this.$entryParams.selected_le_id.value,t,this.lektorState.beginn,this.lektorState.ende)).then(t=>{const e=this.formatDateToDbString(this.selectedDate),n=this.$entryParams.selected_maUID.value?.mitarbeiter_uid??this.ma_uid;this.reloadState(n,e),this.changes=!0,this.showQR(t.data)})},stopAnwesenheitskontrolle(){this.externalWindow&&this.externalWindow.close(),this.$refs.modalContainerQR.hide(),this.stopPollingAnwesenheiten(),this.qr=null,this.url=null,this.code=null;const t=this.formatDateToDbString(this.selectedDate),e=this.$entryParams.selected_maUID.value?.mitarbeiter_uid??this.ma_uid;this.reloadState(e,t),this.$api.call(x.deleteQRCode(this.anwesenheit_id,this.lv_id)).then(t=>{"success"===t.meta.status&&t.data?this.$fhcAlert.alertSuccess(this.$p.t("global/anwKontrolleBeendet")):this.$fhcAlert.alertError(this.$p.t("global/errorDeleteQRCode")),this.$entryParams.permissions.useRegenerateQR&&this.stopRegenerateQR()})},reloadState(t,e){this.loading=!0,this.$api.call(x.fetchAllAnwesenheitenByLvaAssigned(this.lv_id,this.sem_kurzbz,this.$entryParams.selected_le_id.value,t,e)).then(t=>{"success"===t.meta.status&&this.setupData(t.data)}).catch(()=>{this.$refs.anwesenheitenTable?.tabulator&&this.$refs.anwesenheitenTable.tabulator.setData([])}).finally(()=>{this.loading=!1})},updateSumData(t){t.forEach(t=>{this.lektorState.students.find(e=>e.prestudent_id===t.prestudent_id).sum=t.sum;this.lektorState.tableStudentData.find(e=>e.prestudent_id===t.prestudent_id).sum=t.sum}),this.$refs.anwesenheitenTable.tabulator.clearSort(),this.$refs.anwesenheitenTable.tabulator.setData(this.lektorState.tableStudentData)},openEditModal(){this.$refs.modalContainerEditKontrolle.show()},openLegend(){this.$refs.modalContainerLegende.show()},async deleteAnwesenheitskontrolle(t){if(!1===await this.$fhcAlert.confirmDelete())return;const e=t.datum.split("."),n=new Date(e[2],e[1]-1,e[0]),i={year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()},a=this.$entryParams.selected_maUID.value?.mitarbeiter_uid??this.ma_uid,s=e[2]+"-"+e[1]+"-"+e[0];this.$api.call(x.deleteAnwesenheitskontrolle(this.$entryParams.selected_le_id.value,i,t.anwesenheit_id)).then(t=>{"success"===t.meta.status&&t.data?(this.$fhcAlert.alertSuccess(this.$p.t("global/deleteAnwKontrolleConfirmation")),this.reloadState(a,s)):"success"!==t.meta.status||t.data||this.$fhcAlert.alertWarning(this.$p.t("global/noAnwKontrolleFoundToDelete"))})},editAnwesenheitskontrolle(t){const e=t.von.split(":");t.editVon={hours:e[0],minutes:e[1],seconds:e[2]};const n=t.bis.split(":");t.editBis={hours:n[0],minutes:n[1],seconds:n[2]},null===this.editKontrolle?this.editKontrolle=t:this.editKontrolle=null},formatDateToDbString:t=>new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().split("T")[0],formatZusatz(t,e){let n="";const i=new Date(e.von),a=new Date(e.bis);return"Incoming"===t.studienstatus&&(n=" (i)"),(t.bisio_id&&"Incoming"!==t.studienstatus&&t.bis>i&&t.von<a&&(t.bis.getTime()-t.von.getTime())/1e3*3600*24>=30||t.bisio_id&&"Incoming"!==t.studienstatus&&t.von&&t.von>i)&&(n=" (o) (ab "+t.von+")"),!1===t.lkt_ueberschreibbar&&(n=" ("+t.anmerkung+")"),null!==t.mitarbeiter_uid&&(n=" (ma)"),t.stg_kz_student==this.lektorState.a_o_kz&&(n=" (a.o.)"),t.mobilitaetstyp_kurzbz&&1===t.doubledegree&&(n=" (d.d.","Intern"==t.ddtype?n+="i.)":"Extern"==t.ddtype?n+="o.)":n+=")"),n},linkKontrollData(){this.lektorState.kontrollen.forEach(t=>{t.sumAnw=0,t.anw=0,t.abw=0,t.ent=0,t.groupSet=new Set}),this.lektorState.anwEntries.forEach(t=>{const e=this.lektorState.kontrollen.find(e=>e.anwesenheit_id===t.anwesenheit_id);e.sumAnw++,t.status===this.$entryParams.permissions.anwesend_status?e.anw++:t.status===this.$entryParams.permissions.abwesend_status?e.abw++:t.status===this.$entryParams.permissions.entschuldigt_status&&e.ent++})},setEntries(t,e){t.forEach(t=>{const n=e.find(e=>e.anwesenheit_id===t.anwesenheit_id);this.lektorState.studentsData.get(t.prestudent_id).push({datum:t.datum,status:t.status,anwesenheit_user_id:t.anwesenheit_user_id,anwesenheit_id:t.anwesenheit_id,von:n?.von,bis:n?.bis});const i=t.datum+" | "+n.von+" - "+n.bis;this.lektorState.dates.indexOf(i)<0&&this.lektorState.dates.push(i)}),this.lektorState.dates.sort((t,e)=>t.split("|")>e.split("|")?1:t<e?-1:0)},async setupLektorComponent(){if(this.$entryParams.available_termine.value.forEach(t=>{const e=t.datum.split("-");t.datumFrontend=e[2]+"."+e[1]+"."+e[0]}),this.$entryParams.available_termine.value.length){const t=this.$entryParams.findClosestTermin(this.$entryParams.available_termine.value),e=new Date(t.datum),n=this.selectedDate.getDate()===e.getDate()&&this.selectedDate.getMonth()===e.getMonth&&this.selectedDate.getFullYear()===e.getFullYear();t.isSameDay=n,this.setTimespanForKontrolleTermin(t,!0),this.$entryParams.available_termine.value.forEach(t=>this.lektorState.dates.push(t.datum))}else this.setTimespanForKontrolleNow();this.lektorState.dates=[],this.lektorState.studentsData=new Map,this.lektorState.students.forEach(t=>{t.zusatz=this.formatZusatz(t,this.lektorState.stsem),this.lektorState.studentsData.set(t.prestudent_id,[])}),this.setEntries(this.lektorState.anwEntries,this.lektorState.kontrollen);const t=this.determineDates(),e=this.buildColsForDates(t),n=this.anwesenheitenTabulatorOptions.columns.slice(0,5);this.lektorState.dates.forEach(t=>{n.push({title:t,field:t,editor:"list",editorParams:{values:Vue.computed(()=>this.$entryParams.permissions.admin||this.$entryParams.permissions.assistenz?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status,this.$entryParams.permissions.entschuldigt_status]:this.$entryParams.permissions.lektor?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status]:void 0)},editable:this.checkCellEditability,formatter:this.anwesenheitFormatterValue,titleFormatter:this.anwColTitleFormatter,hozAlign:"center",widthGrow:1,tooltip:this.tooltipTableRow,minWidth:150})}),n.push(this.anwesenheitenTabulatorOptions.columns[6]),this.lektorState.tableStudentData=this.setupAllData(n),this.studentCount=this.lektorState.students.length,this.lektorState.showAllVar?this.setShowAll():(this.anwesenheitenTabulatorOptions.columns[0].title=this.$capitalize(await this.$p.t("global/foto")),this.anwesenheitenTabulatorOptions.columns[1].title=this.$capitalize(await this.$p.t("global/prestudentID")),this.anwesenheitenTabulatorOptions.columns[2].title=this.$capitalize(await this.$p.t("person/vorname")),this.anwesenheitenTabulatorOptions.columns[3].title=this.$capitalize(await this.$p.t("person/nachname")),this.anwesenheitenTabulatorOptions.columns[4].title=this.$capitalize(await this.$p.t("lehre/gruppe")),this.anwesenheitenTabulatorOptions.columns[6].title=this.$capitalize(await this.$p.t("global/summe")),this.lektorState.tabulatorCols=e,this.$refs.anwesenheitenTable.tabulator.clearSort(),this.$refs.anwesenheitenTable.tabulator.setColumns(e),this.$refs.anwesenheitenTable.tabulator.setData(this.lektorState.tableStudentData)),this.loading=!1},setCurrentCountsFromTableData(){1===this.selectedDateCount&&this.queryOnlyKontrolleShown()},setupLektorState(){function t(t,e){const n=new URL(window.location);n.searchParams.set(t,e),window.history.replaceState({},"",n)}this.lektorState.students=this.$entryParams.lektorState.students,this.lektorState.anwEntries=this.$entryParams.lektorState.anwEntries,this.lektorState.stsem=this.$entryParams.lektorState.stsem,this.lektorState.entschuldigtStati=this.$entryParams.lektorState.entschuldigtStati,this.lektorState.kontrollen=this.$entryParams.lektorState.kontrollen,this.lektorState.viewData=this.$entryParams.lektorState.viewData,this.lektorState.a_o_kz=this.$entryParams.lektorState.a_o_kz,this.lektorState.gruppen=new Set,t("stg_kz",this.$entryParams.stg_kz),t("sem",this.$entryParams.sem),t("lvid",this.$entryParams.lv_id),t("sem_kurzbz",this.$entryParams.sem_kurzbz),this.$entryParams.lektorState=null,this.setupLektorComponent()},setupData(t){this.lektorState.students=t[0]??[],this.lektorState.anwEntries=t[1]??[],this.lektorState.stsem=t[2][0]??[],this.lektorState.entschuldigtStati=t[3]??[],this.lektorState.kontrollen=t[4]??[],this.lektorState.kontrollen.forEach(t=>{const e=t.datum.split(".");t.jsDate=new Date(e[2],e[1]-1,e[0])}),this.lektorState.viewData=t[5]??[],this.$entryParams.available_termine.value=this.getAvailableTermine(),this.lektorState.a_o_kz=t[7]??[],this.lektorState.gruppen=new Set,this.setupLektorComponent()},getAvailableTermine(){return this.$entryParams.allLeTermine&&this.$entryParams.allLeTermine[this.$entryParams.selected_le_id.value]?this.$entryParams.allLeTermine[this.$entryParams.selected_le_id.value]??[]:(this.$fhcAlert.alertError("Keine Termine gefunden"),[])},async maUIDchangedHandler(){this.$refs.anwesenheitenTable.tabulator.clearSort(),this.$emit("maUIDChanged"),this.handleLEChanged()},openNewAnwesenheitskontrolleModal(){this.$refs.modalContainerNewKontrolle.show()},changeAnwStatus(t,e){const n=t.getValue();if(void 0===n)return;let i=t.getColumn().getField();"status"===i&&(i=this.formatDateToDbString(this.selectedDate));const a=this.lektorState.studentsData.get(e),s=JSON.parse(JSON.stringify(a)).find(t=>t.datum+" | "+t.von+" - "+t.bis===i),r=s?.anwesenheit_user_id,l=s?.anwesenheit_id,o={prestudent_id:e,date:i,status:n,anwesenheit_user_id:r,anwesenheit_id:l};this.handleChange(o)},handleChange(t){const e=this.lektorState.studentsData.get(t.prestudent_id).find(e=>Reflect.get(e,"datum")+" | "+Reflect.get(e,"von")+" - "+Reflect.get(e,"bis")===t.date),n=this.changedData.findIndex(e=>e.prestudent_id===t.prestudent_id&&e.date===t.date);n>=0&&this.changedData.splice(n,1),t.status!==e.status&&this.changedData.push(t)},validateTimespan(t,e,n,i=null){const a=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.hours,t.minutes,t.seconds),s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),e.hours,e.minutes,e.seconds);if(s<=a)return this.$fhcAlert.alertError(this.$p.t("global/errorValidateTimes")),!1;if(s>a){const t=(s-a)/6e4,e=60*(this.$entryParams.permissions.einheitDauer??.75);if(t<e)return this.$fhcAlert.alertError(this.$p.t("global/kontrollDauerUnterMindestwert",[e])),!1}let r=null;r=null!==i?this.lektorState.kontrollen.filter(t=>t.anwesenheit_id!==i&&t.jsDate.getFullYear()===n.getFullYear()&&t.jsDate.getMonth()===n.getMonth()&&t.jsDate.getDate()===n.getDate()):this.lektorState.kontrollen.filter(t=>t.jsDate.getFullYear()===n.getFullYear()&&t.jsDate.getMonth()===n.getMonth()&&t.jsDate.getDate()===n.getDate());const l=r.length;for(let t=0;t<l;t++){const e=r[t],i=e.von.split(":"),l=e.bis.split(":"),o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),i[0],i[1],i[2]);if(a<new Date(n.getFullYear(),n.getMonth(),n.getDate(),l[0],l[1],l[2])&&s>o)return this.$fhcAlert.alertError(this.$p.t("global/kontrolleTimeOverlap",[e.von,e.bis])),!1}return!this.kontrollDatumSourceStundenplan&&this.selectedDate<=this.minDate?(this.$fhcAlert.alertError(this.$p.t("global/kontrolleDatumOutOfRange")),!1):!(this.selectedDate>this.maxDate)||(this.$fhcAlert.alertError(this.$p.t("global/kontrolleDatumOutOfRange")),!1)},tableResolve(t){this.tableBuiltResolve=t},async setupMounted(){this.loading=!0,this.tableBuiltPromise=new Promise(this.tableResolve),await this.$entryParams.setupPromise,await this.tableBuiltPromise,this.boundPollAnwesenheit=this.pollAnwesenheit.bind(this),this.boundRegenerateQR=this.regenerateQR.bind(this),this.boundProgressCounter=this.progressCounter.bind(this),this.progressMax=this.$entryParams.permissions.regenerateQRTimer/10,this.progressTimerInterval=10,this.getExistingQRCode();const t=this.formatDateToDbString(this.selectedDate),e=this.$entryParams.selected_maUID.value?.mitarbeiter_uid??this.ma_uid;this.reloadState(e,t)},handleLEChanged(){this.$refs.showAllTickbox.checked=!1,this.lektorState.showAllVar=!1;const t=this.formatDateToDbString(this.selectedDate),e=this.$entryParams.selected_maUID.value?.mitarbeiter_uid??this.ma_uid;this.reloadState(e,t),this.getExistingQRCode()},downloadCSV(){this.$refs.anwesenheitenTable.tabulator.download("csv",this.getCSVFilename,{bom:!0})},handleUuidDefined(t){this.tabulatorUuid=t},redrawTable(){this.$refs.anwesenheitenTable?.tabulator&&this.$refs.anwesenheitenTable.tabulator.redraw(!0)},entschuldigtColoring:function(t){const e=t.getData();if(!e.entschuldigungen?.length)return;const n=e.entschuldigungen.filter(t=>{const e=new Date(t.von),n=new Date(t.bis);return e<=this.selectedDate&&n>=this.selectedDate});let i=null;n.forEach(t=>{!0===t.akzeptiert&&(i=!0)}),i?t.getElement().style.color="#0335f5":n.length&&(t.getElement().style.color="#12d5d5")},togglePopOut(){if(this.externalWindow)this.externalWindow.close();else{this.externalWindow=window.open("","","width=1000,height=1000");const t=document.createElement("div");t.id="externalModalContainer",t.style.setProperty("min-width","100%"),t.style.setProperty("min-height","100%"),this.externalModalContainer=t;const e=document.getElementById("qrwrap");t.appendChild(e),this.externalWindow.document.body.appendChild(t);for(const t of document.head.querySelectorAll("style, link[rel=stylesheet]")){const e=t.cloneNode(!0);this.externalWindow.document.head.appendChild(e)}this.externalWindow.addEventListener("beforeunload",()=>{this.handleCloseExternalWindow()})}},handleCloseExternalWindow(){const t=this.externalWindow.document.getElementById("qrwrap");document.getElementById("lektorWrap").appendChild(t),this.externalWindow.close(),this.externalWindow=null,this.externalModalContainer=null},checkForBetreuungAndAlert(){const t=this.$entryParams.permissions.alert_lehrform.find(t=>t.lehrform_kurzbz===this.$entryParams.selected_le_info?.value?.lehrform_kurzbz);if(t){const e="German"===this.$entryParams.permissions.lang?t.german_alert_text:t.english_alert_text;this.$fhcAlert.alertWarning(e)}},calculateTableHeight(){const t=this.tabulatorUuid?"-"+this.tabulatorUuid:"",e=document.getElementById("filterTableDataset"+t);if(!e)return;const n=e.getBoundingClientRect(),i=this.$entryParams.isInFrame?window.frameElement.clientHeight:window.visualViewport.height;this.$entryParams.tabHeights.lektor.value=i-n.top,this.$refs.anwesenheitenTable.tabulator&&this.$refs.anwesenheitenTable.tabulator.redraw(!0)},determineDates(){const t=this.formatDateToDbString(this.selectedDate),e=t.split("-");e[2],e[1],e[0];return this.lektorState.dates.filter(e=>e.startsWith(t))},buildColsForDates(t){const e=this.anwesenheitenTabulatorOptions.columns.slice(0,5);return t.forEach(t=>{e.push({title:t,field:t,editor:"list",editorParams:{values:Vue.computed(()=>this.$entryParams.permissions.admin||this.$entryParams.permissions.assistenz?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status,this.$entryParams.permissions.entschuldigt_status]:this.$entryParams.permissions.lektor?[this.$entryParams.permissions.anwesend_status,this.$entryParams.permissions.abwesend_status]:void 0)},editable:this.checkCellEditability,formatter:this.anwesenheitFormatterValue,titleFormatter:this.anwColTitleFormatter,hozAlign:"center",widthGrow:1,tooltip:this.tooltipTableRow,minWidth:150})}),e.push(this.anwesenheitenTabulatorOptions.columns[6]),this.selectedDateCount=t.length,e},restartKontrolle(t){const e=new Date(t.datum),n={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()};this.$api.call(x.restartKontrolle(t.anwesenheit_id,this.$entryParams.selected_le_id.value,n)).then(t=>{t.data?.svg&&(this.changes=!0,this.$refs.modalContainerEditKontrolle.hide(),this.showQR(t.data))})},updateKontrolle(){const t=this.editKontrolle.datum.split("."),e=this.$entryParams.selected_maUID.value?.mitarbeiter_uid??this.ma_uid,n=t[2]+"-"+t[1]+"-"+t[0];if(!this.validateTimespan(this.editKontrolle.editVon,this.editKontrolle.editBis,this.editKontrolle.jsDate,this.editKontrolle.anwesenheit_id))return!1;this.loading=!0,this.$api.call(x.updateKontrolle(this.editKontrolle.anwesenheit_id,this.editKontrolle.editVon,this.editKontrolle.editBis,this.$entryParams.selected_le_id.value)).then(t=>{if("success"===t.meta.status){this.$fhcAlert.alertSuccess(this.$p.t("ui/successSave"));const t=this.lektorState.kontrollen.find(t=>t.anwesenheit_id===this.editKontrolle.anwesenheit_id);t.von=this.editKontrolle.editVon.hours+":"+this.editKontrolle.editVon.minutes+":"+this.editKontrolle.editVon.seconds,t.bis=this.editKontrolle.editBis.hours+":"+this.editKontrolle.editBis.minutes+":"+this.editKontrolle.editBis.seconds,this.editKontrolle=null,this.$api.call(x.fetchAllAnwesenheitenByLvaAssigned(this.lv_id,this.sem_kurzbz,this.$entryParams.selected_le_id.value,e,n)).then(t=>{"success"===t.meta.status&&this.setupData(t.data)}).catch(()=>{this.$refs.anwesenheitenTable?.tabulator&&this.$refs.anwesenheitenTable.tabulator.setData([])}).finally(()=>{this.loading=!1})}})},openKontrolleInfo(){},handleTitleSet(t){this.selectedStudent.title=t},handleUpdateAnwesenheit(){const t=this.formatDateToDbString(this.selectedDate),e=this.$entryParams.selected_maUID.value?.mitarbeiter_uid??this.ma_uid;this.$api.call(x.fetchAllAnwesenheitenByLvaAssigned(this.lv_id,this.sem_kurzbz,this.$entryParams.selected_le_id.value,e,t)).then(t=>{"success"===t.meta.status&&this.setupData(t.data)}).catch(()=>{this.$refs.anwesenheitenTable?.tabulator&&this.$refs.anwesenheitenTable.tabulator.setData([])}).finally(()=>{this.loading=!1})}},created(){this.lv_id=this.$entryParams.lv_id,this.sem_kurzbz=this.$entryParams.sem_kurzbz,this.ma_uid=this.$entryParams.permissions.authID},mounted(){this.setupMounted(),this.calculateTableHeight(),window.addEventListener("resize",this.calculateTableHeight),window.addEventListener("orientationchange",this.calculateTableHeight)},unmounted(){window.removeEventListener("resize",this.calculateTableHeight),window.removeEventListener("orientationchange",this.calculateTableHeight),this.stopPollingAnwesenheiten()},watch:{selectedDate(t){if(""===t)return void(this.selectedDate=new Date(Date.now()));const e=this.determineDates(),n=this.buildColsForDates(e);this.setCurrentCountsFromTableData(),this.handleChangeDatum(this.selectedDate),this.lektorState.tabulatorCols=n,this.$refs.anwesenheitenTable.tabulator.clearSort(),this.$refs.anwesenheitenTable.tabulator.setColumns(n)},selectedDateCount(t,e){t==this.lektorState.kontrollen.length?(this.$refs.showAllTickbox.checked=!0,this.lektorState.showAllVar=!0):(this.$refs.showAllTickbox.checked=!1,this.lektorState.showAllVar=!1),1===t&&this.queryOnlyKontrolleShown()}},computed:{currentLEhasRightToSkipQR(){return!(!this.$entryParams.permissions.no_qr_lehrform||!this.$entryParams.permissions.no_qr_lehrform.length)&&(!!this.$entryParams.selected_le_info?.value&&this.$entryParams.permissions.no_qr_lehrform.includes(this.$entryParams.selected_le_info?.value?.lehrform_kurzbz))},getTitle(){return this.$entryParams.selected_le_info?.value?.infoString??""},getTabulatorStyle(){return"transform: translateY(-"+this.translateOffset+"px); overflow: hidden;"},getTooltipKontrolleLoeschen(){return{value:this.$p.t("global/tooltipLektorDeleteKontrolle",[this.$entryParams.permissions.kontrolleDeleteMaxReach]),class:"custom-tooltip"}},getTooltipKontrolleNeu(){return{value:this.$p.t("global/tooltipLektorStartKontrolleV4",[60*(this.$entryParams.permissions.einheitDauer??.75)]),class:"custom-tooltip"}},getTooltipZeitFromStundenplan(){return{value:this.$p.t("global/tooltipUnterrichtZeitCustomV2"),class:"custom-tooltip"}},getTooltipDatumFromStundenplan(){return{value:this.$p.t("global/tooltipUnterrichtDatumCustomV2"),class:"custom-tooltip"}},getTooltipLegende(){return{value:this.$p.t("global/tooltipLegende"),class:"custom-tooltip"}},getTooltipCsv(){return{value:this.$p.t("global/tooltipCsv"),class:"custom-tooltip"}},getTooltipEdit(){return{value:this.$p.t("global/tooltipEdit"),class:"custom-tooltip"}},getTooltipSaveChanges(){return{value:this.$p.t("global/tooltipSaveChanges"),class:"custom-tooltip"}},getTooltipRestartKontrolle(){return{value:this.$p.t("global/tooltipRestartKontrolle"),class:"custom-tooltip"}},getTooltipDeleteKontrolle(){return{value:this.$p.t("global/tooltipDeleteKontrolle"),class:"custom-tooltip"}},getTooltipEditKontrollzeiten(){return{value:this.$p.t("global/tooltipEditKontrollzeiten"),class:"custom-tooltip"}},getSaveBtnClass(){return this.changedData.length?"btn btn-primary ml-2":"btn btn-secondary ml-2"},getEditBtnClass(){return this.lektorState.kontrollen.length?"btn btn-success ml-2":"btn btn-secondary ml-2"},getCSVFilename(){let t=this.$entryParams.selected_le_info?.value?.csvInfoString??"";return t+="_"+this.$entryParams?.viewDataLv?.bezeichnung+"_",t+=this.lektorState.showAllVar?"AllDates":this.selectedDate.toDateString(),t},highlights(){const t=[];if("allowed"===this.highlightMode){const e=new Date(this.minDate);for(;e<=this.maxDate;)t.push(new Date(e)),e.setDate(e.getDate()+1);this.$entryParams.available_termine.value&&this.$entryParams.available_termine.value.forEach(e=>{t.push(new Date(e.datum))})}else"kontrollen"===this.highlightMode?this.lektorState.kontrollen.forEach(e=>{t.push(e.jsDate)}):"termine"===this.highlightMode&&this.$entryParams.available_termine.value&&this.$entryParams.available_termine.value.forEach(e=>{t.push(new Date(e.datum))});return t}},template:'\n\t\t<div v-show="loading" style="position: absolute; width: 100vw; height: 100vh; background: rgba(255,255,255,0.5); z-index: 8500;"></div>\n\t\t\n\t\t<core-base-layout>\t\t\t\n\t\t\t<template #main>\n\t\t\t\t<div id="lektorWrap">\n\t\t\t\t\n\t\t\t\t\t<bs-modal ref="modalContainerNewKontrolle" class="bootstrap-prompt" dialogClass="modal-xl">\n\t\t\t\t\t\t<template v-slot:title>\t\t\t\n\t\t\t\t\t\t\t<div v-tooltip.bottom="getTooltipKontrolleNeu">\n\t\t\t\t\t\t\t\t{{ $p.t(\'global/neueAnwKontrolle\') }}\n\t\t\t\t\t\t\t\t<i class="fa fa-circle-question"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-slot:default>\n\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t<div class="col-12">\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<h5>{{ $p.t(\'global/unterrichtzeit\') }}</h5>\n\t\t\t\t\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t\t\t\t\t<div class="col-3" style="align-items: center; justify-items: center;">\n\t\t\t\t\t\t\t\t\t\t\t<label for="beginn" class="form-label">{{ $p.t(\'global/anwKontrolleVon\') }}</label>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-4">\n\t\t\t\t\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\t\t\t\t\tv-model="lektorState.beginn"\n\t\t\t\t\t\t\t\t\t\t\t\t@update:model-value="handleChangeBeginn"\n\t\t\t\t\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t\t\t\t\t:time-picker="true"\n\t\t\t\t\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t\t\t\t\t:auto-apply="true">\n\t\t\t\t\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-5" v-show="!kontrollZeitSourceStundenplanBeginn" v-tooltip.bottom="getTooltipZeitFromStundenplan">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa-solid fa-triangle-exclamation"></i>\n\t\t\t\t\t\t\t\t\t\t\t<i style="margin-left: 4px;">{{ $p.t(\'global/zeitNichtAusStundenplanBeginnV2\') }}</i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="row align-items-center mt-2">\n\t\t\t\t\t\t\t\t\t\t<div class="col-3" style="align-items: center; justify-items: center;">\n\t\t\t\t\t\t\t\t\t\t\t<label for="von" class="form-label">{{ $capitalize($p.t(\'global/anwKontrolleBis\')) }}</label>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-4">\n\t\t\t\t\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\t\t\t\t\tv-model="lektorState.ende"\n\t\t\t\t\t\t\t\t\t\t\t\t@update:model-value="handleChangeEnde"\n\t\t\t\t\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t\t\t\t\t:time-picker="true"\n\t\t\t\t\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t\t\t\t\t:auto-apply="true">\n\t\t\t\t\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-5" v-show="!kontrollZeitSourceStundenplanEnde" v-tooltip.bottom="getTooltipZeitFromStundenplan">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa-solid fa-triangle-exclamation"></i>\n\t\t\t\t\t\t\t\t\t\t\t<i style="margin-left: 4px;">{{ $p.t(\'global/zeitNichtAusStundenplanEndeV2\') }}</i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="row mt-2">\n\t\t\t\t\t\t\t\t\t\t<div class="col-3 d-flex" style="height: 40px; align-items: start; justify-items: center;"><label for="datum" class="form-label">{{ $p.t(\'global/kontrolldatumV2\') }}</label></div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-4" style="height: 40px">\n\t\t\t\t\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\t\t\t\t\tref="insideDateSelect"\n\t\t\t\t\t\t\t\t\t\t\t\tv-model="selectedDate"\n\t\t\t\t\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t\t\t\t\tlocale="de"\n\t\t\t\t\t\t\t\t\t\t\t\tformat="dd.MM.yyyy"\n\t\t\t\t\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t\t\t\t\t@date-update="handleAutoApply"\n\t\t\t\t\t\t\t\t\t\t\t\t:highlight="highlights">\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<template #action-row>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="row" style="margin-left: 12px;">{{ $p.t(\'global/highlightsettings\') }}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="justify-content-center align-items-center flex-nowrap overflow-hidden" style="display: flex; height: 80px;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button role="button" class="col text-white option-entry text-center h-100 w-100 btn" :selected="highlightMode == \'termine\'" @click="highlightMode = \'termine\';">{{$p.t(\'global/termineV2\')}} </button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button role="button" class="col text-white option-entry text-center h-100 w-100 btn" :selected="highlightMode == \'kontrollen\'" @click="highlightMode = \'kontrollen\';">{{$p.t(\'global/kontrollen\')}}</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button role="button" class="col text-white option-entry text-center h-100 w-100 btn" :selected="highlightMode == \'allowed\'" @click="highlightMode = \'allowed\';">{{$p.t(\'global/allowed\')}}</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-5" v-show="!kontrollDatumSourceStundenplan" v-tooltip.bottom="getTooltipDatumFromStundenplan">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa-solid fa-triangle-exclamation"></i>\n\t\t\t\t\t\t\t\t\t\t\t<i style="margin-left: 4px;">{{ $p.t(\'global/datumNichtAusStundenplanV2\') }}</i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<Divider/>\n\t\t\t\t\t\t\t\t\t<div class="row align items center mt-8">\n\t\t\t\t\t\t\t\t\t\t<TermineDropdown ref="termineDropdown" @terminChanged="handleTerminChanged"></TermineDropdown>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-slot:footer>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<button v-if="currentLEhasRightToSkipQR" type="button" class="btn btn-primary" @click="insertAnwWithoutQR">{{ $p.t(\'global/kontrolleOhneQR\') }}</button>\n\t\t\t\t\t\t\t<button v-show="!showQRLoadingSpinner" :disabled="qr != null" type="button" class="btn btn-primary" @click="startNewAnwesenheitskontrolle">{{ $p.t(\'global/jetztStarten\') }}</button>\n\t\t\t\t\t\t\t<div v-show="showQRLoadingSpinner">\n\t\t\t\t\t\t\t\t<i class="fa-solid fa-spinner fa-pulse fa-3x"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</bs-modal>\n\t\t\t\t\t\n\t\t\t\t\t<bs-modal ref="modalContainerEditKontrolle" class="bootstrap-prompt"\n\t\t\t\t\tdialogClass="modal-xl">\n\t\t\t\t\t\t<template v-slot:title>\n\t\t\t\t\t\t\t\t{{ $p.t(\'global/editAnwKontrolle\') }}\n\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-slot:default>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<template v-for="kontrolle in lektorState.kontrollen">\n\n\t\t\t\t\t\t\t\t\t<div class="row p-2">\n\t\t\t\t\t\t\t\t\t\t<div class="col-5 d-flex align-items-center">\n\t\t\t\t\t\t\t\t\t\t\t<KontrolleDisplay :kontrolle="kontrolle"></KontrolleDisplay>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-4">\n\t\t\t\t\t\t\t\t\t\t\t<AnwCountDisplay :anwesend="kontrolle.anwesend" :abwesend="kontrolle.abwesend" :entschuldigt="kontrolle.entschuldigt"/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-3 d-flex justify-content-end">\n\t\t\t\t\t\t\t\t\t\t\t<button @click="restartKontrolle(kontrolle)" role="button" class="btn btn-secondary" v-tooltip.bottom="getTooltipRestartKontrolle">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-rotate-right"></i>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t<button style="margin-left: 12px;" @click="deleteAnwesenheitskontrolle(kontrolle)" role="button" class="btn btn-danger" v-tooltip.bottom="getTooltipDeleteKontrolle">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-trash"></i>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t<button style="margin-left: 12px;" @click="editAnwesenheitskontrolle(kontrolle)" role="button" class="btn btn-success" v-tooltip.bottom="getTooltipEditKontrollzeiten">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-pen"></i>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div v-if="editKontrolle && editKontrolle === kontrolle" class="row align-items-center p-4" style="border: 0px;">\n\t\t\t\t\t\t\t\t\t\t<div class="col-10">\n\t\t\t\t\t\t\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-3" style="align-items: center; justify-items: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label for="beginn" class="form-label">{{ $p.t(\'global/anwKontrolleVon\') }}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-9">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<datepicker v-if="editKontrolle"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-model="editKontrolle.editVon"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t@update:model-value="handleChangeBeginn"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:time-picker="true"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:auto-apply="true">\n\t\t\t\t\t\t\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t<div class="row align-items-center mt-2">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-3" style="align-items: center; justify-items: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label for="von" class="form-label">{{ $capitalize($p.t(\'global/anwKontrolleBis\')) }}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col-9">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<datepicker v-if="editKontrolle"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-model="editKontrolle.editBis"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t@update:model-value="handleChangeEnde"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:time-picker="true"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:auto-apply="true">\n\t\t\t\t\t\t\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t\t\t\t<button role="button" class="col text-white option-entry text-center w-100 btn" @click="updateKontrolle">Speichern</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<Divider/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</bs-modal>\t\t\n\t\n\t\t\t\t\t<bs-modal ref="modalContainerLegende" class="bootstrap-prompt" dialogClass="modal-lg">\n\t\t\t\t\t\t<template v-slot:title>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{{ $p.t(\'global/statusLegende\') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-slot:default>\n\t\t\t\t\t\t\t<Statuslegende></Statuslegende>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</bs-modal>\n\t\t\t\t\t\n\t\t\t\t\t<bs-modal ref="modalContainerStudentByLva" class="bootstrap-prompt" dialogClass="modal-xl" :allowFullscreenExpand="true">\n\t\t\t\t\t\t<template v-slot:title>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{{ selectedStudent?.title }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-slot:default>\n\t\t\t\t\t\t\t<StudentByLvaComponent ref="studentByLva" v-if="selectedStudent" \n\t\t\t\t\t\t\t\t@anwesenheitenUpdated="handleUpdateAnwesenheit"\n\t\t\t\t\t\t\t\t@titleSet="handleTitleSet"\n\t\t\t\t\t\t\t\t:id="selectedStudent.id" \n\t\t\t\t\t\t\t\t:lv_id="selectedStudent.lv_id"\n\t\t\t\t\t\t\t\t:sem_kz="selectedStudent.sem_kz"\n\t\t\t\t\t\t\t></StudentByLvaComponent>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</bs-modal>\n\t\t\t\t\t\n\t\t\t\t\t<div id="qrwrap">\n\t\t\t\t\t\t<bs-modal ref="modalContainerQR" class="bootstrap-prompt" dialogClass="modal-lg"  backdrop="static" \n\t\t\t\t\t\t :keyboard=false :noCloseBtn="true" :allowFullscreenExpand="true">\n\t\t\t\t\t\t\t<template v-slot:title>{{ $capitalize($p.t(\'global/kontrolle\')) }}: {{ kontrolleVonBis }}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-slot:default>\n\t\t\t\t\t\t\t\t<div id="qrcontent">\n\t\t\t\t\t\t\t\t\t<h1 class="text-center">Code: {{code}}</h1>\n\t\t\t\t\t\t\t\t\t<div v-html="qr" class="text-center"></div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<AnwCountDisplay :anwesend="checkInCount" :abwesend="abwesendCount" :entschuldigt="entschuldigtCount"/>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<div class="row" style="width: 80%; margin-left: 10%;">\n\t\t\t\t\t\t\t\t\t\t<progress \n\t\t\t\t\t\t\t\t\t\t\tv-if="$entryParams.permissions.useRegenerateQR"\n\t\t\t\t\t\t\t\t\t\t\t:max="progressMax"\n\t\t\t\t\t\t\t\t\t\t\t:value="regenerateProgress">\n\t\t\t\t\t\t\t\t\t\t</progress>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-slot:footer>\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-primary" @click="stopAnwesenheitskontrolle">{{ $capitalize($p.t(\'global/endAnwKontrolle\')) }}</button>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</bs-modal>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="row" id="lektorContentHeader" ref="lektorContentHeader">\n\t\t\t\t\t\n\t\t\t\t\t\t<div class="col-6">\t\t\t\t\n\t\t\t\t\t\t\t<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">\n\t\t\t\t\t\t\t\t<h1 class="h4">{{ $entryParams.selected_le_info?.value?.infoString ? getTitle : \'\' }}</h1>\n\t\t\t\t\t\t\t\t<h6>{{$entryParams.viewDataLv.bezeichnung}}</h6>\t\t\n\t\t\t\t\t\t\t\t<AnwCountDisplay  v-if="selectedDateCount == 1 & !lektorState?.showAllVar" :anwesend="checkInCount" :abwesend="abwesendCount" :entschuldigt="entschuldigtCount"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\n\t\t\t\t\t\t<div class="col-6">\n\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t<div class="col-5" v-if="$entryParams?.permissions?.admin" >\n\t\t\t\t\t\t\t\t\t<MaUIDDropdown  :title="$capitalize($p.t(\'lehre/lektor\') )" \n\t\t\t\t\t\t\t\t\t id="maUID" ref="MADropdown" @maUIDchanged="maUIDchangedHandler">\n\t\t\t\t\t\t\t\t\t</MaUIDDropdown>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div :class=" $entryParams?.permissions?.admin ? \'col-5\' : \'col-10\'">\n\t\t\t\t\t\t\t\t\t<LehreinheitenDropdown id="lehreinheit" :title="$capitalize($p.t(\'lehre/lehreinheit\'))" ref="LEDropdown" @leChanged="handleLEChanged">\n\t\t\t\t\t\t\t\t\t</LehreinheitenDropdown>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<div class="row mt-4">\n\t\t\n\t\t\t\t\t\t\t\t\t<div class="col-2" style="height: 40px; align-self: start;"><label for="datum" class="form-label">{{ $p.t(\'global/kontrolldatumV2\') }}</label></div>\n\t\t\t\t\t\t\t\t\t<div class="col-3" style="height: 40px;">\n\t\t\t\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\t\t\t\tref="outsideDateSelect"\n\t\t\t\t\t\t\t\t\t\t\tv-model="selectedDate"\n\t\t\t\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t\t\t\tlocale="de"\n\t\t\t\t\t\t\t\t\t\t\tformat="dd.MM.yyyy"\n\t\t\t\t\t\t\t\t\t\t\t@date-update="handleAutoApply"\n\t\t\t\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t\t\t\t:highlight="highlights">\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t<template #action-row>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="row" style="margin-left: 12px;">{{ $p.t(\'global/highlightsettings\') }}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="justify-content-center align-items-center flex-nowrap overflow-hidden" style="display: flex; height: 80px;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button role="button" class="col text-white option-entry text-center h-100 w-100 btn" :selected="highlightMode == \'termine\'" @click="highlightMode = \'termine\';">{{$p.t(\'global/termineV2\')}} </button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button role="button" class="col text-white option-entry text-center h-100 w-100 btn" :selected="highlightMode == \'kontrollen\'" @click="highlightMode = \'kontrollen\';">{{$p.t(\'global/kontrollen\')}}</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button role="button" class="col text-white option-entry text-center h-100 w-100 btn" :selected="highlightMode == \'allowed\'" @click="highlightMode = \'allowed\';">{{$p.t(\'global/allowed\')}}</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="col-5" style="height: 40px; align-items: center; display: flex;">\n\t\t\t\t\t\t\t\t\t\t<div class="row" style="width: 100%; align-items: center; justify-content: center;">\n\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox" style="max-width: 5%;" @click="handleShowAllToggle" id="all" ref="showAllTickbox">\n\t\t\t\t\t\t\t\t\t\t\t<label for="all" style="max-width: 90%;">{{ $p.t(\'global/showAllKontrollen\') }} | {{ selectedDateCount }} / {{ lektorState.kontrollen.length }}</label>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<core-filter-cmpt\n\t\t\t\t\t\ttitle=""\n\t\t\t\t\t\t@uuidDefined="handleUuidDefined"\n\t\t\t\t\t\tref="anwesenheitenTable"\n\t\t\t\t\t\t:tabulator-options="anwesenheitenTabulatorOptions"\n\t\t\t\t\t\t:tabulator-events="anwesenheitenTabulatorEventHandlers"\n\t\t\t\t\t\t:id-field="\'anwesenheiten_id\'"\n\t\t\t\t\t\t:tableOnly="true"\n\t\t\t\t\t\t:newBtnShow="true"\n\t\t\t\t\t\t:newBtnLabel="$p.t(\'global/neueAnwKontrolle\')"\n\t\t\t\t\t\t:newBtnDisabled="!lektorState.students.length"\n\t\t\t\t\t\t@click:new=openNewAnwesenheitskontrolleModal\n\t\t\t\t\t\t:sideMenu="false"\n\t\t\t\t\t\tnoColumnFilter>\n\t\t\t\t\t\t\t<template #actions>\n\t\t\t\t\t\t\t\t<button @click="saveChanges" :disabled="!changedData.length" role="button" :class="getSaveBtnClass" v-tooltip.bottom="getTooltipSaveChanges">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-save"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<button @click="openEditModal" :disabled="!lektorState.kontrollen.length" role="button" :class="getEditBtnClass" v-tooltip.bottom="getTooltipEdit">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-pen"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<button @click="downloadCSV" role="button" class="btn btn-secondary ml-2" v-tooltip.bottom="getTooltipCsv">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-file-csv"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<button @click="openLegend" role="button" class="btn btn-secondary ml-2" v-tooltip.bottom="getTooltipLegende">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-book"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t</core-filter-cmpt>\t\n\t\t\t\t</div>\n\n\t\t\t</template>\n\t\t</core-base-layout>'};var B={search(t,e){return this.$fhcApi.post("/api/frontend/v1/searchbar/search",t,e)},searchAdvanced(t,e){return this.$fhcApi.post("/api/frontend/v1/searchbar/searchAdvanced",t,e)},searchdummy(t){return this.$fhcApi.post("public/js/apps/api/dummyapi.php/Search",t)}},H={loadCategory(t){return this.$fhcApi.get("/api/frontend/v1/phrasen/loadModule/"+t)},setLanguage(t,e){const n={categories:t,language:e};return this.$fhcApi.post("/api/frontend/v1/phrasen/setLanguage",n)},getLanguage(){return this.$fhcApi.get("/api/frontend/v1/phrasen/getLanguage",{})},getActiveDbLanguages(){return this.$fhcApi.get("/api/frontend/v1/phrasen/getAllLanguages",{})}},M={getHeader(t){return this.$fhcApi.get("/api/frontend/v1/navigation/header",{navigation_page:t})},getMenu:function(t){return this.$fhcApi.get("/api/frontend/v1/navigation/menu",{navigation_page:t})}},V={saveCustomFilter(t){return this.$fhcApi.post("/api/frontend/v1/filter/saveCustomFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,customFilterName:t.customFilterName})},removeCustomFilter(t){return this.$fhcApi.post("/api/frontend/v1/filter/removeCustomFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId})},applyFilterFields(t){return this.$fhcApi.post("/api/frontend/v1/filter/applyFilterFields",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterFields:t.filterFields})},addFilterField(t){return this.$fhcApi.post("/api/frontend/v1/filter/addFilterField",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField})},removeFilterField(t){return this.$fhcApi.post("/api/frontend/v1/filter/removeFilterField",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField})},getFilterById(t){return this.$fhcApi.get("/api/frontend/v1/filter/getFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId})},getFilter(t){return this.$fhcApi.get("/api/frontend/v1/filter/getFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType})}},I={abmeldung:{getDetails(t,e){const n="/api/frontend/v1/studstatus/abmeldung/"+(void 0!==t?"getDetailsForAntrag/"+t:"getDetailsForNewAntrag/"+e);return this.$fhcApi.get(n)},create(t,e,n){return this.$fhcApi.post("/api/frontend/v1/studstatus/abmeldung/createAntrag",{studiensemester:t,prestudent_id:e,grund:n},{errorHandling:"strict"})},cancel(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/abmeldung/cancelAntrag",{antrag_id:t.studierendenantrag_id},{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/abmeldung/cancelAntrag",{antrag_id:t})}},unterbrechung:{getDetails(t,e){const n="/api/frontend/v1/studstatus/unterbrechung/"+(void 0!==t?"getDetailsForAntrag/"+t:"getDetailsForNewAntrag/"+e);return this.$fhcApi.get(n)},create(t,e,n,i,a){return this.$fhcApi.post("/api/frontend/v1/studstatus/unterbrechung/createAntrag",{studiensemester:t,prestudent_id:e,grund:n,datum_wiedereinstieg:i,attachment:a},{errorHandling:"strict"})},cancel(t){return this.$fhcApi.post("/api/frontend/v1/studstatus/unterbrechung/cancelAntrag",{antrag_id:t},{errorHandling:"strict"})}},wiederholung:{getDetails(t){const e="/api/frontend/v1/studstatus/wiederholung/getDetailsForNewAntrag/"+t;return this.$fhcApi.get(e)},getLvs(t){const e="/api/frontend/v1/studstatus/wiederholung/getLvs/"+t;return this.$fhcApi.get(e)},create(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/wiederholung/createAntrag",{prestudent_id:t,studiensemester:e},{errorHandling:"strict"})},cancel(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/wiederholung/cancelAntrag",{prestudent_id:t,studiensemester:e},{errorHandling:"strict"})},saveLvs(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/wiederholung/saveLvs",{forbiddenLvs:t,mandatoryLvs:e})}},leitung:{getStgs(){return this.$fhcApi.get("/api/frontend/v1/studstatus/leitung/getActiveStgs")},getAntraege(t,e,n){return this.$fhcApi.get("/api/frontend/v1/studstatus/leitung/getAntraege/"+t).then(t=>t.data)},getHistory(t){return this.$fhcApi.get("/api/frontend/v1/studstatus/leitung/getHistory/"+t)},getPrestudents(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/getPrestudents",{query:t},{signal:e,timeout:3e4})},approve(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveAntrag",t)},reject(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/rejectAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/rejectAntrag",t)},reopen(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/reopenAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/reopenAntrag",t)},pause(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/pauseAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/pauseAntrag",t)},unpause(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/unpauseAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/unpauseAntrag",t)},object(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/objectAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/objectAntrag",t)},approveObjection(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveObjection",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveObjection",t)},denyObjection(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/denyObjection",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/denyObjection",t)}}},j={getView:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/getView/${t}`,{})},fotoSperre:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/fotoSperre/${t}`,{})},isStudent:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/isStudent",{uid:t})},isMitarbeiter:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/isMitarbeiter/${t}`,{})},getZustellAdresse:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/getZustellAdresse",{})},getZustellKontakt:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/getZustellKontakt",{})},getGemeinden:function(t,e){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/getGemeinden/${t}/${e}`,{})},getAllNationen:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/getAllNationen",{})}},U={
//! API calls for profil update requests
getStatus:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/getStatus",{})},getTopic:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/getTopic",{})},acceptProfilRequest:function({profil_update_id:t,uid:e,status_message:n,topic:i,requested_change:a}){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/acceptProfilRequest",{profil_update_id:t,uid:e,status_message:n,topic:i,requested_change:a})},denyProfilRequest:function({profil_update_id:t,uid:e,topic:n,status_message:i}){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/denyProfilRequest",{profil_update_id:t,uid:e,topic:n,status_message:i})},insertFile:function(t,e=null){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/ProfilUpdate/insertFile/${e}`,t)},getProfilRequestFiles:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/ProfilUpdate/getProfilRequestFiles/${t}`,{})},selectProfilRequest:function(t=null,e=null){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/selectProfilRequest",{...t?{uid:t}:{},...e?{id:e}:{}})},insertProfilRequest:function(t,e,n=null){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/insertProfilRequest",{topic:t,payload:e,...n?{fileID:n}:{}})},updateProfilRequest:function(t,e,n,i=null){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/updateProfilRequest",{topic:t,payload:e,ID:n,...i?{fileID:i}:{}})},deleteProfilRequest:function(t){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/deleteProfilRequest",{requestID:t})}},N={getRoomInfo(t,e,n){return this.$fhcApi.post("/api/frontend/v1/LvPlan/getRoomplan",{ort_kurzbz:t,start_date:e,end_date:n})},getStunden(){return this.$fhcApi.get("/api/frontend/v1/LvPlan/Stunden",{})},getOrtReservierungen(t,e,n){return this.$fhcApi.post(`/api/frontend/v1/LvPlan/getReservierungen/${t}`,{start_date:e,end_date:n})},getLvPlanReservierungen(t,e){return this.$fhcApi.post("/api/frontend/v1/LvPlan/getReservierungen",{start_date:t,end_date:e})},getLehreinheitStudiensemester(t){return this.$fhcApi.get(`/api/frontend/v1/LvPlan/getLehreinheitStudiensemester/${t}`,{})},studiensemesterDateInterval(t){return this.$fhcApi.get(`/api/frontend/v1/LvPlan/studiensemesterDateInterval/${t}`,{})},LvPlanEvents(t,e,n){return this.$fhcApi.get("/api/frontend/v1/LvPlan/LvPlanEvents",{start_date:t,end_date:e,lv_id:n})}},J={verband:{get(){return this.$fhcApi.get("api/frontend/v1/stv/verband")},favorites:{get(){return this.$fhcApi.get("api/frontend/v1/stv/favorites")},set(t){return this.$fhcApi.post("api/frontend/v1/stv/favorites/set",{favorites:t})}}},students:{uid(t,e){let n="api/frontend/v1/stv/students/"+encodeURIComponent(e)+"/uid/"+encodeURIComponent(t);return this.$fhcApi.getUri(n)},prestudent(t,e){let n="api/frontend/v1/stv/students/"+encodeURIComponent(e)+"/prestudent/"+encodeURIComponent(t);return this.$fhcApi.getUri(n)},person(t,e){let n="api/frontend/v1/stv/students/"+encodeURIComponent(e)+"/person/"+encodeURIComponent(t);return this.$fhcApi.getUri(n)},verband(t){return this.$fhcApi.getUri("api/frontend/v1/stv/students/"+t)}},filter:{getStg(){return this.$fhcApi.get("api/frontend/v1/stv/filter/getStg")},setStg(t){return this.$fhcApi.post("api/frontend/v1/stv/filter/setStg",{studiengang_kz:t})}},konto:{tabulatorConfig(t,e){return t.ajaxURL="api/frontend/v1/stv/konto/get",t.ajaxParams=()=>({person_id:e.modelValue.person_id||e.modelValue.map(t=>t.person_id),only_open:e.filter,studiengang_kz:e.studiengang_kz_intern?e.stg_kz:""}),t.ajaxRequestFunc=(t,e,n)=>this.$fhcApi.post(t,n,e),t.ajaxResponse=(t,e,n)=>n.data,t},checkDoubles(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/konto/checkDoubles",e,{confirmErrorHandler:t=>!0})},insert(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/konto/insert",e)},counter(t){return this.$fhcApi.post("api/frontend/v1/stv/konto/counter",t)},edit(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/konto/update",e)},delete(t){return this.$fhcApi.post("api/frontend/v1/stv/konto/delete",{buchungsnr:t})},getBuchungstypen(){return this.$fhcApi.get("api/frontend/v1/stv/konto/getBuchungstypen")}},group:{getGruppen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/Gruppen/getGruppen/"+n.id)},deleteGroup(t){return this.$fhcApi.post("api/frontend/v1/stv/Gruppen/deleteGruppe/",t)}},kontakt:{getAdressen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getAdressen/"+n.id)},addNewAddress(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/addNewAddress/"+e,n)},loadAddress(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/loadAddress/",{address_id:t})},updateAddress(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/updateAddress/"+e,n)},deleteAddress(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/deleteAddress/",{address_id:t})},getPlaces(t){return this.$fhcApi.get("api/frontend/v1/stv/address/getPlaces/"+t)},getFirmen(t){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getFirmen/"+t)},getNations(){return this.$fhcApi.get("api/frontend/v1/stv/address/getNations/")},getAdressentypen(){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getAdressentypen/")},getBankverbindung(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getBankverbindung/"+n.id)},addNewBankverbindung(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/addNewBankverbindung/"+e,n)},loadBankverbindung(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/loadBankverbindung/",{bankverbindung_id:t})},updateBankverbindung(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/updateBankverbindung/"+e,n)},deleteBankverbindung(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/deleteBankverbindung/",{bankverbindung_id:t})},getKontakte(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getKontakte/"+n.id)},addNewContact(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/addNewContact/"+e,n)},loadContact(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/loadContact/",{kontakt_id:t})},updateContact(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/updateContact/"+e,n)},deleteContact(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/deleteContact/",{kontakt_id:t})},getStandorteByFirma(t){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getStandorteByFirma/"+t)},getKontakttypen(){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getKontakttypen/")}},prestudent:{get(t,e){return this.$fhcApi.post("api/frontend/v1/stv/prestudent/get/"+encodeURIComponent(t)+"/"+encodeURIComponent(e))},updatePrestudent(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/prestudent/updatePrestudent/"+e,n)},getBezeichnungZGV(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBezeichnungZGV/")},getBezeichnungMZgv(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBezeichnungMZgv/")},getBezeichnungDZgv(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBezeichnungDZgv/")},getStgs(){return this.$fhcApi.get("api/frontend/v1/stv/lists/getStgs/")},getAusbildung(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getAusbildung/")},getAufmerksamdurch(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getAufmerksamdurch/")},getBerufstaetigkeit(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBerufstaetigkeit/")},getTypenStg(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getTypenStg/")},getBisstandort(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBisstandort/")},getHistoryPrestudent(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/status/getHistoryPrestudent/"+n.id)},getMaxSem(t){return this.$fhcApi.post("api/frontend/v1/stv/status/getMaxSemester/",{studiengang_kzs:t})},advanceStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:i}){return this.$fhcApi.post("api/frontend/v1/stv/status/advanceStatus/"+t+"/"+e+"/"+n+"/"+i)},confirmStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:i}){return this.$fhcApi.post("api/frontend/v1/stv/status/confirmStatus/"+t+"/"+e+"/"+n+"/"+i)},isLastStatus(t){return this.$fhcApi.get("api/frontend/v1/stv/status/isLastStatus/"+t)},deleteStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:i}){return this.$fhcApi.post("api/frontend/v1/stv/status/deleteStatus/"+t+"/"+e+"/"+n+"/"+i)},getLastBismeldestichtag(){return this.$fhcApi.get("api/frontend/v1/stv/status/getLastBismeldestichtag/")},getHistoryPrestudents(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getHistoryPrestudents/"+n.id)}},status:{insertStatus(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/status/insertStatus/"+e,n)},loadStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:i}){return this.$fhcApi.post("api/frontend/v1/stv/status/loadStatus/"+t+"/"+e+"/"+n+"/"+i)},updateStatus(t,{prestudent_id:e,status_kurzbz:n,studiensemester_kurzbz:i,ausbildungssemester:a},s){return this.$fhcApi.post(t,"api/frontend/v1/stv/status/updateStatus/"+e+"/"+n+"/"+i+"/"+a,s)},getStudienplaene(t){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getStudienplaene/"+t)},getStudiengang(t){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getStudiengang/"+t)},getStatusgruende(){return this.$fhcApi.get("api/frontend/v1/stv/status/getStatusgruende/")},getStati(){return this.$fhcApi.get("api/frontend/v1/stv/lists/getStati/")},addStudent(t,e){return this.$fhcApi.post("api/frontend/v1/stv/status/addStudent/"+t,e,{errorHeader:t})},changeStatus(t,e){return this.$fhcApi.post("api/frontend/v1/stv/status/changeStatus/"+t,e,{errorHeader:t})},getStatusarray(){return this.$fhcApi.get("api/frontend/v1/stv/status/getStatusarray/")}},details:{get(t,e){let n="api/frontend/v1/stv/student/get/"+encodeURIComponent(t)+"/"+encodeURIComponent(e);return this.$fhcApi.post(n)},save(t,e,n,i){let a="api/frontend/v1/stv/student/save/"+encodeURIComponent(e)+"/"+encodeURIComponent(n);return this.$fhcApi.post(t,a,i)}},exam:{getPruefungen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getPruefungen/"+n.id)},loadPruefung(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/loadPruefung/"+t)},getTypenPruefungen(){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getTypenPruefungen")},getAllLehreinheiten(t){return this.$fhcApi.post("api/frontend/v1/stv/pruefung/getAllLehreinheiten/",t)},getLvsByStudent(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getLvsByStudent/"+t)},getLvsandLesByStudent(t,e){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getLvsandLesByStudent/"+t+"/"+e)},getLvsAndMas(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getLvsAndMas/"+t)},getMitarbeiterLv(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getMitarbeiterLv/"+t)},getNoten(){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getNoten")},checkZeugnisnoteLv(t){return this.$fhcApi.post("api/frontend/v1/stv/pruefung/checkZeugnisnoteLv/",t)},addPruefung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/pruefung/insertPruefung/",e)},updatePruefung(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/pruefung/updatePruefung/"+e,n)},deletePruefung(t){return this.$fhcApi.post("api/frontend/v1/stv/pruefung/deletePruefung/"+t)}},abschlusspruefung:{getAbschlusspruefung(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getAbschlusspruefung/"+n.id)},addNewAbschlusspruefung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/abschlusspruefung/insertAbschlusspruefung/",e)},loadAbschlusspruefung(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/loadAbschlusspruefung/",{id:t})},updateAbschlusspruefung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/abschlusspruefung/updateAbschlusspruefung/",e)},deleteAbschlusspruefung(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/deleteAbschlusspruefung/",{id:t})},getTypenAbschlusspruefung(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getTypenAbschlusspruefung/")},getTypenAntritte(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getTypenAntritte/")},getBeurteilungen(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getBeurteilungen/")},getAkadGrade(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/getAkadGrade/",{studiengang_kz:t})},getTypStudiengang(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/getTypStudiengang/",{studiengang_kz:t})},getMitarbeiter(t){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getMitarbeiter/"+t)},getPruefer(t){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getPruefer/"+t)},getNoten(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getNoten/")},checkForExistingExams(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/checkForExistingExams/",{uids:t})}},grades:{list(){return this.$fhcApi.get("api/frontend/v1/stv/grades/list")},getCertificate(t,e){let n="api/frontend/v1/stv/grades/getCertificate/"+encodeURIComponent(t);return e&&(n=n+"/"+encodeURIComponent(e)),this.$fhcApi.get(n)},getTeacherProposal(t,e){let n="api/frontend/v1/stv/grades/getTeacherProposal/"+encodeURIComponent(t);return e&&(n=n+"/"+encodeURIComponent(e)),this.$fhcApi.get(n)},getRepeaterGrades(t,e){let n="api/frontend/v1/stv/grades/getRepeaterGrades/"+encodeURIComponent(t);return e&&(n=n+"/"+encodeURIComponent(e)),this.$fhcApi.get(n)},updateCertificate({lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,note:i,lehrveranstaltung_bezeichnung:a}){return this.$fhcApi.post("api/frontend/v1/stv/grades/updateCertificate",{lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,note:i},{errorHeader:a})},deleteCertificate({lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,lehrveranstaltung_bezeichnung:i}){return this.$fhcApi.post("api/frontend/v1/stv/grades/deleteCertificate",{lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n},{errorHeader:i})},copyTeacherProposalToCertificate({lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,lehrveranstaltung_bezeichnung:i}){return this.$fhcApi.post("api/frontend/v1/stv/grades/copyTeacherProposalToCertificate",{lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n},{errorHeader:i})},copyRepeaterGradeToCertificate({studierendenantrag_lehrveranstaltung_id:t,lv_bezeichnung:e}){return this.$fhcApi.post("api/frontend/v1/stv/grades/copyRepeaterGradeToCertificate",{studierendenantrag_lehrveranstaltung_id:t},{errorHeader:e})},getGradeFromPoints(t,e,n,i){const a=i?{errorHandling:!1}:{};return this.$fhcApi.post("api/frontend/v1/stv/grades/getGradeFromPoints",{points:t,lehrveranstaltung_id:e,studiensemester_kurzbz:n},a)}},mobility:{getMobilitaeten(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getMobilitaeten/"+n.id)},getProgramsMobility(){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getProgramsMobility/")},addNewMobility(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/mobility/insertMobility/",e)},loadMobility(t){return this.$fhcApi.get("api/frontend/v1/stv/mobility/loadMobility/"+t)},updateMobility(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/mobility/updateMobility/",e)},deleteMobility(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/deleteMobility/"+t)},getLVList(t){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getLVList/"+t)},getAllLehreinheiten(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/getAllLehreinheiten/",t)},getLvsandLesByStudent(t){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getLvsandLesByStudent/"+t)},getPurposes(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getPurposes/"+n.id)},getSupports(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getSupports/"+n.id)},getListPurposes(){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getListPurposes/")},getListSupports(){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getListSupports/")},deleteMobilityPurpose(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/deleteMobilityPurpose/"+t.bisio_id,t)},addMobilityPurpose(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/addMobilityPurpose/"+t.bisio_id,t)},deleteMobilitySupport(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/deleteMobilitySupport/"+t.bisio_id,t)},addMobilitySupport(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/addMobilitySupport/"+t.bisio_id,t)}},archiv:{tabulatorConfig(t,e){return t.ajaxURL="api/frontend/v1/stv/archiv/get",t.ajaxParams=()=>({person_id:e.modelValue.person_id||e.modelValue.map(t=>t.person_id)}),t.ajaxRequestFunc=(t,e,n)=>this.$fhcApi.post(t,n,e),t.ajaxResponse=(t,e,n)=>n.data,t},getArchivVorlagen(){return this.$fhcApi.post("api/frontend/v1/stv/archiv/getArchivVorlagen")},archive(t){return this.$fhcApi.post("api/frontend/v1/documents/archive",t)},archiveSigned(t){return this.$fhcApi.post("api/frontend/v1/documents/archiveSigned",t)},update(t){return this.$fhcApi.post("api/frontend/v1/stv/archiv/update",t)},delete({akte_id:t,studiengang_kz:e}){return this.$fhcApi.post("api/frontend/v1/stv/archiv/delete",{akte_id:t,studiengang_kz:e})}},documents:{getDocumentsUnaccepted(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/getDocumentsUnaccepted/"+n.id+"/"+n.studiengang_kz)},getDocumentsAccepted(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/getDocumentsAccepted/"+n.id+"/"+n.studiengang_kz)},deleteZuordnung(t){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/deleteZuordnung/"+t.prestudent_id+"/"+t.dokument_kurzbz)},createZuordnung(t){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/createZuordnung/"+t.prestudent_id+"/"+t.dokument_kurzbz)},loadAkte(t){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/loadAkte/"+t)},getDoktypen(){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/getDoktypen/")},updateFile(t,e){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/updateAkte/"+t,e)},deleteFile(t){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/deleteAkte/"+t)},uploadFile(t,e){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/uploadDokument/"+t,e)}},exemptions:{getAnrechnungen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getAnrechnungen/"+n.id)},getLehrveranstaltungen(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getLehrveranstaltungen/"+t)},getBegruendungen(){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getBegruendungen/")},getLvsKompatibel(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getLvsKompatibel/"+t)},getLektoren(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getLektoren/"+t)},addNewAnrechnung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/anrechnungen/insertAnrechnung/",e)},loadAnrechnung(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/loadAnrechnung/"+t)},editAnrechnung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/anrechnungen/updateAnrechnung/",e)},deleteAnrechnung(t){return this.$fhcApi.post("api/frontend/v1/stv/anrechnungen/deleteAnrechnung/"+t)}},jointstudies:{getStudies(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStudien/"+n.id)},getTypenMobility(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getTypenMobility/")},getStudiensemester(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStudiensemester/")},getStudyprograms(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStudienprogramme/")},getListPartner(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getPartnerfirmen/")},getStatiPrestudent(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStatiPrestudent/")},loadStudy(t){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/loadStudie/"+t)},insertStudy(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/GemeinsameStudien/insertStudie/",e)},updateStudy(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/GemeinsameStudien/updateStudie/",e)},deleteStudy(t){return this.$fhcApi.post("api/frontend/v1/stv/GemeinsameStudien/deleteStudie/"+t)}},courselist:{getCourselist(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/LvTermine/getStundenplan/"+n.student_uid+"/"+n.start_date+"/"+n.end_date+"/"+n.group_consecutiveHours+"/"+n.dbStundenplanTable)},getStudiensemester(){return this.$fhcApi.get("api/frontend/v1/stv/LvTermine/getStudiensemester/")}},configStudent(){return this.$fhcApi.get("api/frontend/v1/stv/config/student")},configStudents(){return this.$fhcApi.get("api/frontend/v1/stv/config/students")}},G={person:{getNotizen(t,e,n){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/getNotizen/"+n.id+"/"+n.type)},getUid(){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/getUid/")},addNewNotiz(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/notiz/notizPerson/addNewNotiz/"+e,n)},loadNotiz(t){return this.$fhcApi.post("api/frontend/v1/notiz/notizPerson/loadNotiz/",{notiz_id:t})},loadDokumente(t){return this.$fhcApi.post("api/frontend/v1/notiz/notizPerson/loadDokumente/",{notiz_id:t})},deleteNotiz(t,e,n){return this.$fhcApi.post("api/frontend/v1/notiz/notizPerson/deleteNotiz/",{notiz_id:t,type_id:e,id:n})},updateNotiz(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/notiz/notizPerson/updateNotiz/"+e,n)},getMitarbeiter(t){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/getMitarbeiter/"+t)},isBerechtigt(t,e){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/isBerechtigt/")}}},K={person:{getAllBetriebsmittel(t,e,n){return this.$fhcApi.get("api/frontend/v1/betriebsmittel/betriebsmittelP/getAllBetriebsmittel/"+n.type+"/"+n.id)},addNewBetriebsmittel(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/betriebsmittel/betriebsmittelP/addNewBetriebsmittel/"+e,n)},loadBetriebsmittel(t){return this.$fhcApi.post("api/frontend/v1/betriebsmittel/betriebsmittelP/loadBetriebsmittel/"+t)},updateBetriebsmittel(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/betriebsmittel/betriebsmittelP/updateBetriebsmittel/"+e,n)},deleteBetriebsmittel(t){return this.$fhcApi.post("api/frontend/v1/betriebsmittel/betriebsmittelP/deleteBetriebsmittel/"+t)},getTypenBetriebsmittel(){return this.$fhcApi.get("api/frontend/v1/betriebsmittel/betriebsmittelP/getTypenBetriebsmittel/")},loadInventarliste(t){return this.$fhcApi.get("api/frontend/v1/betriebsmittel/betriebsmittelP/loadInventarliste/"+t)}}},q={updatePersonUnrulyStatus(t,e){try{const n={person_id:t,unruly:e},i="/api/frontend/v1/checkperson/CheckPerson/updatePersonUnrulyStatus";return this.$fhcApi.post(i,n,null)}catch(t){throw t}},filterPerson(t,e=""){try{const n=e+"/api/frontend/v1/checkperson/CheckPerson/filterPerson";return axios.post(n,t)}catch(t){throw t}}},W={getContentID(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Ort/ContentID",{ort_kurzbz:t})},getRooms(t,e,n,i,a=0){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Ort/getRooms",{datum:t,von:e,bis:n,typ:i,personenanzahl:a})},getRoomTypes(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Ort/getTypes")}},Q={content(t,e=null,n=null,i=null){return this.$fhcApi.get("/api/frontend/v1/Cms/content",{content_id:t,...e?{version:e}:{},...n?{sprache:n}:{},...i?{sichtbar:i}:{}})},getNews(t=1,e=10,n){return this.$fhcApi.get("/api/frontend/v1/Cms/getNews",{page:t,page_size:e,sprache:n})},news(t){return this.$fhcApi.get("/api/frontend/v1/Cms/news",{limit:t})},getNewsRowCount:function(){return this.$fhcApi.get("/api/frontend/v1/Cms/getNewsRowCount",{})},getNewsExtra:function(){return this.$fhcApi.get("/api/frontend/v1/Cms/getStudiengangInfoForNews",{})}},Y={getStudentenMail(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Lehre/lvStudentenMail",{lehreinheit_id:t})},getLvInfo(t,e){return this.$fhcApi.get(`/api/frontend/v1/Lehre/LV/${t}/${e}`,{})},getStudentPruefungen(t){return this.$fhcApi.get(`/api/frontend/v1/Lehre/Pruefungen/${t}`,{})},getStudentProjektarbeiten(t){return this.$fhcApi.get(`/api/frontend/v1/Lehre/getStudentProjektarbeiten/${t}`,{})},getStudentProjektabgaben(t){return this.$fhcApi.get("/api/frontend/v1/Lehre/getStudentProjektabgaben",{projektarbeit_id:t.projektarbeit_id,student_uid:t.student_uid})},postStudentProjektarbeitEndupload(t){return this.$fhcApi.post("/api/frontend/v1/Lehre/postStudentProjektarbeitEndupload",t,{Headers:{"Content-Type":"multipart/form-data"}})},postStudentProjektarbeitZwischenabgabe(t){return this.$fhcApi.post("/api/frontend/v1/Lehre/postStudentProjektarbeitZwischenabgabe",t,{Headers:{"Content-Type":"multipart/form-data"}})},getStudentProjektarbeitAbgabeFile(t,e){const n=`/Cis/Abgabetool/getStudentProjektarbeitAbgabeFile?paabgabe_id=${t}&student_uid=${e}`;window.location=FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+n},getMitarbeiterProjektarbeiten(t,e){return this.$fhcApi.get(`/api/frontend/v1/Lehre/getMitarbeiterProjektarbeiten?showall=${e}`,{})},postProjektarbeitAbgabe(t){const e={paabgabe_id:t.paabgabe_id,paabgabetyp_kurzbz:t.bezeichnung.paabgabetyp_kurzbz,datum:t.datum,fixtermin:t.fixtermin,insertvon:t.insertvon,kurzbz:t.kurzbz,projektarbeit_id:t.projektarbeit_id};return this.$fhcApi.post("/api/frontend/v1/Lehre/postProjektarbeitAbgabe",e,null)},deleteProjektarbeitAbgabe(t){const e={paabgabe_id:t};return this.$fhcApi.post("/api/frontend/v1/Lehre/deleteProjektarbeitAbgabe",e,null)},postSerientermin(t,e,n,i,a){const s={datum:t,paabgabetyp_kurzbz:e,bezeichnung:n,kurzbz:i,projektarbeit_ids:a};return this.$fhcApi.post("/api/frontend/v1/Lehre/postSerientermin",s,null)},fetchDeadlines(t){const e={person_id:t};return this.$fhcApi.post("/api/frontend/v1/Lehre/fetchDeadlines",e,null)}},Z={getLvMenu(t,e){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/LvMenu/getLvMenu/${t}/${e}`,{})}},X={person:{getMessages(t,e,n){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMessages/"+n.id+"/"+n.type+"/"+n.size+"/"+n.page)},getVorlagen(){return this.$fhcApi.get("api/frontend/v1/messages/messages/getVorlagen/")},getMsgVarsLoggedInUser(){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMsgVarsLoggedInUser/")},getMessageVarsPerson(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMessageVarsPerson/"+t.id+"/"+t.type_id)},getMsgVarsPrestudent(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMsgVarsPrestudent/"+t.id+"/"+t.type_id)},getPersonId(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getPersonId/"+t.id+"/"+t.type_id)},getUid(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getUid/"+t.id+"/"+t.type_id)},getVorlagentext(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getVorlagentext/"+t)},getNameOfDefaultRecipient(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getNameOfDefaultRecipient/"+t.id+"/"+t.type_id)},getPreviewText(t,e){return this.$fhcApi.post("api/frontend/v1/messages/messages/getPreviewText/"+t.id+"/"+t.type_id,e)},getReplyData(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getReplyData/"+t)},sendMessageFromModalContext(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/messages/messages/sendMessage/"+e,n)},sendMessage(t,e){return this.$fhcApi.post("api/frontend/v1/messages/messages/sendMessage/"+t,e)},deleteMessage(t){return this.$fhcApi.post("api/frontend/v1/messages/messages/deleteMessage/"+t)}}},tt={getVorlagen(){return this.$fhcApi.get("api/frontend/v1/vorlagen/vorlagen/getVorlagen/")},getVorlagenByLoggedInUser(){return this.$fhcApi.get("api/frontend/v1/vorlagen/vorlagen/getVorlagenByLoggedInUser/")}},et={getStudiensemester:function(){return this.$fhcApi.get("/components/Cis/Mylv/Studiensemester",{})},getAllStudienSemester:function(t=void 0,e=void 0,n=void 0,i=void 0){return this.$fhcApi.get("/api/frontend/v1/Studium/getStudienAllSemester",{studiensemester:t,studiengang:e,semester:n,studienplan:i})},getStudiengaengeForStudienSemester:function(t){return this.$fhcApi.get(`/api/frontend/v1/Studium/getStudiengaengeForStudienSemester/${t}`,{})},getStudienplaeneBySemester:function(t,e){return this.$fhcApi.get("/api/frontend/v1/Studium/getStudienplaeneBySemester",{studiengang:t,studiensemester:e})},getLvPlanForStudiensemester:function(t,e){return this.$fhcApi.get(`/api/frontend/v1/LvPlan/getLvPlanForStudiensemester/${t}/${e}`,{})},getLvEvaluierungInfo:function(t,e){return this.$fhcApi.get(`/api/frontend/v1/Studium/getLvEvaluierungInfo/${t}/${e}`,{})}},nt={search:B,phrasen:H,navigation:M,dashboard:{async getViewData(){return this.$fhcApi.get("/api/frontend/v1/Cis4FhcApi/getViewData",null,null)}},filter:V,studstatus:I,profil:j,profilUpdate:U,lvPlan:N,bookmark:{getBookmarks:function(){return this.$fhcApi.get("/api/frontend/v1/Bookmark/getBookmarks",{})},delete:function(t){return this.$fhcApi.get(`/api/frontend/v1/Bookmark/delete/${t}`,{})},update:function({bookmark_id:t,url:e,title:n,tag:i=null}){return this.$fhcApi.post(`/api/frontend/v1/Bookmark/update/${t}`,{url:e,title:n})},insert:function({url:t,title:e,tag:n}){return this.$fhcApi.post("/api/frontend/v1/Bookmark/insert",{url:t,title:e,tag:n})}},stv:J,notiz:G,betriebsmittel:K,checkperson:q,ampeln:{open:function(){return this.$fhcApi.get("/api/frontend/v1/Ampeln/open",{})},all:function(){return this.$fhcApi.get("/api/frontend/v1/Ampeln/all",{})},confirm:function(t){return this.$fhcApi.get(`/api/frontend/v1/Ampeln/confirm/${t}`,{})}},ort:W,cms:Q,lehre:Y,addons:Z,messages:X,vorlagen:tt,addons:Z,studiengang:{studiengangInformation:function(){return this.$fhcApi.get("/api/frontend/v1/Studgang/getStudiengangInfo",{})},getStudiengangByKz:function(t){return this.$fhcApi.get("/api/frontend/v1/organisation/StudiengangEP/getStudiengangByKz",{studiengang_kz:t})}},menu:{getMenu:function(){return this.$fhcApi.get("/api/frontend/v1/CisMenu/getMenu",{})}},authinfo:{getAuthUID(){return this.$fhcApi.get("/api/frontend/v1/AuthInfo/getAuthUID",{})},getAuthInfo(){return this.$fhcApi.get("/api/frontend/v1/AuthInfo/getAuthInfo",{})}},studium:et,language:{getAll(){return this.$fhcApi.get("/api/frontend/v1/language/get")}}},it={install:(t,e)=>{if(t.config.globalProperties.$fhcApi)return void(e?.factory&&(console.warn("$fhcApi is DEPRECATED!"),t.config.globalProperties.$fhcApi.factory.addEndpoints(e.factory)));function n(t,e,n,i){if("string"==typeof t&&void 0===i)[e,n,i]=[t,e,n],t=void 0;else if(t){if("object"!=typeof t)throw new TypeError("Parameter 1 of _get_config must be an object or a string");void 0===e&&void 0===n&&void 0===i&&(i=t,t=void 0)}if(t){if(!t.clearValidation||!t.setFeedback)throw new TypeError("'form' is not a Form Component");t={clearValidation:t.clearValidation,setFeedback:t.setFeedback},i?i.form=t:i={form:t}}return[e,n,i]}function i(t){const e=t.data;return delete t.data,e.meta?e.meta.response=t:e.meta={response:t},e}FHC_JS_DATA_STORAGE_OBJECT.app_root,FHC_JS_DATA_STORAGE_OBJECT.ci_router;const a=axios.create({timeout:5e5,baseURL:FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/"});a.interceptors.request.use(t=>{if("post"!=t.method||!t.data)return t;if(t.data instanceof FormData)return t;if(!Object.values(t.data).every(t=>!(t instanceof FileList)&&(!Array.isArray(t)||t.every(t=>!(t instanceof File))))){const e=Object.entries(t.data).reduce((t,[e,n])=>{if(n instanceof FileList)for(const i of n)t.FormData.append(e+(n.length>1?"[]":""),i);else Array.isArray(n)?n.every(t=>!(t instanceof File))?t.jsondata[e]=n:n.forEach(i=>t.FormData.append(e+(n.length>1?"[]":""),i)):t.jsondata[e]=n;return t},{FormData:new FormData,jsondata:{}});e.FormData.append("_jsondata",JSON.stringify(e.jsondata)),t.data=e.FormData}return t}),a.interceptors.response.use(e=>("off"==e.config?.errorHandling||!1===e.config?.errorHandling||"fail"==e.config?.errorHandling||e.data.errors&&(e.data.errors=e.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$fhcApi._defaultErrorHandlers[n.type])(n,e.config))),i(e)),e=>"ERR_CANCELED"==e.code?Promise.reject({handled:!0,...e}):"off"==e.config?.errorHandling||!1===e.config?.errorHandling||"success"==e.config?.errorHandling?Promise.reject(e):e.response?404==e.response.status?(t.config.globalProperties.$fhcAlert.alertDefault("error",e.message,e.request.responseURL,!0),Promise.reject({handled:!0,...e})):(e.response.data.errors=e.response.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$fhcApi._defaultErrorHandlers[n.type])(n,e.config)),e.response.data.errors.length?Promise.reject(e):Promise.reject({handled:!0,...e})):e.request?(t.config.globalProperties.$fhcAlert.alertDefault("error",e.message,e.request.responseURL),Promise.reject({handled:!0,...e})):(t.config.globalProperties.$fhcAlert.alertError(e.message),Promise.reject({handled:!0,...e}))),t.config.globalProperties.$fhcApi={getUri:t=>(console.warn("$fhcApi.getUri is DEPRECATED! Use $api.getUri instead."),a.getUri({url:t})),get:(t,e,i,s)=>(console.warn("$fhcApi.get is DEPRECATED! Use $api.get instead."),[e,i,s]=n(t,e,i,s),i&&(s?s.params=i:s={params:i}),a.get(e,s)),post:(t,e,i,s)=>(console.warn("$fhcApi.post is DEPRECATED! Use $api.post instead."),[e,i,s]=n(t,e,i,s),a.post(e,i,s)),_defaultErrorHandlers:{validation(e,n){const i=t.config.globalProperties.$fhcAlert;return n?.form?(n.form.clearValidation(),n.form.setFeedback(!1,e.messages),!1):Array.isArray(e.messages)?(e.messages.forEach(i.alertError),!1):"object"!=typeof e.messages||(n?.errorHeader?Object.values(e.messages).forEach(e=>i.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e,!0)):Object.entries(e.messages).forEach(([t,e])=>i.alertDefault("error",t,e,!0)),!1)},general(e,n){const i=t.config.globalProperties.$fhcAlert;n?.form?n.form.setFeedback(!1,e.message):n?.errorHeader?i.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e.message,!0):i.alertError(e.message)},php(e){const n=t.config.globalProperties.$fhcAlert;var i="";switch(i+="Message: "+e.message+"\n\n",i+="Filename: "+e.filename+"\n",i+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(i+="\nBacktrace: ",e.backtrace.forEach(t=>{i+="\n\tFile: "+t.file+"\n",i+="\tLine: "+t.line+"\n",i+="\tFunction: "+t.function+"\n"})),e.severity){case"Warning":case"Core Warning":case"Compile Warning":case"User Warning":n.alertDefault("warn","PHP "+e.severity,i,!0);break;case"Notice":case"User Notice":case"Runtime Notice":n.alertDefault("info","PHP "+e.severity,i,!0);break;default:i="Type: PHP "+e.severity+"\n\n"+i,n.alertSystemError(i)}},exception(e){const n=t.config.globalProperties.$fhcAlert;var i="";i+="Type: "+e.class+"\n\n",i+="Message: "+e.message+"\n\n",i+="Filename: "+e.filename+"\n",i+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(i+="\nBacktrace: ",e.backtrace.forEach(t=>{i+="\n\tFile: "+t.file+"\n",i+="\tLine: "+t.line+"\n",i+="\tFunction: "+t.function+"\n"})),n.alertSystemError(i)},db(e){const n=t.config.globalProperties.$fhcAlert;var i="";void 0!==e.heading&&(i+=e.heading+"\n\n"),void 0!==e.code&&(i+="Code: "+e.code+"\n\n"),void 0!==e.sql&&(i+="SQL: "+e.sql+"\n\n"),void 0!==e.message?i+="Message: "+e.message+"\n\n":void 0!==e.messages&&(i+="Messages: "+e.messages.join("\n\t")+"\n\n"),void 0!==e.filename&&(i+="Filename: "+e.filename+"\n"),void 0!==e.line&&(i+="Line Number: "+e.line+"\n"),n.alertSystemError(i)},auth(e,n){const i=t.config.globalProperties.$fhcAlert;var a="";a+="Controller name: "+e.controller+"\n",a+="Method name: "+e.method+"\n",a+="Required permissions: "+e.required_permissions,n?.errorHeader?i.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e.message,!0):i.alertDefault("error",e.message,a)}}};class s{constructor(e,n){void 0===n?(this.$fhcApi={getUri:e=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.getUri(e)),get:(e,n,i,a)=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.get(e,n,i,a)),post:(e,n,i,a)=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.post(e,n,i,a))},Object.defineProperty(this.$fhcApi,"factory",{get:()=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.factory)}),t.config.globalProperties.$fhcApi.factory=this):Object.defineProperty(this,"$fhcApi",{get(){return(n||this).$fhcApi}}),this.addEndpoints(e,!0)}addEndpoints(t,e){Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{get(){return"function"==typeof t[e]?t[e].bind(this):new s(t[e],this.$fhcApi.factory)}})}),e||console.warn("$fhcApi.factory.addEndpoints() is DEPRECATED!")}}const r=new s(nt);e?.factory&&(console.warn("$fhcApi is DEPRECATED!"),r.addEndpoints(e.factory)),t.config.globalProperties.$fhcApi.factory=r,t.provide("$fhcApi",t.config.globalProperties.$fhcApi)}},at={install:(t,e)=>{if(t.config.globalProperties.$api)return;function n(t,e){Array.isArray(t)?t.forEach(e):Object.entries(t).forEach(([t,n])=>n.forEach(n=>e(n,t)))}t.config.globalProperties.$fhcAlert||t.use(yt);let i={success:!0,fail:!0,combine:{form:["validation","general"],toast:["validation","general","not_found","site_failed"]},handler:{form(t,e){t.clearValidation(),e.forEach(e=>t.setFeedback(!1,e.messages||e.message))},async toast(e){const n=t.config.globalProperties.$p;if(!n)return Promise.reject("Phrasen plugin not loaded!");async function i(t){t=t.reduce((t,e)=>{switch(e.type){case"not_found":case"site_failed":e.message?t[e.message]=[e.url]:t._default=[e.url];break;case"general":t._default||(t._default=[]),t._default.push(e.message);break;case"validation":Object.entries(e.messages).forEach(([e,n])=>{t[e]||(t[e]=[]),Array.isArray(n)?t[e].push(...n):t[e].push(n)})}return t},{});let e=0;const i=await Promise.all(Object.entries(t).sort((t,e)=>["_default"].indexOf(e[0])-["_default"].indexOf(t[0])).map(async([t,i])=>{if("_default"==t){await n.loadCategory("dashboard");t='<dt class="d-none">'+n.t("dashboard/general")+"</dt>"}else t="<dt>"+t+"</dt>";return e+=i.length,t+"<dd>"+i.join("</dd><dd>")+"</dd>"}));return{counter:e,msgs:i}}let a,s;Array.isArray(e)?({counter:a,msgs:s}=await i(e)):({counter:a,msgs:s}=await Object.entries(e).reduce(async(t,[e,n])=>{const a=await t,{counter:s,msgs:r}=await i(n);return a.counter+=s,a.msgs.push("<dt>"+e+"</dt><dd><dl>"+r.join("")+"</dl></dd>"),a},Promise.resolve({counter:0,msgs:[]}))),await n.loadCategory("ui");const r=n.t("ui/n_errors",{n:a});t.config.globalProperties.$fhcAlert.alertDefault("error",r,"<dl>"+s.join("")+"</dl>",!0,!0)},php(e){n(e,(e,n)=>{var i="";switch(i+="Message: "+e.message+"\n\n",i+="Filename: "+e.filename+"\n",i+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(i+="\nBacktrace: ",e.backtrace.forEach(t=>{i+="\n\tFile: "+t.file+"\n",i+="\tLine: "+t.line+"\n",i+="\tFunction: "+t.function+"\n"})),e.severity){case"Warning":case"Core Warning":case"Compile Warning":case"User Warning":n?n+=": PHP "+e.severity:n="PHP "+e.severity,t.config.globalProperties.$fhcAlert.alertDefault("warn",n,i,!0);break;case"Notice":case"User Notice":case"Runtime Notice":n?n+=": PHP "+e.severity:n="PHP "+e.severity,t.config.globalProperties.$fhcAlert.alertDefault("info",n,i,!0);break;default:i="Type: PHP "+e.severity+"\n\n"+i,n&&(i=n+"\n\n"+i),t.config.globalProperties.$fhcAlert.alertSystemError(i)}})},exception(e){n(e,(e,n)=>{var i="";n&&(i+=n+"\n\n"),i+="Type: "+e.class+"\n\n",i+="Message: "+e.message+"\n\n",i+="Filename: "+e.filename+"\n",i+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(i+="\nBacktrace: ",e.backtrace.forEach(t=>{i+="\n\tFile: "+t.file+"\n",i+="\tLine: "+t.line+"\n",i+="\tFunction: "+t.function+"\n"})),t.config.globalProperties.$fhcAlert.alertSystemError(i)})},db(e){n(e,(e,n)=>{var i="";n&&(i+=n+"\n\n"),void 0!==e.heading&&(i+=e.heading+"\n\n"),void 0!==e.code&&(i+="Code: "+e.code+"\n\n"),void 0!==e.sql&&(i+="SQL: "+e.sql+"\n\n"),void 0!==e.message?i+="Message: "+e.message+"\n\n":void 0!==e.messages&&(i+="Messages: "+e.messages.join("\n\t")+"\n\n"),void 0!==e.filename&&(i+="Filename: "+e.filename+"\n"),void 0!==e.line&&(i+="Line Number: "+e.line+"\n"),t.config.globalProperties.$fhcAlert.alertSystemError(i)})},auth(e){n(e,(e,n)=>{n?n+=": "+e.message:n=e.message;var i="";i+="Controller name: "+e.controller+"\n",i+="Method name: "+e.method+"\n",i+="Required permissions: "+e.required_permissions,t.config.globalProperties.$fhcAlert.alertDefault("error",n,i,!0)})}}};function a(t,e,n,i){if("string"==typeof t&&void 0===i)[e,n,i]=[t,e,n],t=void 0;else if(t){if("object"!=typeof t)throw new TypeError("Parameter 1 of _get_config must be an object or a string");void 0===e&&void 0===n&&void 0===i&&(i=t,t=void 0)}if(t){if(!t.clearValidation||!t.setFeedback)throw new TypeError("'form' is not a Form Component");t={clearValidation:t.clearValidation,setFeedback:t.setFeedback},i?i.form=t:i={form:t}}return[e,n,i]}function s(t){if("string"==typeof t.data||t.data instanceof String)return s({data:t});const e=t.data;return delete t.data,e?(e.meta?e.meta.response=t:e.meta={response:t},e):{meta:{response:t},data:null}}function r(t){if(!1===t||"off"===t)return{...i,success:!1,fail:!1};if(!t||!0===t)return{...i};if("success"===t)return{...i,fail:!1};if("fail"===t)return{...i,success:!1};const{success:e,fail:n,handler:a,combine:s}=t;return t={...i},Object.entries({fail:n,success:e}).forEach(([e,n])=>{void 0!==n&&(t[e]=n)}),Object.entries({handler:a,combine:s}).forEach(([e,n])=>{void 0!==n&&(t[e]={...t[e],...n})}),t}function l(t){const e=r(t?.errorHandling);if(t?.form){const n=e.handler.form;e.handler={...e.handler,form:e=>n(t.form,e)}}else e.combine={...e.combine,form:[]};return e}function o(t){return t.response?404==t.response.status?[{type:"not_found",message:t.message,url:t.request.responseURL}]:null==t.response.data.errors?[]:t.response.data.errors:t.request?[{type:"site_failed",message:t.message,url:t.request.responseURL}]:[{type:"script",message:t.message}]}function d(t,e){const n={},i=[];if(null==e)return{};for(;e.length;)i.push(e.pop());for(var a of i){let i=a.type,r=null;for(var s in t.combine){let e=t.combine[s].includes(i),n=t.handler[s];if(e&&n&&(r=s,"form"==r))break}r&&(i=r);t.handler[i]?(n[i]||(n[i]=[]),Array.isArray(a)?n[i].push(...a):n[i].push(a)):e.push(a)}return n}void 0!==e?.errorHandling&&(i=r(e.errorHandling));const u=axios.create({timeout:5e5,baseURL:FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/"});u.interceptors.request.use(t=>{if("post"!=t.method||!t.data)return t;if(t.data instanceof FormData)return t;if(!Object.values(t.data).every(t=>!(t instanceof FileList)&&(!Array.isArray(t)||t.every(t=>!(t instanceof File))))){const e=Object.entries(t.data).reduce((t,[e,n])=>{if(n instanceof FileList)for(const i of n)t.FormData.append(e+(n.length>1?"[]":""),i);else Array.isArray(n)?n.every(t=>!(t instanceof File))?t.jsondata[e]=n:n.forEach(i=>t.FormData.append(e+(n.length>1?"[]":""),i)):t.jsondata[e]=n;return t},{FormData:new FormData,jsondata:{}});e.FormData.append("_jsondata",JSON.stringify(e.jsondata)),t.data=e.FormData}return t}),u.interceptors.response.use(e=>("off"==e.config?.errorHandling||!1===e.config?.errorHandling||"fail"==e.config?.errorHandling||e.data.errors&&(e.data.errors=e.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$api._defaultErrorHandlers[n.type])(n,e.config))),s(e)),t=>{if("ERR_CANCELED"==t.code)return Promise.reject({handled:!0,...t});const e=l(t.config);if(!e.fail)return Promise.reject(t);const n=o(t),i=d(e,n);for(var a in i)e.handler[a](i[a]);return n.length?Promise.reject(t):Promise.reject({handled:!0,...t})}),t.config.globalProperties.$api={getUri:t=>u.getUri({url:t}),get:(t,e,n,i)=>([e,n,i]=a(t,e,n,i),n&&(i?i.params=n:i={params:n}),u.get(e,i)),post:(t,e,n,i)=>([e,n,i]=a(t,e,n,i),u.post(e,n,i)),call(e,n,i){if(Array.isArray(e)){const s=t.config.globalProperties.$api;return Promise.allSettled(e.map((t,e)=>(Array.isArray(t)||(t=["#"+e,t]),s.call(t[1],{errorHeader:t[0],errorHandling:!1})))).then(t=>{const[,,e]=a(i,void 0,void 0,n||{}),s=l(e);if(!s.success&&!s.fail)return t;const r={};for(var u of t){const[t,e]="fulfilled"===u.status?[s.success,u.value]:[s.fail,u.reason];if(!t)return;const n=d(s,o(e));for(var h in n)r[h]?r[h][e.config.errorHeader]=n[h]:r[h]={[e.config.errorHeader]:n[h]}}for(var c in r)s.handler[c](r[c]);return t})}let{method:s,url:r,params:u,config:h}=e;return void 0!==n&&(h=n),s||(s="get"),s.toLowerCase&&(s=s.toLowerCase()),"get"==s?this.get(i,r,u,h):"post"==s?this.post(i,r,u,h):void console.error("FhcApi: method not allowed:",s)}},t.provide("$api",t.config.globalProperties.$api)}},st={loadCategory:t=>({method:"get",url:"/api/frontend/v1/phrasen/loadModule/"+t}),setLanguage:(t,e)=>({method:"post",url:"/api/frontend/v1/phrasen/setLanguage",params:{categories:t,language:e}}),getLanguage:()=>({method:"get",url:"/api/frontend/v1/phrasen/getLanguage"}),getActiveDbLanguages:()=>({method:"get",url:"/api/frontend/v1/phrasen/getAllLanguages"})};const rt=Vue.reactive({}),lt={};let ot=Vue.ref(FHC_JS_DATA_STORAGE_OBJECT.user_language),dt=Vue.computed(()=>ot.value?FHC_JS_DATA_STORAGE_OBJECT.server_languages.find(t=>t.sprache==ot.value).LC_Time:null);const ut={user_language:ot,user_locale:dt,setLanguage(t){const e=Object.keys(rt);return this.config.globalProperties.$api.call(st.setLanguage(e,t)).then(e=>(e.data.forEach(t=>{rt[t.category][t.phrase]=t.text}),ot.value=t,e))},loadCategory(t){return Array.isArray(t)?Promise.all(t.map(this.config.globalProperties.$p.loadCategory)):(lt[t]||(lt[t]=this.config.globalProperties.$api.call(st.loadCategory(t)).then(e=>e?.data?function(t,e){return t.filter(t=>t.category==e).reduce((t,e)=>(t[e.phrase]||(t[e.phrase]=e.text),t),{})}(e.data,t):{}).then(e=>{rt[t]=e})),lt[t])},t_ref(t,e,n){return console.warn("deprecated"),Vue.computed(()=>this.t(t,e,n))},t(t,e,n){if(void 0===n&&(Array.isArray(t)&&2==t.length||t.split&&2==t.split("/").length)&&(n=e,[t,e]=t.split?t.split("/"):t),void 0===e)return console.error("invalid input",t,e,n),"";let i=Vue.computed(()=>rt[t]?function(t,e,n){let i=rt[t][e];return i?(n&&(i=i.replace(/\{([^}]*)\}/g,(t,e)=>void 0===n[e]?t:n[e])),i):"<< PHRASE "+e+">>"}(t,e,n):"");return rt[t]||this.loadCategory(t),i.value}};var ht={install(t,e){t.config.globalProperties.$fhcApi||t.use(it),t.config.globalProperties.$api||t.use(at),t.config.globalProperties.$p={t:ut.t,loadCategory:e=>ut.loadCategory.call(t,e),setLanguage:e=>ut.setLanguage.call(t,e),user_language:ot,user_locale:dt,t_ref:ut.t_ref},t.provide("$p",t.config.globalProperties.$p)}},ct=Object.freeze({__proto__:null,default:ht,user_locale:dt});const pt="error",gt="retval",mt={get:function(t,e,n=null){return mt._axiosCall(t,e,"get",n)},post:function(t,e,n=null){return mt._axiosCall(t,e,"post",n)},isSuccess:function(t){return!("object"!=typeof t||!t.hasOwnProperty(pt)||!t.hasOwnProperty(gt)||0!=t.error)},isError:function(t){return!mt.isSuccess(t)},hasData:function(t){return!(!mt.isSuccess(t)||!("object"==typeof t[gt]&&Object.keys(t[gt]).length>0||"array"==typeof t[gt]&&t[gt].length>0||"string"==typeof t[gt]&&""!=t[gt].trim()||"number"==typeof t[gt]))},getData:function(t){return mt.hasData(t)?t[gt]:null},getError:function(t){return"object"==typeof t&&Object.keys(t).length>0&&t.hasOwnProperty(gt)?t[gt]:"Generic error"},getErrorCode:function(t){return"object"==typeof t&&t.hasOwnProperty(pt)?t[pt]:1},_generateRouterURI:function(t){var e=null;return"undefined"!=typeof FHC_JS_DATA_STORAGE_OBJECT&&(e=FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/"+t),e},_printDebug:function(t,e,n){},_axiosCall:function(t,e,n,i){let a={method:n,url:mt._generateRouterURI(t),timeout:5e3};if("get"==n?a.params=e:a.data=e,"object"==typeof i)for(var s in i)a[s]=i[s];return axios(a)}},ft=document.createElement("div"),vt=Vue.createApp({name:"FhcAlertApp",components:{PvToast:e,PvConfirm:n},methods:{mailToUrl:t=>"mailto:"+FHC_JS_DATA_STORAGE_OBJECT.systemerror_mailto+"?subject=Meldung%20Systemfehler&body="+("\n\t\t\t\tDanke, dass Sie uns den Fehler melden. %0D%0A %0D%0A\n\t\t\t\tBitte beschreiben Sie uns ausführlich das Problem.%0D%0A\n\t\t\t\tBsp: Ich habe X ausgewählt und Y angelegt. Beim Speichern erhielt ich die Fehlermeldung. [Optional: Ich habe den Browser Z verwendet.]%0D%0A\n\t\t\t\t-----------------------------------------------------------------------------------------------------------------------------------%0D%0A\n\t\t\t\tPROBLEM: ... %0D%0A %0D%0A %0D%0A\n\n\t\t\t\t-----------------------------------------------------------------------------------------------------------------------------------%0D%0A\n\t\t\t\tFehler URL: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method+"%0D%0A\n\t\t\t\tFehler Meldung: "+t.message.detail+"%0D%0A\n\t\t\t\t-----------------------------------------------------------------------------------------------------------------------------------%0D%0A %0D%0A\n\t\t\t\tWir kümmern uns um eine rasche Behebung des Problems!"),openMessagecard(t){bootstrap.Collapse.getOrCreateInstance(t.target.getAttribute("href")).toggle()}},unmounted(){ft.parentElement.removeChild(ft)},computed:{showmaillink:function(){return""!==FHC_JS_DATA_STORAGE_OBJECT.systemerror_mailto}},template:'\n\t<pv-toast ref="toast" class="fhc-alert" :base-z-index="99999">\n\t\t<template #message="{ message }">\n\t\t\t\x3c!--span :class="slotProps.iconClass"></span--\x3e\n\t\t\t<div class="p-toast-message-text">\n\t\t\t\t<span class="p-toast-summary">{{ message.summary }}</span>\n\t\t\t\t<div v-if="message.detail && message.html" class="p-toast-detail" v-html="message.detail"></div>\n\t\t\t\t<div v-else-if="message.detail" class="p-toast-detail">{{ message.detail }}</div>\n\t\t\t</div>\n\t\t</template>\n\t</pv-toast>\n\t<pv-toast ref="alert" class="fhc-alert" :base-z-index="99999" position="center">\n\t\t<template #message="slotProps">\n\t\t\t<i class="fa fa-circle-exclamation fa-2xl mt-3"></i>\n\t\t\t<div class="p-toast-message-text">\n\t\t\t\t<span class="p-toast-summary">{{slotProps.message.summary}}</span>\n\t\t\t\t<div class="p-toast-detail my-3">Sorry! Ein interner technischer Fehler ist aufgetreten.</div>\n\t\t\t\t<div class="d-flex justify-content-between align-items-center">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass="align-bottom flex-fill me-2"\n\t\t\t\t\t\tdata-bs-toggle="collapse"\n\t\t\t\t\t\t:href="\'#fhcAlertCollapseMessageCard\' + slotProps.message.id"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\taria-expanded="false"\n\t\t\t\t\t\t:aria-controls="\'fhcAlertCollapseMessageCard\' + slotProps.message.id"\n\t\t\t\t\t\t@click="openMessagecard"\n\t\t\t\t\t\t>\n\t\t\t\t\t\tFehler anzeigen\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\tv-if="showmaillink"\n\t\t\t\t\t\tclass="btn btn-primary flex-fill"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t:href="mailToUrl(slotProps)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\tFehler melden\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div ref="messageCard" :id="\'fhcAlertCollapseMessageCard\' + slotProps.message.id" class="collapse mt-3">\n\t\t\t\t\t<div class="card card-body text-body small alertCollapseText">\n\t\t\t\t\t\t{{slotProps.message.detail}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</pv-toast>\n\t<pv-confirm group="fhcAlertConfirm"></pv-confirm>'});vt.use(t),vt.use(i);const bt=vt.mount(ft);document.body.appendChild(ft);var yt={install:(t,e)=>{t.config.globalProperties.$p||t.use(ht);const n={alertSuccess(t){if(Array.isArray(t))return t.forEach(this.alertSuccess);bt.$refs.toast.add({severity:"success",summary:"Info",detail:t,life:1e3})},alertInfo(t){if(Array.isArray(t))return t.forEach(this.alertInfo);bt.$refs.toast.add({severity:"info",summary:"Info",detail:t,life:3e3})},alertWarning(t){if(Array.isArray(t))return t.forEach(this.alertWarning);bt.$refs.toast.add({severity:"warn",summary:"Achtung",detail:t})},alertError(t){if(Array.isArray(t))return t.forEach(this.alertError);bt.$refs.toast.add({severity:"error",summary:"Achtung",detail:t})},alertSystemError(e){if(Array.isArray(e))return e.forEach(this.alertSystemError);bt.$refs.alert.add({severity:"error",summary:Vue.computed(()=>t.config.globalProperties.$p.t("alert/systemerror")),detail:e})},confirmDelete:()=>new Promise((e,n)=>{bt.$confirm.require({group:"fhcAlertConfirm",header:Vue.computed(()=>t.config.globalProperties.$p.t("alert/attention")),message:Vue.computed(()=>t.config.globalProperties.$p.t("alert/confirm_delete")),acceptLabel:Vue.computed(()=>t.config.globalProperties.$p.t("ui/loeschen")),acceptClass:"p-button-danger",rejectLabel:Vue.computed(()=>t.config.globalProperties.$p.t("ui/abbrechen")),rejectClass:"p-button-secondary",accept(){e(!0)},reject(){e(!1)}})}),confirm:e=>new Promise((n,i)=>{bt.$confirm.require({group:e?.group??"fhcAlertConfirm",header:e?.header??Vue.computed(()=>t.config.globalProperties.$p.t("alert/attention")),message:e?.message??"",acceptLabel:e?.acceptLabel??"Ok",acceptClass:e?.acceptClass??"btn btn-primary",rejectLabel:e?.rejectLabel??Vue.computed(()=>t.config.globalProperties.$p.t("ui/abbrechen")),rejectClass:e?.rejectClass??"btn btn-outline-secondary",accept(){n(!0)},reject(){n(!1)}})}),alertDefault(t,e,n,i=!1,a=!1){let s={severity:t,summary:e,detail:n,html:a};i||(s.life=3e3),bt.$refs.toast.add(s)},alertMultiple(t,e="info",n="Info",i=!1,a=!1){return!!t.every(t=>"string"==typeof t)&&(t.forEach(t=>this.alertDefault(e,n,t,i,a)),!0)},handleSystemError(t){if(!t.hasOwnProperty("name")||t.name.toLowerCase()!=="AbortError".toLowerCase()){if("string"==typeof t)return n.alertSystemError(t);if(Array.isArray(t)&&t.every(t=>"string"==typeof t))return t.every(n.alertSystemError);if(!t.hasOwnProperty("handled")||!t.handled){if("object"==typeof t&&null!==t){let e="";return t.hasOwnProperty("response")&&t.response?.data?.retval?e+="Error Message: "+(t.response.data.retval.message||t.response.data.retval)+"\r\n":t.hasOwnProperty("message")&&(e+="Error Message: "+t.message.toUpperCase()+"\r\n"),t.hasOwnProperty("config")&&t.config.hasOwnProperty("url")&&(e+="Error ConfigURL: "+t.config.url+"\r\n"),t.hasOwnProperty("stack")&&(e+="Error Stack: "+t.stack+"\r\n"),""==e&&(e="Error Message: "+JSON.stringify(t)+"\r\n"),e+="Error Controller Path: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method,n.alertSystemError(e)}n.alertSystemError("alertSystemError throws Generic Error\r\nError Controller Path: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method)}}},handleSystemMessage(t){if("string"==typeof t)return n.alertWarning(t);if(Array.isArray(t)){if(t.every(t=>"string"==typeof t))return t.every(n.alertWarning);if(t.every(t=>"object"==typeof t)&&null!==msg)return t.every(t=>{t.hasOwnProperty("data")&&t.data.hasOwnProperty("retval")?n.alertWarning(JSON.stringify(t.data.retval)):n.alertSystemError(JSON.stringify(t))})}"object"!=typeof t||null===t?n.alertSystemError("alertSystemError throws Generic Error\r\nError Controller Path: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method):t.hasOwnProperty("data")&&t.data.hasOwnProperty("retval")?n.alertWarning(JSON.stringify(t.data.retval)):n.alertSystemError(JSON.stringify(t))},resetFormValidation(t){const e=new Event("fhc-form-reset");t.querySelectorAll(["[data-fhc-form-validate],[data-fhc-form-error]"]).forEach(t=>t.dispatchEvent(e))},handleFormValidation(t,e){if(void 0===e){if(t&&t.nodeType===Node.ELEMENT_NODE)return e=>n.handleFormValidation(e,t)}else if(400==t?.response?.status){let i=mt.getError(t.response.data);"object"!=typeof i&&(i=t.response.data),n.resetFormValidation(e);const a=Object.entries(i).filter(([t,n])=>{const i=e.querySelector('[data-fhc-form-validate="'+t+'"]');return!i||(i.dispatchEvent(new CustomEvent("fhc-form-invalidate",{detail:n})),!1)}).map(t=>t[1]),s=e.querySelector("[data-fhc-form-error]");return void(s&&a.length?s.dispatchEvent(new CustomEvent("fhc-form-error",{detail:a})):a.forEach(n.alertError))}if(400==t?.response?.status){let e=mt.getError(t.response.data);n.alertError("object"==typeof e?Object.values(e):e)}else n.handleSystemError(t)}};t.config.globalProperties.$fhcAlert=n,t.provide("$fhcAlert",t.config.globalProperties.$fhcAlert)}};console.warn("plugin/FhcApi.js is DEPRECATED! Use plugins/Api.js instead.");var wt={install:(t,e)=>{if(t.config.globalProperties.$fhcApi)return void(e?.factory&&(console.warn("$fhcApi is DEPRECATED!"),t.config.globalProperties.$fhcApi.factory.addEndpoints(e.factory)));function n(t,e,n,i){if("string"==typeof t&&void 0===i)[e,n,i]=[t,e,n],t=void 0;else if(t){if("object"!=typeof t)throw new TypeError("Parameter 1 of _get_config must be an object or a string");void 0===e&&void 0===n&&void 0===i&&(i=t,t=void 0)}if(t){if(!t.clearValidation||!t.setFeedback)throw new TypeError("'form' is not a Form Component");t={clearValidation:t.clearValidation,setFeedback:t.setFeedback},i?i.form=t:i={form:t}}return[e,n,i]}function i(t){const e=t.data;return delete t.data,e?(e.meta?e.meta.response=t:e.meta={response:t},e):{meta:{response:t},data:null}}t.use(yt),t.use(at),FHC_JS_DATA_STORAGE_OBJECT.app_root,FHC_JS_DATA_STORAGE_OBJECT.ci_router;const a=axios.create({timeout:5e5,baseURL:FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/"});a.interceptors.request.use(t=>{if("post"!=t.method||!t.data)return t;if(t.data instanceof FormData)return t;if(!Object.values(t.data).every(t=>!(t instanceof FileList)&&(!Array.isArray(t)||t.every(t=>!(t instanceof File))))){const e=Object.entries(t.data).reduce((t,[e,n])=>{if(n instanceof FileList)for(const i of n)t.FormData.append(e+(n.length>1?"[]":""),i);else Array.isArray(n)?n.every(t=>!(t instanceof File))?t.jsondata[e]=n:n.forEach(i=>t.FormData.append(e+(n.length>1?"[]":""),i)):t.jsondata[e]=n;return t},{FormData:new FormData,jsondata:{}});e.FormData.append("_jsondata",JSON.stringify(e.jsondata)),t.data=e.FormData}return t}),a.interceptors.response.use(e=>("off"==e.config?.errorHandling||!1===e.config?.errorHandling||"fail"==e.config?.errorHandling||e.data.errors&&(e.data.errors=e.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$fhcApi._defaultErrorHandlers[n.type])(n,e.config))),i(e)),e=>"ERR_CANCELED"==e.code?Promise.reject({handled:!0,...e}):"off"==e.config?.errorHandling||!1===e.config?.errorHandling||"success"==e.config?.errorHandling?Promise.reject(e):e.response?404==e.response.status?(t.config.globalProperties.$fhcAlert.alertDefault("error",e.message,e.request.responseURL,!0),Promise.reject({handled:!0,...e})):(e.response.data.errors=e.response.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$fhcApi._defaultErrorHandlers[n.type])(n,e.config)),e.response.data.errors.length?Promise.reject(e):Promise.reject({handled:!0,...e})):e.request?(t.config.globalProperties.$fhcAlert.alertDefault("error",e.message,e.request.responseURL),Promise.reject({handled:!0,...e})):(t.config.globalProperties.$fhcAlert.alertError(e.message),Promise.reject({handled:!0,...e}))),t.config.globalProperties.$fhcApi={getUri:t=>a.getUri({url:t}),get:(t,e,i,s)=>([e,i,s]=n(t,e,i,s),i&&(s?s.params=i:s={params:i}),a.get(e,s)),post:(t,e,i,s)=>([e,i,s]=n(t,e,i,s),a.post(e,i,s)),_defaultErrorHandlers:{validation(e,n){const i=t.config.globalProperties.$fhcAlert;return n?.form?(n.form.clearValidation(),n.form.setFeedback(!1,e.messages),!1):Array.isArray(e.messages)?(e.messages.forEach(i.alertError),!1):"object"!=typeof e.messages||(n?.errorHeader?Object.values(e.messages).forEach(e=>i.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e,!0)):Object.entries(e.messages).forEach(([t,e])=>i.alertDefault("error",t,e,!0)),!1)},general(e,n){const i=t.config.globalProperties.$fhcAlert;n?.form?n.form.setFeedback(!1,e.message):n?.errorHeader?i.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e.message,!0):i.alertError(e.message)},php(e){const n=t.config.globalProperties.$fhcAlert;var i="";switch(i+="Message: "+e.message+"\n\n",i+="Filename: "+e.filename+"\n",i+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(i+="\nBacktrace: ",e.backtrace.forEach(t=>{i+="\n\tFile: "+t.file+"\n",i+="\tLine: "+t.line+"\n",i+="\tFunction: "+t.function+"\n"})),e.severity){case"Warning":case"Core Warning":case"Compile Warning":case"User Warning":n.alertDefault("warn","PHP "+e.severity,i,!0);break;case"Notice":case"User Notice":case"Runtime Notice":n.alertDefault("info","PHP "+e.severity,i,!0);break;default:i="Type: PHP "+e.severity+"\n\n"+i,n.alertSystemError(i)}},exception(e){const n=t.config.globalProperties.$fhcAlert;var i="";i+="Type: "+e.class+"\n\n",i+="Message: "+e.message+"\n\n",i+="Filename: "+e.filename+"\n",i+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(i+="\nBacktrace: ",e.backtrace.forEach(t=>{i+="\n\tFile: "+t.file+"\n",i+="\tLine: "+t.line+"\n",i+="\tFunction: "+t.function+"\n"})),n.alertSystemError(i)},db(e){const n=t.config.globalProperties.$fhcAlert;var i="";void 0!==e.heading&&(i+=e.heading+"\n\n"),void 0!==e.code&&(i+="Code: "+e.code+"\n\n"),void 0!==e.sql&&(i+="SQL: "+e.sql+"\n\n"),void 0!==e.message?i+="Message: "+e.message+"\n\n":void 0!==e.messages&&(i+="Messages: "+e.messages.join("\n\t")+"\n\n"),void 0!==e.filename&&(i+="Filename: "+e.filename+"\n"),void 0!==e.line&&(i+="Line Number: "+e.line+"\n"),n.alertSystemError(i)},auth(e,n){const i=t.config.globalProperties.$fhcAlert;var a="";a+="Controller name: "+e.controller+"\n",a+="Method name: "+e.method+"\n",a+="Required permissions: "+e.required_permissions,n?.errorHeader?i.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e.message,!0):i.alertDefault("error",e.message,a)}}};class s{constructor(e,n){void 0===n?(this.$fhcApi={getUri:e=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.getUri(e)),get:(e,n,i,a)=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.get(e,n,i,a)),post:(e,n,i,a)=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.post(e,n,i,a))},Object.defineProperty(this.$fhcApi,"factory",{get:()=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.factory)}),t.config.globalProperties.$fhcApi.factory=this):Object.defineProperty(this,"$fhcApi",{get(){return(n||this).$fhcApi}}),this.addEndpoints(e)}addEndpoints(t){Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{get(){return"function"==typeof t[e]?t[e].bind(this):new s(t[e],this.$fhcApi.factory)}})}),console.warn("$fhcApi.factory.addEndpoints() is DEPRECATED!")}}const r=new s(nt);e?.factory&&(console.warn("$fhcApi is DEPRECATED!"),r.addEndpoints(e.factory)),t.config.globalProperties.$fhcApi.factory=r,t.provide("$fhcApi",t.config.globalProperties.$fhcApi)}};console.warn("plugin/Phrasen.js is DEPRECATED! Use plugins/Phrasen.js instead.");const $t=Vue.reactive({}),At={};let _t=Vue.ref(FHC_JS_DATA_STORAGE_OBJECT.user_language),St=Vue.computed(()=>_t.value?FHC_JS_DATA_STORAGE_OBJECT.server_languages.find(t=>t.sprache==_t.value).LC_Time:null);const Dt={user_language:_t,user_locale:St,setLanguage(t){const e=Object.keys($t);return this.config.globalProperties.$api.call(st.setLanguage(e,t)).then(e=>(e.data.forEach(t=>{$t[t.category][t.phrase]=t.text}),_t.value=t,e))},loadCategory(t){return Array.isArray(t)?Promise.all(t.map(this.config.globalProperties.$p.loadCategory)):(this.config.globalProperties.$fhcApi,this.config.globalProperties.$fhcApiFactory,At[t]||(At[t]=this.config.globalProperties.$api.call(st.loadCategory(t)).then(e=>e?.data?function(t,e){return t.filter(t=>t.category==e).reduce((t,e)=>(t[e.phrase]||(t[e.phrase]=e.text),t),{})}(e.data,t):{}).then(e=>{$t[t]=e})),At[t])},t_ref(t,e,n){return console.warn("deprecated"),Vue.computed(()=>this.t(t,e,n))},t(t,e,n){if(void 0===n&&(Array.isArray(t)&&2==t.length||t.split&&2==t.split("/").length)&&(n=e,[t,e]=t.split?t.split("/"):t),void 0===e)return console.error("invalid input",t,e,n),"";let i=Vue.computed(()=>$t[t]?function(t,e,n){let i=$t[t][e];return i?(n&&(i=i.replace(/\{([^}]*)\}/g,(t,e)=>void 0===n[e]?t:n[e])),i):"<< PHRASE "+e+">>"}(t,e,n):"");return $t[t]||this.loadCategory(t),i.value}};var Ct={install(t,e){t.use(wt,e?.fhcApi||void 0),t.config.globalProperties.$p={t:Dt.t,loadCategory:e=>Dt.loadCategory.call(t,e),setLanguage:e=>Dt.setLanguage.call(t,e),user_language:_t,user_locale:St,t_ref:Dt.t_ref},t.provide("$p",t.config.globalProperties.$p)}},kt={components:{tabview:a,tabpanel:s},directives:{accessibility:{created(t,e){if("tab"===e.arg){t.style.cursor="pointer";const[n,i]=e.modifiers.vertical?["ArrowUp","ArrowDown"]:["ArrowLeft","ArrowRight"];t.addEventListener("click",()=>{let e=t.parentNode.querySelector('[tabindex="0"]');e&&(e.tabIndex=-1),t.tabIndex=0}),t.addEventListener("focus",()=>{t.ariaSelected="true"}),t.addEventListener("blur",()=>{t.ariaSelected="false"}),t.addEventListener("keydown",e=>{switch(e.code){case n:void 0!==t.previousSibling?.tabIndex&&(t.previousSibling.tabIndex=0,t.tabIndex=-1,t.previousSibling.focus());break;case i:void 0!==t.nextSibling?.tabIndex&&(t.nextSibling.tabIndex=0,t.tabIndex=-1,t.nextSibling.focus());break;case"Enter":t.click()}})}},mounted(t,e){if("tab"===e.arg){let e=-1;Array.from(t.parentNode.children).forEach((n,i)=>{n.ariaSetSize=t.parentNode.children.length,n.ariaPosInSet=i,0===n.tabIndex&&(e=i)}),-1==e?t.tabIndex=0:t.classList.contains("active")?(t.parentNode.children[e].tabIndex=-1,t.tabIndex=0):t.tabIndex=-1}},beforeUnmount(t,e){if("tab"===e.arg){0===t.tabIndex&&(void 0!==t.previousSibling?.tabIndex?t.previousSibling.tabIndex=0:void 0!==t.nextSibling?.tabIndex&&(t.nextSibling.tabIndex=0));const e=parseInt(t.ariaPosInSet);Array.from(t.parentNode.children).forEach((n,i)=>{n.ariaSetSize=t.parentNode.children.length,i>e&&(n.ariaPosInSet=i-1)})}}}},emits:["update:modelValue","change","changed"],props:{config:{type:[String,Array,Object,Promise],required:!0},default:String,modelValue:[String,Number,Boolean,Array,Object,Date,Function,Symbol],vertical:Boolean,border:Boolean,useprimevue:{type:Boolean,default:!1}},data:()=>({current:null,tabs:{}}),computed:{currentTab(){return this.tabs[this.current]?this.tabs[this.current]:{component:"div"}},value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},calcActiveIndex:function(){let t=Object.keys(this.tabs).indexOf(this.default);return-1===t?0:t}},watch:{config(t){this.initConfig(t)}},methods:{handleTabClick:function(t){let e=Object.keys(this.tabs);this.change(e[t.index])},change(t){this.$emit("change",t),this.current=t,this.$nextTick(()=>this.$emit("changed",t))},initConfig(t){if(!t)return;if(t instanceof Promise)return t.then(t=>t.data).then(this.initConfig).catch(this.$fhcAlert.handleSystemError);if("string"==typeof t||t instanceof String)return this.$api.get(t).then(t=>t.data).then(this.initConfig).catch(this.$fhcAlert.handleSystemError);const e={};function n(t,n){if(!n.component)return console.error("Component missing for "+t);const i=Vue.reactive({suffix:"",showSuffix:n.showSuffix||!1});e[t]={component:Vue.markRaw(Vue.defineAsyncComponent(()=>import(n.component))),title:Vue.computed(()=>n.title||t),config:n.config,key:t,value:i,suffixhelper:n.suffixhelper??null}}Array.isArray(t)?t.forEach((t,e)=>n(e,t)):Object.entries(t).forEach(([t,e])=>n(t,e)),null!==this.current&&e[this.current]||(e[this.default]?this.current=this.default:this.current=Object.keys(e)[0]),this.tabs=e},updateSuffix(){this.getTabSuffix(this.currentTab)},async getTabSuffix(t){if(t.value.showSuffix)if(null!==t.suffixhelper){const e=await import(t.suffixhelper),n=await e.getSuffix(this.$api,this.modelValue);t.value.suffix=n}else t.value.suffix=""},getTabSuffixes(){Object.entries(this.tabs).forEach(([t,e])=>this.getTabSuffix(e))}},created(){this.initConfig(this.config)},mounted(){this.getTabSuffixes()},updated(){this.getTabSuffixes()},template:'\n\t<template v-if="useprimevue">\n\n\t\t<tabview \n\t\t\t:scrollable="true"\n\t\t\t:lazy="true"\n\t\t\t:activeIndex="calcActiveIndex"\n\t\t\t@tab-click="handleTabClick"\n\t\t>\n\t\t\t<tabpanel\n\t\t\t\tv-for="tab in tabs"\n\t\t\t\t:key="tab.key"\n\t\t\t\t:header="tab.title + ((tab.value.showSuffix && tab.value.suffix !== \'\') ? \' \' + tab.value.suffix : \'\')"\n\t\t\t>\n\t\t\t\t<keep-alive>\n\t\t\t\t\t<component\n\t\t\t\t\t\t:is="tab.component"\n\t\t\t\t\t\tv-model="value"\n\t\t\t\t\t\t:config="tab.config"\n\t\t\t\t\t\t@update:suffix="updateSuffix($event)"\n\t\t\t\t\t\t></component>\n\t\t\t\t</keep-alive>\n\t\t\t</tabpanel>\n\t\t</tabview>\n\n\t</template>\n\t<template v-else="">\n\n\t<div class="fhc-tabs d-flex" :class="vertical ? \'align-items-stretch gap-3\' : (border ? \'flex-column\' : \'flex-column gap-3\')" v-if="Object.keys(tabs).length">\n\t\t<div class="nav" :class="vertical ? \'nav-pills flex-column\' : \'nav-tabs\'">\n\n\t\t\t<div\n\t\t\t\tv-for="tab in tabs"\n\t\t\t\t:key="tab.key"\n\t\t\t\tclass="nav-item nav-link"\n\t\t\t\t:class="{active: tab.key == current}"\n\t\t\t\t@click="change(tab.key)"\n\t\t\t\t:aria-current="tab.key == current ? \'page\' : \'\'"\n\t\t\t\tv-accessibility:tab.[vertical]\n\t\t\t\t>\n\t\t\t\t{{tab.title}} <span v-if="tab.value.showSuffix && tab.value.suffix"> {{ tab.value.suffix }}</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div :style="vertical ? \'\' : \'flex: 1 1 0%; height: 0%\'" class="overflow-auto flex-grow-1" :class="vertical || !border ? \'\' : \'p-3 border-bottom border-start border-end\'">\n\t\t\t<keep-alive>\n\t\t\t\t<component\n\t\t\t\t\tref="current"\n\t\t\t\t\t:is="currentTab.component"\n\t\t\t\t\tv-model="value"\n\t\t\t\t\t:config="currentTab.config"\n\t\t\t\t\t@update:suffix="updateSuffix($event)"\n\t\t\t\t\t></component>\n\t\t\t</keep-alive>\n\t\t</div>\n\t</div>\n\n\t</template>'};const Pt={name:"StudentDropdown",components:{Dropdown:primevue.dropdown},emits:["studentChanged"],data:()=>({errors:null,internal_available_student_info:[],internal_selected_student_info:null}),props:{},methods:{studentChanged(t){this.$entryParams.selected_student=t.value,this.$entryParams.selected_student_info=this.$entryParams.availableStudents.find(e=>e.prestudent_id===t.value.prestudent_id),this.$emit("studentChanged",t)},async setupData(){(this.$entryParams.permissions.assistenz||this.$entryParams.permissions.admin)&&await this.$entryParams.setupPromise.then(()=>{this.internal_available_student_info=this.$entryParams.availableStudents,this.internal_selected_student_info=this.$entryParams.selected_student_info})},resetData(){this.internal_available_student_info=this.$entryParams.availableStudents,this.internal_selected_student_info=this.$entryParams.selected_student_info},getOptionLabel(t){const e=" ("+t.semester+t.verband+t.gruppe+")";return t.nachname+" "+t.vorname+" "+e.replace(/\s+/g,"")}},mounted(){this.setupData()},template:'\n\t\t<div class="row">\n\t\t\t<div class="col-3 d-flex align-items-center"><label for="leSelect">{{ $p.t(\'global/students\') }}</label></div>\n\t\t\t<div class="col-8">\n\t\t\t\t<Dropdown @change="studentChanged" :style="{\'width\': \'100%\'}" :optionLabel="getOptionLabel" \n\t\t\t\tv-model="internal_selected_student_info" :options="internal_available_student_info">\n\t\t\t\t</Dropdown>\n\t\t\t</div>\n\t\t</div>\n\t'};var Et={name:"StudentAnwesenheitComponent",components:{CoreBaseLayout:$,CoreFilterCmpt:b,CoreRESTClient:mt,StudiensemesterDropdown:{name:"StudiensemesterDropdown",emits:["ssChanged"],data:()=>({options:[],selectedOption:[],errors:null}),created(){this.loadDropdown()},props(){},methods:{loadDropdown(){this.$api.call(L.getStudiensemester()).then(t=>{if("success"!==t.meta.status)return;this.options=t.data?.[0]??[];const e=t.data?.[1]?.[0].studiensemester_kurzbz;this.selectedOption=e??this._.root.appContext.config.globalProperties.$entryParams.sem_kurzbz})},ssChanged(t){this.$emit("ssChanged",t.target.value)}},template:'\n\t\t<div>\n\t\t\t<select v-model="selectedOption" @change="ssChanged" class="form-control" id="studiensemester">\n\t\t\t\t<option v-for="option in options" :value="option.studiensemester_kurzbz">\n\t\t\t\t\t{{ option.studiensemester_kurzbz }}\n\t\t\t\t</option>\n\t\t\t</select>\n\t\t</div>\n\t'}},data:function(){return{tabulatorUuid:Vue.ref(0),studiensemester:[],tableBuiltPromise:null,studentViewTabulatorOptions:{debugInvalidComponentFuncs:!1,layout:"fitDataStretch",selectable:!1,height:this.$entryParams.tabHeights.studentAnw,renderVerticalBuffer:2e3,placeholder:this.$p.t("global/noDataAvailable"),columns:[{title:"Lehrveranstaltung",visible:!1},{title:this.$capitalize(this.$p.t("global/datum")),field:"datum",formatter:A.formDateOnly,tooltip:!1,widthGrow:1,minWidth:150},{title:this.$capitalize(this.$p.t("ui/von")),field:"von",formatter:A.dateOnlyTimeFormatter,tooltip:!1,widthGrow:1,minWidth:150},{title:this.$capitalize(this.$p.t("global/bis")),field:"bis",formatter:A.dateOnlyTimeFormatter,tooltip:!1,widthGrow:1,minWidth:150},{title:this.$capitalize(this.$p.t("global/einheiten")),field:"dauer",formatter:this.einheitenFormatter,tooltip:!1,widthGrow:1,minWidth:250},{title:this.$capitalize(this.$p.t("global/anteilAnw")),field:"anteil",bottomCalcFormatter:this.sumBottomCalcFormatter,bottomCalcParams:this.bottomCalcParamLookup,tooltip:!1,bottomCalc:this.anwCalc,formatter:this.percentFormatter},{title:this.$capitalize(this.$p.t("global/anwesend")),field:"student_status",formatter:this.formAnwesenheit,tooltip:!1,minWidth:150}],groupBy:["lehrveranstaltung_id"],groupStartOpen:!1,groupHeader:this.customGroupHeader,groupToggleElement:"header",persistence:{sort:!1,filter:!0,headerFilter:!1,group:!0,page:!0,columns:!0},persistenceID:this.$entryParams.patchdate+"-studentAnwTable"},studentViewTabulatorEventHandlers:[{event:"tableBuilt",handler:async()=>{await this.$entryParams.phrasenPromise,this.tableBuiltResolve()}}],sums:{},filterTitle:""}},methods:{customGroupHeader(t,e,n){return'<div style="display:flex; justify-content: space-between;"><div>'+("German"==this.$p.user_language.value?n[0].bezeichnung:n[0].bezeichnung_english)+'</div><div style="flex-grow: 1; text-align: right;">'+this.$p.t("global/anwesenheit")+": "+n[0].anwesenheit+" %</div></div>"},percentFormatter:function(t){const e=t.getData();return'<div style="display: flex; justify-content: center; align-items: center; height: 100%">'+(e.sum??e.anteil??"-")+" %</div>"},bottomCalcParamLookup(t,e){const n=e[0];return n?n.anwesenheit+" %":""},einheitenFormatter:function(t){const e=Number(t.getValue());let n=t.getValue()/60/this.$entryParams.permissions.einheitDauer;return n%1>0&&(n=n.toFixed(2).replace(".",",")),'<div style="display: flex; justify-content: center; align-items: center; height: 100%">'+e+" "+this.$p.t("global/minuten")+" / "+n+" "+this.$p.t("global/einheiten")+"</div>"},formAnwesenheit:function(t){let e=t.getValue();if(e===this.$entryParams.permissions.anwesend_status||e===this.$entryParams.permissions.entschuldigt_status){t.getElement().style.color="#28a745";let n="";return e===this.$entryParams.permissions.entschuldigt_status&&(n=" "+this.$p.t("global/entschuldigungAkzeptiert")),'<div style="display: flex; justify-content: center; align-items: center; height: 100%;"><i class="fa fa-check" style="margin-right: 4px;"></i> '+n+"</div>"}if(e===this.$entryParams.permissions.abwesend_status){let e="";return t.getElement().style.color="#dc3545",t.getData().hasOffene?e=" "+this.$p.t("global/entschuldigungOffen"):t.getData().hasAbgelehnte&&(e=" "+this.$p.t("global/entschuldigungAbgelehnt")),'<div style="display: flex; justify-content: center; align-items: center; height: 100%;"><i class="fa fa-xmark" style="margin-right: 4px;"></i> '+e+"</div>"}return"-"},ssChangedHandler:async function(t){this.studiensemester=t,this.loadAnwesenheitenByUID()},async loadAnwesenheitenByUID(){await this.$entryParams.profileViewDataPromise;const t=this.$entryParams.selected_student_info?this.$entryParams?.selected_student_info.uid:this.$entryParams.viewDataStudent.student_uid,e=this.$entryParams.selected_student_info?this.$entryParams?.selected_student_info.person_id:this.$entryParams.viewDataStudent.person_id;t&&this.$api.call(z.getAllAnwByUID(this.studiensemester,t,e)).then(t=>{if("success"!==t.meta.status)this.$fhcAlert.alertError(this.$p.t("global/errorLoadingAnwesenheiten"));else{const e=this.processAnw(t.data);this.$refs.uebersichtTable.tabulator.setData(e)}})},anwCalc:(t,e,n)=>n,processAnw(t){const e=t[0].retval;if(this.sums={},e.forEach(t=>{this.sums[t.lehrveranstaltung_id]?this.sums[t.lehrveranstaltung_id]+=t.dauer:this.sums[t.lehrveranstaltung_id]=t.dauer}),e.forEach(t=>{t.vonDate=new Date(t.von),t.bisDate=new Date(t.bis),t.anteil=(t.dauer/this.sums[t.lehrveranstaltung_id]*100).toFixed(2)}),this.$entryParams.permissions.entschuldigungen_enabled){const n=t[1].retval;n.forEach(t=>{t.vonDate=new Date(t.von),t.bisDate=new Date(t.bis)});const i=n.filter(t=>null===t.akzeptiert),a=n.filter(t=>!1===t.akzeptiert);i.forEach(t=>{e.filter(e=>e.vonDate>=t.vonDate&&e.bisDate<=t.bisDate&&e.student_status===this.$entryParams.permissions.abwesend_status).forEach(t=>t.hasOffene=!0)}),a.forEach(t=>{e.filter(e=>e.vonDate>=t.vonDate&&e.bisDate<=t.bisDate&&e.student_status===this.$entryParams.permissions.abwesend_status).forEach(t=>t.hasAbgelehnte=!0)})}return e},async reload(){this.loadAnwesenheitenByUID()},redrawTable(){this.$refs.uebersichtTable?.tabulator&&this.$refs.uebersichtTable.tabulator.redraw(!0)},async setup(){await this.$entryParams.setupPromise,await this.$entryParams.phrasenPromise,await this.tableBuiltPromise,this.loadAnwesenheitenByUID(),this.studiensemester=this.$entryParams.sem_kurzbz},tableResolve(t){this.tableBuiltResolve=t},handleUuidDefined(t){this.tabulatorUuid=t},sumBottomCalcFormatter(t){const e=Number.parseFloat(t.getValue());if(Number.isNaN(e))return t.getValue();if(e<100*this.$entryParams.permissions.positiveRatingThreshold){t.getElement().style.setProperty("color","red")}return t.getValue()},calculateTableHeight(){const t=this.tabulatorUuid?"-"+this.tabulatorUuid:"",e=document.getElementById("filterTableDataset"+t);if(!e)return;const n=document.getElementById("filterCollapsables"+t),i=e.getBoundingClientRect(),a=this.$entryParams.isInFrame?window.frameElement.clientHeight:window.visualViewport.height;this.$entryParams.tabHeights.studentAnw.value=a-i.top-n.clientHeight,this.$refs.uebersichtTable.tabulator&&this.$refs.uebersichtTable.tabulator.redraw(!0)}},mounted(){this.tableBuiltPromise=new Promise(this.tableResolve),this.setup(),this.calculateTableHeight(),window.addEventListener("resize",this.calculateTableHeight),window.addEventListener("orientationchange",this.calculateTableHeight)},unmounted(){window.removeEventListener("resize",this.calculateTableHeight),window.removeEventListener("orientationchange",this.calculateTableHeight)},computed:{getTooltipObj(){return{value:this.$p.t("global/tooltipStudentAnwesenheit"),class:"custom-tooltip"}}},template:'\n\t<core-base-layout\n\t\t:title="filterTitle">\n\t\t<template #main>\n\t\t\t<div ref="studentAnwContentHeader" class="row" style="justify-content: flex-end;">\n\t\t\t\t\n\t\t\t\t\t<div style="max-width: 50px; align-content: center;" v-tooltip.bottom="getTooltipObj">\n\t\t\t\t\t\t<h5><i class="fa fa-circle-question"></i></h5>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t<div class="col-2">\n\t\t\t\t\t<StudiensemesterDropdown @ssChanged="ssChangedHandler"></StudiensemesterDropdown>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<core-filter-cmpt\n\t\t\t\tref="uebersichtTable"\n\t\t\t\t@uuidDefined="handleUuidDefined"\n\t\t\t\t:tabulator-options="studentViewTabulatorOptions"\n\t\t\t\t:tabulator-events="studentViewTabulatorEventHandlers"\n\t\t\t\t:tableOnly="true"\n\t\t\t\t:sideMenu="false"\n\t\t\t></core-filter-cmpt>\n\t\t</template>\n\n\t</core-base-layout>\n'};const Tt={name:"Range",data:()=>({}),props:{modelValue:null},created(){},methods:{},watch:{},computed:{modelKeys(){return this.modelValue?Object.keys(this.modelValue):[]}},template:'\n\t\t<div v-if="modelValue" style="max-height: 400px; overflow-y: auto; display: flex; gap: 2px;">\n\t\t\t<template v-for="key in modelKeys">\n\t\t\t\t<span style="display: inline-block; margin-right: 2px;"><span style="font-weight: bold">{{key}}</span>: {{modelValue[key]}} </span>\n\t\t\t</template>\n\t\t</div>\n\t'},Ft={name:"AnwTimeline",components:{Datepicker:r,Timeline:primevue.timeline,Range:Tt},data:()=>({timelineStart:new Date(new Date(Date.now()).getFullYear(),0,1,0,0,0,0),timelineEnd:new Date(new Date(Date.now()).getFullYear(),12,31,0,0,0,0),hourWidth:20,selectedRange:null}),props:{modelValue:null,anwArray:null,entArray:null},methods:{formatDateTimelineStart:t=>`Timeline Start: ${t.getDate()}.${t.getMonth()+1}.${t.getFullYear()}`,formatDateTimelineEnd:t=>`Timeline End: ${t.getDate()}.${t.getMonth()+1}.${t.getFullYear()}`,formatEntTime(t){return this.formatDate(t.von)+" - "+this.formatDate(t.bis)},highlightEntschuldigung(t){const e="entRange-"+t.entschuldigung_id,n=document.getElementById(e);n&&n.scrollIntoView({behavior:"smooth",block:"center"})},highlightKontrolle(t){const e="anwRange-"+t.anwesenheit_id,n=document.getElementById(e);n&&n.scrollIntoView({behavior:"smooth",block:"center"})},showRangeDetails(t){this.selectedRange=t},dateToPercentage(t){const e=new Date(Date.parse(t));return this.getDaysBetweenDates(e,this.timelineStart)/this.getDaysBetweenDates(this.timelineStart,this.timelineEnd)*100},getRangeColor:t=>!0===t?"rgba(0, 123, 255, 0.2)":!1===t?"rgba(220, 53, 69, 0.2)":"rgba(32, 201, 151, 0.2)",getRangeColorAnw:t=>"anwesend"===t.status?"rgba(182,252,0,0.66)":"abwesend"===t.status?"rgba(255,4,4,0.68)":"entschuldigt"===t.status?"rgba(3,53,245,0.91)":void 0,getOverlayStyleEnt(t){const e=new Date(t.von),n=new Date(t.bis),i=this.getRangeColor(t.akzeptiert),a=this.getDaysBetweenDates(e,this.timelineStart),s=this.getDaysBetweenDates(e,n),r=n.getHours()+n.getMinutes()/60-(e.getHours()+e.getMinutes()/60),l=e.getHours()+e.getMinutes()/60,o=Math.round(1e4/(24*s+r));return{position:"absolute",top:"0",left:a*this.dayWidth+l*this.hourWidth+"px",width:s*this.dayWidth+r*this.hourWidth+"px",height:"100%",transform:"translateY(-20px)",backgroundColor:i,zIndex:9999+o,borderRadius:"6px"}},getOverlayStyleAnw(t){const e=new Date(t.von),n=new Date(t.bis),i=this.getRangeColorAnw(t),a=this.getDaysBetweenDates(e,this.timelineStart),s=this.getDaysBetweenDates(e,n),r=n.getHours()+n.getMinutes()/60-(e.getHours()+e.getMinutes()/60),l=e.getHours()+e.getMinutes()/60,o=Math.round(1e4/(24*s+r));return{position:"absolute",top:"0",left:a*this.dayWidth+l*this.hourWidth+"px",width:s*this.dayWidth+r*this.hourWidth+"px",height:"100%",transform:"translateY(20px)",backgroundColor:i,zIndex:9999+o,borderRadius:"6px"}},getDaysBetweenDates(t,e){const n=Math.abs(t-e);return Math.floor(n/864e5)},formatDate(t){const e=new Date(t),n=t=>String(t).padStart(2,"0"),i=n(e.getMonth()+1);return`${n(e.getDate())}.${i}.${e.getFullYear()} ${n(e.getHours())}:${n(e.getMinutes())}`},getTimelineEventStyle(){return{width:`${this.dayWidth}px`,transform:`translateX(-${this.dayWidth/2}px)`,minHeight:"420px"}},handleScrollTimeline(t){t.wheelDelta>0?this.hourWidth*=1.2:t.wheelDelta<0&&(this.hourWidth=this.hourWidth/120*100)},goToday(){const t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");this.scrollToDate(`${e}-${n}-${i}`)},scrollToDate(t){setTimeout(()=>{const e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"center"})},200)},anwDateFormat(t){const e=t.von.split(" "),n=t.bis.split(" ");return`${e[0]} | ${e[1]} - ${n[1]}`}},watch:{modelValue:{handler(t){t&&setTimeout(()=>{const e="entRange-"+t.entschuldigung_id,n=document.getElementById(e);n&&n.scrollIntoView({behavior:"smooth",block:"center"})},200)},deep:!0}},computed:{getTooltipAnwTimeline(){return{value:this.$p.t("global/tooltipAnwTimeline"),class:"custom-tooltip"}},dayWidth(){return 24*this.hourWidth},timelineWidth(){return this.getDaysBetweenDates(this.timelineStart,this.timelineEnd)*this.dayWidth},entTimeRanges(){return this.entArray?this.entArray.filter(t=>new Date(t.von)>=this.timelineStart&&new Date(t.bis)<=this.timelineEnd):[]},anwTimeRanges(){return this.anwArray?this.anwArray.filter(t=>new Date(t.von)>=this.timelineStart&&new Date(t.bis)<=this.timelineEnd):[]},events(){const t=[];let e=new Date(this.timelineStart);for(;e<=this.timelineEnd;){const n=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),s=`${n}-${i}-${a}`;t.push({title:`${i}/${a}`,date:s}),e.setDate(e.getDate()+1)}return t},getTimelineStyle(){return{minWidth:this.timelineWidth+"px","--timeline-event-width":this.dayWidth+"px"}}},mounted(){this.modelValue?setTimeout(()=>{const t="entRange-"+newVal.entschuldigung_id,e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"center"})},200):this.goToday()},template:'\n\t<div v-if="anwArray && entArray" class="row" style="padding: 0px; margin: 0px;">\n\t\t<div class="col-3">\n\t\t\t<p>Entschuldigungen</p>\n\t\t\t<div style="max-height: 400px; overflow: auto;">\n\t\t\t\t<template v-for="ent in entArray" :key="\'entmenu-\'+ent.entschuldigung_id">\n\t\t\t\t\t<div class="position-relative" >\n\t\t\t\t\t\t<button type="button" class="btn btn-light" @click="highlightEntschuldigung(ent)"><span>{{ent.entschuldigung_id}}: {{formatEntTime(ent)}}</span></button>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="col-3"> \n\t\t\t<div style="max-height: 400px; overflow: auto;">\n\t\t\t\t<p>Anwesenheitskontrollen</p>\n\t\t\t\t<template v-for="anw in anwArray" :key="\'anwmenu-\'+anw.anwesenheit_id">\n\t\t\t\t\t<div class="position-relative" >\n\t\t\t\t\t\t<button type="button" class="btn btn-light" @click="highlightKontrolle(anw)"><span>{{anw.anwesenheit_id}}: {{ anwDateFormat(anw) }}</span></button>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="col-6">\n\t\t\t<div class="row">\n\t\t\t\t<Range v-model="selectedRange"/>\n\t\t\t</div>\n\t\t\t<div class="row mt-2">\n\t\t\t\t<div class="col-4">\n\t\t\t\t\t<datepicker\n\t\t\t\t\t\tid="timelineStart"\n\t\t\t\t\t\tv-model="timelineStart"\n\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t:format="formatDateTimelineStart"\n\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t:time-picker="false">\n\t\t\t\t\t</datepicker>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-4">\n\t\t\t\t\t<datepicker\n\t\t\t\t\t\tid="timelineEnd"\n\t\t\t\t\t\tv-model="timelineEnd"\n\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t:format="formatDateTimelineEnd"\n\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t:time-picker="false">\n\t\t\t\t\t</datepicker>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-2"><button type="button" class="btn btn-primary" @click="goToday">today</button></div>\n\t\t\t\t<div v-tooltip.bottom="getTooltipAnwTimeline">\n\t\t\t\t\t<i class="fa fa-circle-question"></i>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="row" style="padding: 0px; margin: 0px;">\n\t\t\t<div @wheel.prevent="handleScrollTimeline" class="custom-timeline-scroll-wrapper p-5" style="margin-left: 12px; margin-right:12px;">\n\t\t\t\t<div class="timeline-container position-relative" :style="getTimelineStyle">\n\t\t\t\t\t\x3c!-- Ent Range Overlays --\x3e\n\t\t\t\t\t<div\n\t\t\t\t\t  v-for="(range, index) in entTimeRanges"\n\t\t\t\t\t  :key="\'entRange-\' + index"\n\t\t\t\t\t  :id="\'entRange-\' + range.entschuldigung_id"\n\t\t\t\t\t  class="timeline-overlay"\n\t\t\t\t\t  :style="getOverlayStyleEnt(range)"\n\t\t\t\t\t  @click="showRangeDetails(range)"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="time-marker start">{{ formatDate(range.von) }}</div>\n\t\t\t\t\t\t<div class="time-marker end" style="transform: translateY(20px)">{{ formatDate(range.bis) }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t\x3c!-- Anw Overlays --\x3e\n\t\t\t\t\t<div\n\t\t\t\t\t  v-for="(range, index) in anwTimeRanges"\n\t\t\t\t\t  :key="\'anwRange-\' + index"\n\t\t\t\t\t  :id="\'anwRange-\' + range.anwesenheit_id"\n\t\t\t\t\t  class="timeline-overlay"\n\t\t\t\t\t  :style="getOverlayStyleAnw(range)"\n\t\t\t\t\t  @click="showRangeDetails(range)"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="time-marker start">{{ formatDate(range.von) }}</div>\n\t\t\t\t\t\t<div class="time-marker end" style="transform: translateY(20px)">{{ formatDate(range.bis) }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t\t\x3c!-- Timeline --\x3e\n\t\t\t\t\t<Timeline :value="events" layout="horizontal" :unstyled="true" dataKey="date">\n\t\t\t\t\t\t<template #marker="event">\n\t\t\t\t\t\t\t<div style="background-color: purple; width: 24px; height: 24px;" :id="event.item.date"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template #content="slotProps">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="event-card text-center p-2"\n\t\t\t\t\t\t\t:style="getTimelineEventStyle(slotProps.item)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<h6>{{ slotProps.item.title }}</h6>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Timeline>\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div v-else class="text-center">\n\t\t<i class="fa-solid fa-spinner fa-pulse fa-3x"></i>\n\t</div>\n\t'},xt={name:"StudentComponent",components:{AnwTimeline:Ft,CoreNavigationCmpt:w,CoreBaseLayout:$,CoreTabs:kt,BsModal:S,StudentDropdown:Pt,StudentAnwesenheitComponent:Et},data:function(){return{tabsStudent:this.getTabsStudent(),viewDataStudent:{}}},props:{permissions:[]},methods:{getTabsStudent(){const t={anwesenheiten:{title:this.$p.t("global/anwesenheiten"),component:"../../extensions/FHC-Core-Anwesenheiten/js/components/Student/StudentAnwesenheitComponent.js"}};return this.$entryParams.permissions.entschuldigungen_enabled&&(t.entschuldigungen={title:this.$p.t("global/entschuldigungen"),component:"../../extensions/FHC-Core-Anwesenheiten/js/components/Student/StudentEntschuldigungComponent.js"}),this.$entryParams.permissions.admin&&(t.timeline={title:this.$p.t("global/anwTimelineV2"),component:"../../extensions/FHC-Core-Anwesenheiten/js/components/Student/AnwTimelineWrapper.js"}),t},routeToCodeScan(){this.$router.push({name:"Scan"})},checkEntryParamPermissions(){void 0===this.$entryParams.permissions&&(this.$entryParams.permissions=JSON.parse(this.permissions)),void 0===this.$entryParams.phrasenPromise&&(this.$entryParams.phrasenPromise=this.$p.loadCategory(["global","person","lehre","table","filter","ui"]))},handleTabChanged(t){this.$refs.tabsStudent?._?.refs?.current?.redrawTable&&this.$refs.tabsStudent._.refs.current.redrawTable()},async setup(){await this.$entryParams.setupPromise,await this.$entryParams.phrasenPromise,this.$entryParams.profileViewDataPromise=new Promise(t=>{if(this.$entryParams.selected_student_info){const e=this.$entryParams.selected_student_info;this.viewDataStudent.vorname=e.vorname,this.viewDataStudent.nachname=e.nachname,this.viewDataStudent.student_uid=e.student_uid?e.student_uid:e.uid,this.viewDataStudent.person_id=e.person_id,this.viewDataStudent.prestudent_id=e.prestudent_id,this.viewDataStudent.gruppe=e.gruppe,this.viewDataStudent.verband=e.verband,this.viewDataStudent.semester=e.semester,t()}else this.$api.call(z.getProfileViewData(null)).then(e=>{const n=e.data.retval[0];this.viewDataStudent.vorname=n.vorname,this.viewDataStudent.nachname=n.nachname,this.viewDataStudent.student_uid=n.student_uid,this.viewDataStudent.person_id=n.person_id,this.viewDataStudent.prestudent_id=n.prestudent_id,this.viewDataStudent.gruppe=n.gruppe,this.viewDataStudent.verband=n.verband,this.viewDataStudent.semester=n.semester,this.$entryParams.viewDataStudent=n,t()})})},studentChangedHandler(){this.$refs.tabsStudent._.refs.current.reload();const t=this.$entryParams.selected_student_info.uid?this.$entryParams.selected_student_info.uid:this.$entryParams.selected_student_info.student_uid;this.$api.call(z.getProfileViewData(t)).then(t=>{if(!t?.data?.retval?.[0])return;const e=t.data.retval[0];this.viewDataStudent.vorname=e.vorname,this.viewDataStudent.nachname=e.nachname,this.viewDataStudent.student_uid=e.student_uid,this.viewDataStudent.person_id=e.person_id,this.viewDataStudent.prestudent_id=e.prestudent_id,this.viewDataStudent.gruppe=e.gruppe,this.viewDataStudent.verband=e.verband,this.viewDataStudent.semester=e.semester,this.$entryParams.viewDataStudent=e})},async awaitPhrasen(){await this.$entryParams.phrasenPromise},redrawTable(){}},created(){},mounted(){this.checkEntryParamPermissions(),this.setup(),this.$entryParams.activetabstudent&&this.$refs.tabsStudent.change(this.$entryParams.activetabstudent)},template:'\n\t<div class="row-cols">\n\t\t<core-base-layout>\t\n\t\t\t<template #main>\t\n\t\t\t\t<div ref="studentHeaderRow" class="row">\n\t\t\t\t\t<div class="col-6">\n\t\t\t\t\t\t<h1 class="h4">\n\t\t\t\t\t\t\t{{ viewDataStudent.vorname }} {{viewDataStudent.nachname }} \n\t\t\t\t\t\t\t<span class="fhc-subtitle">{{viewDataStudent.semester }}{{viewDataStudent.verband }}{{viewDataStudent.gruppe }}</span>\n\t\t\t\t\t\t</h1>\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col-3">\n\t\t\t\t\t\t<StudentDropdown v-if="$entryParams?.permissions?.admin || $entryParams?.permissions?.assistenz"\n\t\t\t\t\t\t\t id="studentUID" ref="studentDropdown" @studentChanged="studentChangedHandler">\n\t\t\t\t\t\t</StudentDropdown>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col-2 text-center">\n\t\t\t\t\t\t<button type="button" class="btn btn-primary" @click="routeToCodeScan">{{ $p.t(\'global/codeEingeben\') }}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<template v-if="$entryParams?.permissions?.entschuldigungen_enabled">\n\t\t\t\t\t<core-tabs :config="tabsStudent" ref="tabsStudent" @changed="handleTabChanged"></core-tabs>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<StudentAnwesenheitComponent/>\t\t\t\t\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t</core-base-layout>\n\t\t\n\t</div>\n\t\t\n'};var zt={components:{DmsItem:{emits:["delete"],props:{modelValue:{type:[File,Object],required:!0}},data:()=>({preview:""}),watch:{modelValue(t){"application/x.fhc-dms+json"==t.type&&t.text().then(t=>{const e=JSON.parse(t);this.preview=e.preview||""})}},template:'\n\t<li class="form-upload-dms-item">\n\t\t<span class="col-auto"><i class="fa fa-file me-1"></i></span>\n\t\t<span class="col">{{ modelValue.name }}</span>\n\t\t<a v-if="preview" :href="preview" target="_blank" class="col-auto btn btn-outline-secondary btn-p-0 me-1">\n\t\t\t<i class="fa fa-download"></i>\n\t\t</a>\n\t\t<button class="col-auto btn btn-outline-secondary btn-p-0" @click="$emit(\'delete\')">\n\t\t\t<i class="fa fa-close"></i>\n\t\t</button>\n\t</li>'}},emits:["update:modelValue"],props:{modelValue:{type:[FileList,Array],required:!0},multiple:Boolean,id:String,name:String,inputClass:[String,Array,Object],noList:Boolean,accept:{type:String,default:""},disabled:{type:Boolean,default:!1}},methods:{stringifyFile:t=>JSON.stringify({lastModified:t.lastModified,lastModifiedDate:t.lastModifiedDate,name:t.name,size:t.size,type:t.type}),addFiles(t){if(!this.multiple)return this.$emit("update:modelValue",t.target.files);const e=new DataTransfer,n=[];for(var i of this.modelValue)e.items.add(i),n.push(this.stringifyFile(i));for(var i of t.target.files)n.indexOf(this.stringifyFile(i))<0&&e.items.add(i);this.$emit("update:modelValue",e.files)},removeFile(t){const e=Array.from(this.modelValue)[t],n=new DataTransfer;for(var i of this.modelValue)i!==e&&n.items.add(i);this.$emit("update:modelValue",n.files)}},watch:{modelValue(t){if(!t)return;if(t instanceof FileList){if(!this.$refs.upload)return;return this.$refs.upload.files=t}const e=new DataTransfer;for(var n of t)if(n instanceof File)e.items.add(n);else{const t=new File([JSON.stringify(n)],n.name,{type:"application/x.fhc-dms+json"});e.items.add(t)}this.$emit("update:modelValue",e.files)}},template:'\n\t<div class="form-upload-dms">\n\t\t<input ref="upload" class="form-control" :disabled="disabled" :accept="accept" :aria-label="$p.t(\'profilUpdate\',\'documentUpload\')" :title="$p.t(\'profilUpdate\',\'documentUpload\')" :class="inputClass" :id="id" :name="name" :multiple="multiple" type="file" @change="addFiles">\n\t\t<ul v-if="modelValue.length && multiple && !noList" :accept="accept" class="list-unstyled m-0">\n\t\t\t<dms-item\n\t\t\t\tv-for="(file, index) in modelValue"\n\t\t\t\t:key="index"\n\t\t\t\tv-model="file"\n\t\t\t\tclass="d-flex mx-1 mt-1 align-items-start"\n\t\t\t\t@delete="removeFile(index)"\n\t\t\t\t>\n\t\t\t</dms-item>\n\t\t</ul>\n\t</div>'},Lt={name:"StudentEntschuldigungComponent",components:{CoreBaseLayout:$,CoreRESTClient:mt,CoreFilterCmpt:b,BsModal:S,Upload:zt,datepicker:r,Checkbox:primevue.checkbox},data:function(){return{noFileUpload:!1,editEntschuldigung:null,tabulatorUuid:Vue.ref(0),entschuldigung:this.initEntschuldigungForm(),minDate:this.calcMinDate(),tableBuiltPromise:null,entschuldigungsViewTabulatorOptions:{ajaxURL:FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/extensions/FHC-Core-Anwesenheiten/api/ProfilApi/getEntschuldigungenByPersonID",ajaxResponse:(t,e,n)=>n.data.retval,height:this.$entryParams.tabHeights.studentEnt,ajaxConfig:"POST",ajaxContentType:{headers:{"Content-Type":"application/json"},body:()=>JSON.stringify({person_id:this.$entryParams.selected_student_info?this.$entryParams.selected_student_info.person_id:this.$entryParams.viewDataStudent.person_id})},placeholder:this._.root.appContext.config.globalProperties.$p.t("global/noDataAvailable"),debugInvalidComponentFuncs:!1,layout:"fitDataStretch",pagination:!0,paginationSize:100,columns:[{title:this.$capitalize(this.$p.t("global/status")),field:"akzeptiert",formatter:this.entschuldigungstatusFormatter,minWidth:200,tooltip:!1,widthGrow:1},{title:this.$capitalize(this.$p.t("ui/von")),field:"von",formatter:_.formDate,minWidth:200,widthGrow:1},{title:this.$capitalize(this.$p.t("global/bis")),field:"bis",formatter:_.formDate,minWidth:200,widthGrow:1},{title:this.$capitalize(this.$p.t("ui/aktion")),field:"dms_id",formatter:this.formAction,widthGrow:1,minWidth:200,tooltip:!1},{title:this.$capitalize(this.$p.t("global/begruendungAnw")),field:"notiz",tooltip:!1}],persistence:{sort:!1,filter:!0,headerFilter:!1,group:!0,page:!0,columns:!0},persistenceID:this.$entryParams.patchdate+"-studentEntschuldigungenTable"},entschuldigungsViewTabulatorEventHandlers:[{event:"tableBuilt",handler:async()=>{await this.$entryParams.phrasenPromise,this.tableBuiltResolve()}}],filterTitle:""}},methods:{initEntschuldigungForm:()=>({von:new Date(new Date(Date.now()).getFullYear(),new Date(Date.now()).getMonth(),new Date(Date.now()).getDate(),0,0,0,0),bis:new Date(new Date(Date.now()).getFullYear(),new Date(Date.now()).getMonth(),new Date(Date.now()).getDate()+1,23,59,0,0),files:[]}),formatDate(t){const e=new Date(t),n=t=>String(t).padStart(2,"0"),i=n(e.getMonth()+1);return`${n(e.getDate())}.${i}.${e.getFullYear()} ${n(e.getHours())}:${n(e.getMinutes())}`},formatDateEntschuldigungEdit(t){const e=t=>String(t).padStart(2,"0"),n=e(t.getMonth()+1);return`${e(t.getDate())}.${n}.${t.getFullYear()} ${e(t.getHours())}:${e(t.getMinutes())}`},calcMinDate(){let t=new Date;for(let e=this.$entryParams.permissions.entschuldigungMaxReach;e>0;e--)t.setDate(t.getDate()-(1===t.getDay()?3:1));return t},isValidDateObj:t=>t instanceof Date&&!isNaN(t.getTime()),entschuldigungstatusFormatter(t){let e=t.getValue();return null==e?(t.getElement().style.color="#17a2b8",this.$p.t("global/entschuldigungOffen")):!0===e?(t.getElement().style.color="#28a745",this.$p.t("global/entschuldigungAkzeptiert")):!1===e?(t.getElement().style.color="#dc3545",this.$p.t("global/entschuldigungAbgelehnt")):void 0},triggerEdit(){if(!this.entschuldigung.files.length)return this.$fhcAlert.alertWarning(this.$p.t("global/warningChooseFile")),!1;const t=new FormData;for(let e=0;e<this.entschuldigung.files.length;e++)t.append("files",this.entschuldigung.files[e]);t.append("von",this.isValidDateObj(this.editEntschuldigung.von)?this.editEntschuldigung.von.toISOString():this.editEntschuldigung.von),t.append("bis",this.isValidDateObj(this.editEntschuldigung.bis)?this.editEntschuldigung.bis.toISOString():this.editEntschuldigung.bis),t.append("entschuldigung_id",this.editEntschuldigung.entschuldigung_id);const e=this.$entryParams.selected_student_info?this.$entryParams?.selected_student_info.person_id:this.$entryParams.viewDataStudent.person_id;t.append("person_id",e),this.$api.call(z.editEntschuldigung(t)).then(t=>{if("success"===t.meta.status){let e=this.$refs.entschuldigungsTable.tabulator.getRows().find(e=>e.getData().entschuldigung_id==t.data.entschuldigung_id);e&&e.update({dms_id:t.data.dms_id}),this.$fhcAlert.alertSuccess(this.$p.t("global/entschuldigungUploaded"))}}).finally(()=>{this.$refs.modalContainerEntschuldigungEdit.hide()})},triggerUpload(){if(!this.validate())return!1;const t=new FormData;if(this.noFileUpload)t.append("noFileUpload",this.noFileUpload);else for(let e=0;e<this.entschuldigung.files.length;e++)t.append("files",this.entschuldigung.files[e]);t.append("von",this.entschuldigung.von.toISOString()),t.append("bis",this.entschuldigung.bis.toISOString());const e=this.$entryParams.selected_student_info?this.$entryParams?.selected_student_info.person_id:this.$entryParams.viewDataStudent.person_id;t.append("person_id",e),this.$api.call(z.addEntschuldigung(t)).then(t=>{let e=t.data;this.$refs.entschuldigungsTable.tabulator.addRow({dms_id:e.dms_id,akzeptiert:null,von:e.von,bis:e.bis,entschuldigung_id:e.entschuldigung_id},!0),this.$fhcAlert.alertSuccess(this.$p.t("global/entschuldigungUploaded")),this.entschuldigung=this.initEntschuldigungForm()}),this.$refs.modalContainerEntschuldigungUpload.hide()},formAction:function(t){let e=document.createElement("div");e.className="d-flex gap-3";let n=document.createElement("button");n.className="btn btn-outline-secondary";const i="40px";return t.getData().dms_id?(n.innerHTML='<i class="fa fa-download"></i>',n.style.minWidth=i,n.addEventListener("click",()=>this.downloadEntschuldigung(t.getData().dms_id)),n.title=this.$p.t("global/download"),e.append(n)):(n.innerHTML='<i class="fa fa-upload"></i>',n.style.minWidth=i,n.addEventListener("click",()=>this.addEntschuldigungFile(t.getData())),n.title=this.$p.t("global/upload"),e.append(n)),null==t.getData().akzeptiert&&(n=document.createElement("button"),n.className="btn btn-outline-secondary",n.style.minWidth=i,n.innerHTML='<i class="fa fa-xmark"></i>',n.title=this.$p.t("global/entschuldigungLöschen"),n.addEventListener("click",()=>this.deleteEntschuldigung(t,"decline")),e.append(n)),e},addEntschuldigungFile(t){this.editEntschuldigung=t,this.$refs.modalContainerEntschuldigungEdit.show()},downloadEntschuldigung:function(t){window.location=mt._generateRouterURI("extensions/FHC-Core-Anwesenheiten/Profil/getEntschuldigungFile?entschuldigung="+t)},async deleteEntschuldigung(t){if(!1===await this.$fhcAlert.confirmDelete())return;let e=t.getData().entschuldigung_id;this.$api.call(z.deleteEntschuldigung(e,this.$entryParams.selected_student_info?.person_id)).then(e=>{"success"===e.meta.status&&(t.getRow().delete(),this.$fhcAlert.alertSuccess(this.$p.t("global/entschuldigungLöschenErfolg")))})},startUploadEntschuldigung(){this.$refs.modalContainerEntschuldigungUpload.show()},validate:function(){return this.entschuldigung.von?this.entschuldigung.bis?this.entschuldigung.files.length||this.noFileUpload?!(this.entschuldigung.bis<this.entschuldigung.von)||(this.$fhcAlert.alertWarning(this.$p.t("global/errorValidateTimes")),!1):(this.$fhcAlert.alertWarning(this.$p.t("global/warningChooseFile")),!1):(this.$fhcAlert.alertWarning(this.$p.t("global/warningEnterBisZeit")),!1):(this.$fhcAlert.alertWarning(this.$p.t("global/warningEnterVonZeit")),!1)},reload(){const t=this.$entryParams.selected_student_info?this.$entryParams.selected_student_info.person_id:this.$entryParams.viewDataStudent.person_id;this.$api.call(z.getEntschuldigungenByPersonID(t)).then(t=>{this.$refs.entschuldigungsTable.tabulator.setData(t.data.retval)})},redrawTable(){this.$refs?.entschuldigungsTable?.tabulator&&this.$refs.entschuldigungsTable.tabulator.redraw(!0)},tableResolve(t){this.tableBuiltResolve=t},async setup(){await this.$entryParams.setupPromise,await this.$entryParams.phrasenPromise,await this.tableBuiltPromise;const t=this.$refs.entschuldigungsTable.tabulator.getColumns();t.find(t=>"von"===t.getField()).updateDefinition({title:this.$p.t("global/status")}),t.find(t=>"bis"===t.getField()).updateDefinition({title:this.$capitalize(this.$p.t("ui/von"))}),t.find(t=>"student_status"===t.getField()).updateDefinition({title:this.$capitalize(this.$p.t("global/bis"))}),t.find(t=>"von"===t.getField()).updateDefinition({title:this.$p.t("ui/aktion")}),t.find(t=>"bis"===t.getField()).updateDefinition({title:this.$p.t("global/notiz")}),this.entschuldigungsViewTabulatorOptions.columns[0].title=this.$capitalize(this.$p.t("global/status")),this.entschuldigungsViewTabulatorOptions.columns[1].title=this.$capitalize(this.$p.t("ui/von")),this.entschuldigungsViewTabulatorOptions.columns[2].title=this.$capitalize(this.$p.t("global/bis")),this.entschuldigungsViewTabulatorOptions.columns[1].title=this.$capitalize(this.$p.t("ui/aktion")),this.entschuldigungsViewTabulatorOptions.columns[2].title=this.$capitalize(this.$p.t("global/notiz"))},handleUuidDefined(t){this.tabulatorUuid=t},calculateTableHeight(){const t=this.tabulatorUuid?"-"+this.tabulatorUuid:"",e=document.getElementById("filterTableDataset"+t);if(!e)return;const n=e.getBoundingClientRect(),i=this.$entryParams.isInFrame?window.frameElement.clientHeight:window.visualViewport.height;this.$entryParams.tabHeights.studentEnt.value=i-n.top,this.$refs.entschuldigungsTable.tabulator&&this.$refs.entschuldigungsTable.tabulator.redraw(!0)}},mounted(){this.minDate=new Date(this.minDate).setHours(0,0),this.tableBuiltPromise=new Promise(this.tableResolve),this.setup(),this.calculateTableHeight(),window.addEventListener("resize",this.calculateTableHeight),window.addEventListener("orientationchange",this.calculateTableHeight)},unmounted(){window.removeEventListener("resize",this.calculateTableHeight),window.removeEventListener("orientationchange",this.calculateTableHeight)},watch:{"entschuldigung.files"(t){if(t==[]||null==t)return;const e=t[0];e&&(e.type&&!e.name.includes("jfif")&&(e.type.includes("jpg")||e.type.includes("jpeg")||e.type.includes("pdf")||e.type.includes("png"))||(this.$fhcAlert.alertInfo(this.$p.t("global/allowedEntschuldigungFileTypes")),this.entschuldigung.files=[]))}},computed:{getTooltipObj(){return{value:this.$p.t("global/tooltipStudentEntschuldigung",[this.$entryParams.permissions.entschuldigungMaxReach]),class:"custom-tooltip"}}},template:'\n\n\t<core-base-layout\n\t\t:title="filterTitle">\n\t\t<template #main>\n\t\t\t<bs-modal ref="modalContainerEntschuldigungUpload" class="bootstrap-prompt" dialogClass="modal-lg">\n\t\t\t\t<template v-slot:title>\n\t\t\t\t\t<div v-tooltip.bottom="getTooltipObj">\n\t\t\t\t\t\t{{$p.t(\'global/addEntschuldigung\')}}\n\t\t\t\t\t\t<i class="fa fa-circle-question"></i>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:default>\n\t\t\t\t\t<div class="row mb-3 align-items-center">\n\t\t\t\t\t\t<div class="col-2 align-items-center"><label for="von" class="form-label">{{$capitalize($p.t(\'ui/von\'))}}</label></div>\n\t\t\t\t\t\t<div class="col-10">\n\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\tid="von"\n\t\t\t\t\t\t\t\tv-model="entschuldigung.von"\n\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t\t\t:enable-time-picker="true"\n\t\t\t\t\t\t\t\t:start-time="entschuldigung.von"\n\t\t\t\t\t\t\t\t:format="formatDate"\n\t\t\t\t\t\t\t\t:min-date="new Date(minDate)"\n\t\t\t\t\t\t\t\t:start-date="new Date(minDate)"\n\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="row mb-3 align-items-center">\n\t\t\t\t\t\t<div class="col-2 align-items-center"><label for="von" class="form-label">{{$capitalize($p.t(\'global/bis\'))}}</label></div>\n\t\t\t\t\t\t<div class="col-10">\n\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\tid="bis"\n\t\t\t\t\t\t\t\tv-model="entschuldigung.bis"\n\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t\t\t:enable-time-picker="true"\n\t\t\t\t\t\t\t\t:start-time="entschuldigung.bis"\n\t\t\t\t\t\t\t\t:format="formatDate"\n\t\t\t\t\t\t\t\t:min-date="new Date(minDate)"\n\t\t\t\t\t\t\t\t:start-date="new Date(minDate)"\n\t\t\t\t\t\t\t\t:text-input="true"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t<div class="col-8">\n\t\t\t\t\t\t\t<Upload :disabled="noFileUpload" accept=".jpg,.png,.pdf" v-model="entschuldigung.files"></Upload>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col-4">\n\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t<div class="col-2"></div>\n\t\t\t\t\t\t\t\t<div class="col-2"><Checkbox v-model="noFileUpload" :binary="true"></Checkbox></div>\n\t\t\t\t\t\t\t\t<div class="col-8"><span>{{$p.t(\'global/excuseUploadNoFile\')}}</span></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:footer>\n\t\t\t\t\t<button class="btn btn-primary" @click="triggerUpload">{{$p.t(\'ui/hochladen\')}}</button>\n\t\t\t\t</template>\n\t\t\t</bs-modal>\n\t\t\t\n\t\t\t<bs-modal ref="modalContainerEntschuldigungEdit" class="bootstrap-prompt" dialogClass="modal-lg">\n\t\t\t\t<template v-slot:title>\n\t\t\t\t\t<div v-tooltip.bottom="getTooltipObj">\n\t\t\t\t\t\t{{$p.t(\'global/editEntschuldigung\')}}\n\t\t\t\t\t\t<i class="fa fa-circle-question"></i>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:default v-if="editEntschuldigung">\n\t\t\t\t\t<div class="row mb-3 align-items-center" >\n\t\t\t\t\t\t<div class="col-2 align-items-center"><label for="von" class="form-label">{{$capitalize($p.t(\'ui/von\'))}}</label></div>\n\t\t\t\t\t\t<div class="col-10">\n\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\tid="vonEdit"\n\t\t\t\t\t\t\t\tv-model="editEntschuldigung.von"\n\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t:format="formatDateEntschuldigungEdit"\n\t\t\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t\t\t:disabled="true">\n\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="row mb-3 align-items-center">\n\t\t\t\t\t\t<div class="col-2 align-items-center"><label for="von" class="form-label">{{$capitalize($p.t(\'global/bis\'))}}</label></div>\n\t\t\t\t\t\t<div class="col-10">\n\t\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\t\tid="bisEdit"\n\t\t\t\t\t\t\t\tv-model="editEntschuldigung.bis"\n\t\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\t\t:format="formatDateEntschuldigungEdit"\n\t\t\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t\t\t:disabled="true"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</datepicker>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t<div class="col-12">\n\t\t\t\t\t\t\t<Upload accept=".jpg,.png,.pdf" v-model="entschuldigung.files"></Upload>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:footer>\n\t\t\t\t\t<button class="btn btn-primary" @click="triggerEdit">{{$p.t(\'ui/hochladen\')}}</button>\n\t\t\t\t</template>\n\t\t\t</bs-modal>\n\t\t\t\n\t\t\t<core-filter-cmpt\n\t\t\t\tref="entschuldigungsTable"\n\t\t\t\t@uuidDefined="handleUuidDefined"\n\t\t\t\t:tabulator-options="entschuldigungsViewTabulatorOptions"\n\t\t\t\t:table-only="true"\n\t\t\t\t:newBtnShow="true"\n\t\t\t\t:newBtnLabel="$p.t(\'global/entschuldigungHochladen\')"\n\t\t\t\t@click:new="startUploadEntschuldigung"\n\t\t\t\t:sideMenu="false"\n\t\t\t></core-filter-cmpt>\n\t\t</template>\n\t</core-base-layout>\n'},Rt={name:"ScanComponent",components:{CoreNavigationCmpt:w,CoreBaseLayout:$,CoreRESTClient:mt},data:function(){return{internalZugangscode:this.zugangscode,zugangscodeProcessed:!1,codeMaxlength:8,viewData:null,codeButtonDisabled:!0}},props:{zugangscode:null},methods:{sendCode(){this.processAnwesenheit()},processAnwesenheit(){this.$api.call(z.checkInAnwesenheit(this.internalZugangscode)).then(t=>{"success"===t.meta.status&&t.data?(this.$fhcAlert.alertSuccess(this.$p.t("global/eintragErfolgreich")),this.von=new Date(JSON.parse(t.data.von)),this.bis=new Date(JSON.parse(t.data.bis)),this.viewData=JSON.parse(t.data.viewData).retval[0],this.zugangscodeProcessed=!0):(this.$fhcAlert.alertError(t.data.data),this.internalZugangscode="")})},checkValue(t){this.internalZugangscode=t.target.value,this.codeButtonDisabled=!(this.internalZugangscode&&this.internalZugangscode.length===this.codeMaxlength)}},mounted(){this.internalZugangscode&&this.processAnwesenheit()},computed:{calculatedMaxLength(){return""+this.codeMaxlength},getBaseLayoutTitle(){return this.internalZugangscode&&this.zugangscodeProcessed?this.$p.t("global/eintragErfolgreich"):this.$p.t("global/bitteZugangscodeEingeben")}},template:'\n\t<div class="row-cols mb-4">\n\t\t<div class="row-col-4 mt-3 text-center">\n\t\t\t<core-base-layout\n\t\t\t\t:title=getBaseLayoutTitle>\n\t\t\t\t<template #main>\n\t\t\t\t\t<template v-if="!zugangscodeProcessed">\n\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t<div class="col-sm-10 col-10 mx-auto">\n\t\t\t\t\t\t\t\t<input :maxlength="calculatedMaxLength" class="form-control" :value="internalZugangscode" @input="checkValue($event)" :placeholder="$p.t(\'global/code\')">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="row mt-3">\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<button @click="sendCode" role="button" class="btn btn-primary align-self-center" :disabled=codeButtonDisabled>\n\t\t\t\t\t\t\t\t\t{{ $p.t(\'global/codeSenden\') }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else> \n\t\t\t\t\t\t<div v-if="viewData">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p>{{viewData.bezeichnung}} ({{viewData.kurzbz}})</p>\n\t\t\t\t\t\t\t\t<p>{{von.toLocaleDateString()}}:  {{von.toLocaleTimeString()}} - {{bis.toLocaleTimeString()}}</p>\n\t\t\t\t\t\t\t\t<p>{{viewData.vorname}} {{viewData.nachname}} {{$p.t(\'global/wurdeRegistriert\')}}.</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t</core-base-layout>\n\t\t</div>\n\t</div>\n\n\n\n\t\n\t\t\n'};const Ot={name:"StudiengangDropdown",components:{Dropdown:primevue.dropdown},emits:["sgChanged"],data:()=>({options:[],selectedOption:[],errors:null}),created(){this.loadDropdown()},props:{allowedStg:{type:Array,default:null},isAdmin:!1},methods:{loadDropdown(){this.$api.call(L.getStudiengaenge(this.allowedStg)).then(t=>{if("success"!==t.meta.status)return;const e=t.data.retval??[];this.allowedStg?this.options=e.filter(t=>this.allowedStg.includes(String(t.studiengang_kz))):this.options=e,this.$entryParams.studiengaengeAdmin=t.data.retval.map(t=>t.studiengang_kz)})},sgChanged(t){this.$emit("sgChanged",t)},getOptionLabel:t=>t.kurzbzlang+" "+t.bezeichnung},template:'\n\t\t<div class="col-12">\n\t\t\t<Dropdown @change="sgChanged" :placeholder="$p.t(\'lehre/studiengang\')" :style="{\'width\': \'100%\'}" :optionLabel="getOptionLabel" v-model="selectedOption" :options="options" showClear>\n\t\t\t\t<template #optionsgroup="slotProps">\n\t\t\t\t\t<div> {{ option.kurzbzlang }} {{ option.bezeichnung }} </div>\n\t\t\t\t</template>\n\t\t\t</Dropdown>\n\t\t</div>\n\t'},Bt={name:"EntschuldigungEdit",components:{Datepicker:r,Textarea:primevue.textarea,Tristate:primevue.tristatecheckbox},emits:["validate"],data(){return{minDate:this.calcMinDate(),form:Vue.reactive({von:null,bis:null,notiz:"",akzeptiert:""})}},props:{modelValue:null},created(){},methods:{setForm(t){this.form.von=new Date(t.von),this.form.bis=new Date(t.bis),this.form.uploaddatum=new Date(t.uploaddatum),this.form.notiz=t.notiz,this.form.akzeptiert=t.akzeptiert},calcMinDate(){let t=new Date;return t.setFullYear(t.getFullYear()-1),t},formatDate:t=>`${t.getDate()}.${t.getMonth()+1}.${t.getFullYear()} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`,validate(t){if(null!==t)return t.von&&t.bis?void this.$emit("validate",!0):(this.$emit("validate",!1),!1);this.$emit("validate",!1)}},watch:{modelValue:{handler(t){this.validate(t)&&this.setForm(t)},deep:!0},form:{handler(t){this.validate(t)},deep:!0}},computed:{getStatusLabel(){return null===this.modelValue.akzeptiert?"Entschuldigung Status offen":!0===this.modelValue.akzeptiert?"Entschuldigung akzeptiert":"Entschuldigung abgelehnt"}},template:'\n\t\t<div v-if="modelValue">\n\t\t\t<div class="row">\n\t\t\t\t<p>\n\t\t\t\t\t{{ modelValue.vorname }} {{ modelValue.nachname }}\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t{{ modelValue.kurzbzlang }} {{ modelValue.bezeichnung }} {{ modelValue.studentorgform }}\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t{{$p.t(\'global/uploaddatum\')}}: {{modelValue.uploaddatum }}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-6 d-flex align-items-center">\n\t\t\t\t\t<Tristate v-model="modelValue.akzeptiert" :disabled="true"></Tristate>\n\t\t\t\t\t<span class="ms-2">{{getStatusLabel}}</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="!modelValue.dms_id" class="col-6">\n\t\t\t\t\t<span class="ms-2" style="color: red">{{$p.t(\'global/missingEntschuldigungFile\')}}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="row mt-4">\n\t\t\t\t<div class="col-6">\n\t\t\t\t\t<datepicker\n\t\t\t\t\t\tid="von"\n\t\t\t\t\t\tv-model="modelValue.von"\n\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t:disabled="modelValue.akzeptiert !== null"\n\t\t\t\t\t\t:format="formatDate"\n\t\t\t\t\t\t:enable-time-picker="true"\n\t\t\t\t\t\t:min-date="minDate"\n\t\t\t\t\t\t:start-date="minDate">\n\t\t\t\t\t</datepicker>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-6">\n\t\t\t\t\t<datepicker\n\t\t\t\t\t\tid="bis"\n\t\t\t\t\t\tv-model="modelValue.bis"\n\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t:disabled="modelValue.akzeptiert !== null"\n\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t:format="formatDate"\n\t\t\t\t\t\t:enable-time-picker="true"\n\t\t\t\t\t\t:min-date="minDate"\n\t\t\t\t\t\t:start-date="minDate">\n\t\t\t\t\t</datepicker>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="row mt-4">\n\t\t\t\t<Textarea v-model="modelValue.notiz" rows="5" maxlength="255"></Textarea>\n\t\t\t\t<p>{{ modelValue.notiz?.length ? modelValue.notiz.length : 0 }} / 255 characters</p>\n\t\t\t</div>\n\t\t\t\n\t\t</div>\n\t'};function Ht(t,e,n){let i=document.createElement("div"),a=null,s=t.getValue();if(Array.isArray(s)){const t=s[0]?new Date(s[0]):null,e=s[1]?new Date(s[1]):null;a=[t,e]}return Vue.createApp({components:{PrimevueCalendar:primevue.calendar},data:()=>({val:a}),watch:{val(t){n(t)}},template:'<primevue-calendar \n\t\t\t\t\tv-model="val" \n\t\t\t\t\tselection-mode="range" \n\t\t\t\t\t:manual-input="false" \n\t\t\t\t\tshow-button-bar \n\t\t\t\t\t:showIcon="true"\n\t\t\t\t\tdateFormat="dd.mm.yy">\n\t\t\t\t   </primevue-calendar>'}).use(primevue.config.default).mount(i),i}primevue||console.error("PrimeVue not loaded!"),Tabulator.extendModule("filter","filters",{dates:(t,e)=>{if(!t)return!0;let n=new Date(e);if(Array.isArray(t)){let e=new Date(t[0]);if(t[1]){let i=new Date(t[1]);return i.setHours(23,59,59,999),n>=e&&n<=i}return n.toDateString()===e.toDateString()}let i=new Date(t);return n.toDateString()===i.toDateString()}});var Mt={getEntschuldigungen:(t,e,n)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/AdministrationApi/getEntschuldigungen",params:{stg_kz_arr:t,von:e,bis:n}}),updateEntschuldigung:(t,e,n,i,a)=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/AdministrationApi/updateEntschuldigung",params:{entschuldigung_id:t,status:e,notiz:n,von:i,bis:a}}),getTimeline:t=>({method:"post",url:"extensions/FHC-Core-Anwesenheiten/api/AdministrationApi/getTimeline",params:{person_id:t}})};const Vt={name:"AssistenzComponent",components:{BsModal:S,CoreBaseLayout:$,CoreNavigationCmpt:w,CoreFilterCmpt:b,CoreRESTClient:mt,Datepicker:r,StudiengangDropdown:Ot,EntschuldigungEdit:Bt,AnwTimeline:Ft},data:function(){return{headerFiltersRestored:!1,filtersRestored:!1,colLayoutRestored:!1,sortRestored:!1,stateRestored:!1,selectedEntschuldigung:null,selectedEntschuldigungValid:!1,selectedAnwArray:null,selectedEntArray:null,tabulatorUuid:Vue.ref(0),headerMenuEntries:{},sideMenuEntries:{},editCellValue:"",tableData:null,zeitraum:{von:this.$formatTime(new Date(Date.now()).setDate(new Date(Date.now()).getDate()-30)),bis:this.$formatTime(new Date(Date.now()).setDate(new Date(Date.now()).getDate()+60))},permissionsLoaded:!1,tableBuiltPromise:null,assistenzViewTabulatorOptions:{ajaxURL:FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/extensions/FHC-Core-Anwesenheiten/api/AdministrationApi/getEntschuldigungen",ajaxResponse:(t,e,n)=>(this.tableData=n.data.retval,n.data.retval),ajaxConfig:"POST",ajaxContentType:{headers:{"Content-Type":"application/json"},body:()=>{const t=this.$entryParams.permissions.admin&&Array.isArray(this.$entryParams.permissions.studiengaengeAdmin)?this.$entryParams.permissions.studiengaengeAdmin:[],e=this.$entryParams.permissions.assistenz&&Array.isArray(this.$entryParams.permissions.studiengaengeAssistenz)?this.$entryParams.permissions.studiengaengeAssistenz:[],n=[...new Set([...e,...t])];return JSON.stringify({stg_kz_arr:n,von:this.zeitraum.von,bis:this.zeitraum.bis})}},debugInvalidComponentFuncs:!1,layout:"fitData",selectable:!1,placeholder:this.$p.t("global/noDataAvailable"),pagination:!0,paginationSize:50,height:this.$entryParams.tabHeights.assistenz,columns:[{title:Vue.computed(()=>this.$capitalize(this.$p.t("person/vorname"))),field:"vorname",headerFilter:!0,headerSort:!0,tooltip:!1},{title:Vue.computed(()=>this.$capitalize(this.$p.t("person/nachname"))),field:"nachname",headerFilter:!0,headerSort:!0,tooltip:!1},{title:Vue.computed(()=>this.$capitalize(this.$p.t("lehre/ausbildungssemester"))),field:"semester",headerFilter:!0,headerSort:!0,tooltip:!1},{title:Vue.computed(()=>this.$capitalize(this.$p.t("global/status"))),field:"akzeptiert",headerFilter:"list",headerFilterParams:{values:{true:"Akzeptiert",false:"Abgelehnt",null:"Offen","":"Alle"}},headerFilterFunc:this.akzeptiertFilterFunc,formatter:this.entschuldigungstatusFormatter,tooltip:!1,headerSort:!0},{title:Vue.computed(()=>this.$capitalize(this.$p.t("global/file"))),headerSort:!0,field:"dms_id",formatter:_.formFile},{title:Vue.computed(()=>this.$capitalize(this.$p.t("ui/von"))),headerSort:!0,field:"von",formatter:_.formDate,headerFilterFunc:"dates",headerFilter:Ht},{title:Vue.computed(()=>this.$capitalize(this.$p.t("global/bis"))),headerSort:!0,field:"bis",formatter:_.formDate,headerFilterFunc:"dates",headerFilter:Ht},{title:Vue.computed(()=>this.$capitalize(this.$p.t("global/antragsdatum"))),headerSort:!0,field:"entuploaddatum",formatter:_.formDate,headerFilterFunc:"dates",headerFilter:Ht},{title:Vue.computed(()=>this.$capitalize(this.$p.t("global/fileuploaddatum"))),headerSort:!0,field:"fileuploaddatum",formatter:_.formDate,headerFilterFunc:"dates",headerFilter:Ht},{title:Vue.computed(()=>this.$capitalize(this.$p.t("lehre/organisationsform"))),headerSort:!0,field:"studentorgform",headerFilter:!0,tooltip:!1},{title:Vue.computed(()=>this.$capitalize(this.$p.t("lehre/studiengang"))),headerSort:!0,field:"studiengang_kz",formatter:_.formStudiengangKz,tooltip:!1},{title:Vue.computed(()=>this.$capitalize(this.$p.t("ui/aktion"))),headerSort:!0,field:"entschuldigung_id",formatter:this.formAction,tooltip:!1,minWidth:260},{title:Vue.computed(()=>this.$capitalize(this.$p.t("global/begruendungAnw"))),headerSort:!0,field:"notiz",editor:"input",headerFilter:!0,tooltip:!1,maxWidth:300}],persistence:!1,persistenceID:this.$entryParams.patchdate+"-assistenzTable"},assistenzViewTabulatorEventHandlers:[{event:"cellEditing",handler:t=>{this.editCellValue=t.getData().notiz}},{event:"cellEdited",handler:t=>{const e=t.getData();(""!==e.notiz&&null!==e.notiz||""!==this.editCellValue&&null!==this.editCellValue)&&this.$api.call(Mt.updateEntschuldigung(String(e.entschuldigung_id),e.akzeptiert,e.notiz)).then(t=>{"success"===t.meta.status&&this.$fhcAlert.alertSuccess(this.$p.t("ui/gespeichert"))})}},{event:"tableBuilt",handler:async()=>{await this.$entryParams.phrasenPromise,this.tableBuiltResolve()}},{event:"cellClick",handler:async(t,e)=>{if("dms_id"===e.getColumn().getField()){const t=e.getValue();"-"!==t&&null!==t&&this.downloadEntschuldigung(t)}t.stopPropagation()}}],notiz:"",studiengang:null,titleText:""}},props:{permissions:[]},methods:{formatForSql(t){if("string"==typeof t)return t;if(t instanceof Date){const e=t=>String(t).padStart(2,"0");return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())}},saveEditEntschuldigung(){this.selectedEntschuldigung&&(this.selectedEntschuldigung.von=this.formatForSql(this.selectedEntschuldigung.von),this.selectedEntschuldigung.bis=this.formatForSql(this.selectedEntschuldigung.bis),this.$api.call(Mt.updateEntschuldigung(String(this.selectedEntschuldigung.entschuldigung_id),this.selectedEntschuldigung.akzeptiert,this.selectedEntschuldigung.notiz,this.selectedEntschuldigung.von,this.selectedEntschuldigung.bis)).then(t=>{"success"===t.meta.status&&(this.$fhcAlert.alertSuccess(this.$p.t("ui/gespeichert")),Object.keys(this.selectedEntschuldigung).forEach(t=>{this.selectedEntschuldigungCellRef[t]=this.selectedEntschuldigung[t]}),this.$refs.assistenzTable.tabulator.redraw(!0))}).finally(()=>{this.$refs.modalContainerEditEntschuldigung.hide(),this.selectedEntschuldigung=null,this.selectedEntschuldigungCellRef=null}))},cancelEdit(){this.$refs.modalContainerEditEntschuldigung.hide(),this.selectedEntschuldigung=null,this.selectedEntschuldigungCellRef=null},openEditEntschuldigungModal(t){this.selectedEntschuldigungCellRef=t,this.selectedEntschuldigung={...t},this.$refs.modalContainerEditEntschuldigung.show()},closeTimelineModal(){this.selectedAnwArray=null,this.selectedEntArray=null,this.$refs.modalContainerTimeline.hide()},openTimelineModal(t){this.selectedEntschuldigungCellRef=t,this.selectedEntschuldigung={...t},this.$api.call(Mt.getTimeline(this.selectedEntschuldigung.person_id)).then(t=>{this.selectedAnwArray=t.data[0].retval,this.selectedEntArray=t.data[1].retval}),this.$refs.modalContainerTimeline.show()},akzeptiertFilterFunc:(t,e)=>"null"===t?null===e:"true"===t?!0===e:"false"===t?!1===e:void 0,entschuldigungstatusFormatter(t){let e=t.getValue();return null==e?(t.getElement().style.color="#17a2b8",this.$p.t("global/offen")):!0===e?(t.getElement().style.color="#28a745",this.$p.t("global/akzeptiert")):!1===e?(t.getElement().style.color="#dc3545",this.$p.t("global/abgelehnt")):void 0},updateEntschuldigung:function(t,e,n=""){const i=t.getData().entschuldigung_id,a=t.getData().notiz,s=""!==n?n:null!=a?a:"";this.$api.call(Mt.updateEntschuldigung(String(i),e,s)).then(n=>{"success"===n.meta.status&&(t.getRow().update({akzeptiert:e,notiz:s}),this.$fhcAlert.alertSuccess(this.$p.t("ui/gespeichert")))})},downloadEntschuldigung:function(t){window.location=mt._generateRouterURI("extensions/FHC-Core-Anwesenheiten/Profil/getEntschuldigungFile?entschuldigung="+t)},formAction:function(t){let e=document.createElement("div");e.className="d-flex gap-3";const n="40px",i=t.getData();let a=null;return i.dms_id&&(a=document.createElement("button"),a.className="btn btn-outline-secondary",a.style.minWidth=n,a.innerHTML='<i class="fa fa-download"></i>',a.addEventListener("click",()=>this.downloadEntschuldigung(t.getData().dms_id)),a.title=this.$p.t("table/download"),e.append(a)),a=document.createElement("button"),a.className="btn btn-outline-secondary",a.style.minWidth=n,a.innerHTML='<i class="fa fa-pen-to-square"></i>',a.addEventListener("click",()=>this.openEditEntschuldigungModal(t.getData())),a.title=this.$p.t("global/entschuldigungEditieren"),e.append(a),a=document.createElement("button"),a.className="btn btn-outline-secondary",a.style.minWidth=n,a.innerHTML='<i class="fa fa-timeline"></i>',a.addEventListener("click",()=>this.openTimelineModal(t.getData())),a.title=this.$p.t("global/anwTimeline"),e.append(a),i.dms_id&&(a=document.createElement("button"),a.className="btn btn-outline-secondary",a.style.minWidth=n,a.innerHTML='<i class="fa fa-check"></i>',a.title=this.$p.t("global/entschuldigungAkzeptieren"),a.addEventListener("click",()=>this.updateEntschuldigung(t,!0)),e.append(a)),a=document.createElement("button"),a.className="btn btn-outline-secondary",a.style.minWidth=n,a.innerHTML='<i class="fa fa-xmark"></i>',a.title=this.$p.t("global/entschuldigungAblehnen"),a.addEventListener("click",()=>this.openRejectionModal(t)),e.append(a),e},bisFilter:function(t,e){return new Date(t.bis).getTime()<=new Date(e.bis).getTime()},vonFilter:function(t,e){return new Date(t.von).getTime()>=new Date(e.von).getTime()},studiengangFilter:function(t,e){return t.studiengang_kz===Number(e.studiengang)},filtern:function(){this.$refs.assistenzTable.tabulator.clearFilter(),this.studiengang&&this.$refs.assistenzTable.tabulator.addFilter(this.studiengangFilter,{studiengang:this.studiengang})},handleInputNotiz(t){this.notiz=t.target.value},rejectEntschuldigung(){this.updateEntschuldigung(this.rejectCell,!1,this.notiz),this.rejectCell=null,this.notiz="",this.$refs.modalContainerRejectionReason.hide()},openRejectionModal(t){this.rejectCell=t,this.notiz=t.getData().notiz,this.$refs.modalContainerRejectionReason.show()},sgChangedHandler:function(t){this.studiengang=t.value?t.value.studiengang_kz:null},checkEntryParamPermissions(){void 0===this.$entryParams.permissions&&(this.$entryParams.permissions=JSON.parse(this.permissions)),this.permissionsLoaded=!0,void 0===this.$entryParams.phrasenPromise&&(this.$entryParams.phrasenPromise=this.$p.loadCategory(["global","person","lehre","table","filter","ui"]))},async setup(){await this.$entryParams.phrasenPromise,await this.tableBuiltPromise},tableResolve(t){this.tableBuiltResolve=t},refetchData(){const t=this.$entryParams.permissions.assistenz?this.$entryParams.permissions.studiengaengeAssistenz:this.$entryParams.permissions.admin?this.$entryParams.permissions.studiengaengeAdmin:[];this.$api.call(Mt.getEntschuldigungen(t,this.zeitraum.von,this.zeitraum.bis)).then(t=>{this.$refs.assistenzTable.tabulator.setData(t.data.retval)})},handleUuidDefined(t){this.tabulatorUuid=t},redrawTable(){this.$refs.assistenzTable?.tabulator&&this.$refs.assistenzTable.tabulator.redraw(!0)},handleSelectedEntschuldigungValidate(t){this.selectedEntschuldigungValid=t},calculateTableHeight(){const t=this.tabulatorUuid?"-"+this.tabulatorUuid:"",e=document.getElementById("filterTableDataset"+t);if(!e)return;const n=e.getBoundingClientRect(),i=this.$entryParams.isInFrame?window.frameElement.clientHeight:window.visualViewport.height;this.$entryParams.tabHeights.assistenz.value=i-n.top},saveState(t){if(!this.stateRestored)return;const e={columns:t.getColumnLayout().map(t=>({field:t.field,visible:t.visible,width:t.width})),sort:t.getSorters().map(t=>({field:t.field,dir:t.dir})),filters:t.getFilters(),headerFilters:t.getHeaderFilters()};localStorage.setItem(this.assistenzViewTabulatorOptions.persistenceID,JSON.stringify(e))},handleTableBuilt(){const t=this.$refs.assistenzTable.tabulator;t.on("columnMoved",()=>{this.saveState(t)}),t.on("columnResized",()=>{this.saveState(t)}),t.on("columnVisibilityChanged",()=>{this.saveState(t)}),t.on("filterChanged",()=>{this.saveState(t)}),t.on("headerFilterChanged",()=>{this.saveState(t)}),t.on("dataSorted",()=>{this.saveState(t)}),t.on("columnSorted",()=>{this.saveState(t)}),t.on("sortersChanged",()=>{this.saveState(t)});const e=this.loadState();t.on("renderComplete",()=>{if(!this.stateRestored){if(e?.columns&&!this.colLayoutRestored){const n=e.columns.map(t=>({field:t.field,width:t.width,visible:t.visible}));t.setColumnLayout(n),this.colLayoutRestored=!0}if(e?.filters&&!this.filtersRestored&&(this.filtersRestored=!0,t.setFilter(e.filters)),e?.headerFilters&&!this.headerFiltersRestored){this.headerFiltersRestored=!0;for(let n of e.headerFilters)t.setHeaderFilterValue(n.field,n.value)}e?.sort?.length&&!this.sortRestored&&(this.sortRestored=!0,setTimeout(()=>{const n=e.sort.map(e=>{const n=t.columnManager.findColumn(e.field);return n?{column:n,dir:e.dir}:null}).filter(Boolean);t.setSort(n)},100)),this.stateRestored=!0}})},loadState(){return JSON.parse(localStorage.getItem(this.assistenzViewTabulatorOptions.persistenceID)||"null")}},mounted(){this.tableBuiltPromise=new Promise(this.tableResolve),this.checkEntryParamPermissions(),this.setup(),this.calculateTableHeight(),window.addEventListener("resize",this.calculateTableHeight),window.addEventListener("orientationchange",this.calculateTableHeight)},unmounted(){window.removeEventListener("resize",this.calculateTableHeight),window.removeEventListener("orientationchange",this.calculateTableHeight)},beforeMounted(){this.$entryParams?.permissions?.entschuldigungen_enabled||this.$router.back()},watch:{"zeitraum.von"(){this.refetchData()},"zeitraum.bis"(){this.refetchData()},studiengang(){this.filtern()}},computed:{getAllowedStg(){return this.$entryParams?.permissions?.assistenz?this.$entryParams?.permissions?.studiengaengeAssistenz:this.$entryParams?.permissions?.admin?this.$entryParams?.permissions?.studiengaengeAdmin:[]},getTooltipObj(){return{value:this.$p.t("global/tooltipAssistenzV2"),class:"custom-tooltip"}},getTooltipVonDatum(){return{value:this.$p.t("global/tooltipAssistenzVonDatum"),class:"custom-tooltip"}},getTooltipBisDatum(){return{value:this.$p.t("global/tooltipAssistenzBisDatum"),class:"custom-tooltip"}}},template:'\n\n\t<core-base-layout>\n\t\t<template #main>\n\t\t\t<bs-modal ref="modalContainerRejectionReason" class="bootstrap-prompt" dialogClass="modal-lg">\n\t\t\t\t<template v-slot:title>{{ $p.t(\'global/entschuldigungNotizAblehnen\') }}</template>\n\t\t\t\t<template v-slot:default>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class="mt-2">\n\t\t\t\t\t\t\t<input maxlength=255 class="form-control" :value="notiz" @input="handleInputNotiz" :placeholder="$p.t(\'global/begruendungAnw\')">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:footer>\n\t\t\t\t\t<button type="button" class="btn btn-primary" :disabled="!notiz" @click="rejectEntschuldigung">{{ $p.t(\'global/reject\') }}</button>\n\t\t\t\t</template>\n\t\t\t</bs-modal>\n\n\n\t\t\t<bs-modal ref="modalContainerTimeline" class="bootstrap-prompt" bodyClass="px-4 py-0" dialogClass="modal-dialog modal-fullscreen">\n\t\t\t\t<template v-slot:title>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{{ $p.t(\'global/anwTimeline\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:default>\n\t\t\t\t\t\n\t\t\t\t\t<AnwTimeline v-model="selectedEntschuldigung" :anwArray="selectedAnwArray" :entArray="selectedEntArray"></AnwTimeline>\n\t\t\t\t\t\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:footer>\n\t\t\t\t\t<button type="button" class="btn btn-outline-secondary " @click="closeTimelineModal">{{$p.t(\'ui\',\'cancel\')}}</button>    \n\t\t\t\t</template>\n\t\t\t</bs-modal>\t\n\n\t\t\t<bs-modal ref="modalContainerEditEntschuldigung" class="bootstrap-prompt" dialogClass="modal-lg">\n\t\t\t\t<template v-slot:title>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{{ $p.t(\'global/entschuldigungEdit\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:default>\n\t\t\t\t\t\n\t\t\t\t\t<EntschuldigungEdit v-model="selectedEntschuldigung" @validate="handleSelectedEntschuldigungValidate"></EntschuldigungEdit>\n\t\t\t\t\t\n\t\t\t\t</template>\n\t\t\t\t<template v-slot:footer>\n\t\t\t\t\t<button type="button" class="btn btn-outline-secondary " @click="cancelEdit">{{$p.t(\'ui\',\'cancel\')}}</button>    \n\t\t\t\t\t<button type="button" class="btn btn-primary" :disabled="!selectedEntschuldigungValid" @click="saveEditEntschuldigung">{{ $p.t(\'ui\', \'speichern\') }}</button>\n\t\t\t\t</template>\n\t\t\t</bs-modal>\t\n\n\t\t\t<div class="row">\n\t\t\t\n\t\t\t\t<div class="col-6" style="display: flex; align-items: center;">\n\t\t\t\t\t<h1 class="h4 mb-5" style="margin-right: 10px;">{{ $p.t(\'global/entschuldigungsmanagement\') }}</h1>\n\t\t\t\t\t<div style="max-width: 25%; align-self: normal;" v-tooltip.bottom="getTooltipObj">\n\t\t\t\t\t\t<h4 style="margin: 0;"><i class="fa fa-circle-question"></i></h4>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t<div class="col-2">\n\t\t\t\t\t<div class="row mb-3 align-items-center">\n\t\t\t\t\t\t<StudiengangDropdown\n\t\t\t\t\t\t\t:allowedStg="getAllowedStg" @sgChanged="sgChangedHandler">\n\t\t\t\t\t\t</StudiengangDropdown>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-2">\n\t\t\t\t\t<div class="row mb-3 align-items-center">\n\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\tv-model="zeitraum.von"\n\t\t\t\t\t\t\t:placeholder="$capitalize($p.t(\'ui/von\'))"\n\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t\t:enable-time-picker="false"\n\t\t\t\t\t\t\tformat="dd.MM.yyyy"\n\t\t\t\t\t\t\tmodel-type="yyyy-MM-dd"\n\t\t\t\t\t\t></datepicker>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-2">\n\t\t\t\t\t<div class="row mb-3 align-items-center">\n\t\t\t\t\t\t<datepicker\n\t\t\t\t\t\t\tv-model="zeitraum.bis"\n\t\t\t\t\t\t\t:placeholder="$capitalize($p.t(\'global/bis\'))"\n\t\t\t\t\t\t\t:clearable="false"\n\t\t\t\t\t\t\tauto-apply\n\t\t\t\t\t\t\t:enable-time-picker="false"\n\t\t\t\t\t\t\tformat="dd.MM.yyyy"\n\t\t\t\t\t\t\tmodel-type="yyyy-MM-dd"\n\t\t\t\t\t\t></datepicker>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<core-filter-cmpt\n\t\t\t\tref="assistenzTable"\n\t\t\t\t@uuidDefined="handleUuidDefined"\n\t\t\t\t:tabulator-options="assistenzViewTabulatorOptions"\n\t\t\t\t:tabulator-events="assistenzViewTabulatorEventHandlers"\n\t\t\t\t@tableBuilt="handleTableBuilt"\n\t\t\t\t:sideMenu="false"\n\t\t\t\t:table-only="true"\n\t\t\t></core-filter-cmpt>\n\t\t</template>\n\t</core-base-layout>\n'};var It={name:"LandingPageComponent",components:{CoreBaseLayout:$,CoreRESTClient:mt,CoreTabs:kt,BsModal:S,StudentComponent:xt,LektorComponent:O,AssistenzComponent:Vt},data:function(){return{headerMenuEntries:{},sideMenuEntries:{},currentTab:0,tabs:this.initTabs(),loaded:!1,phrasenResolved:!1,permissioncount:Vue.ref(0),anwKontrolleMinDate:null,anwKontrolleMaxDate:null}},provide(){return{minDate:Vue.computed(()=>this.anwKontrolleMinDate?this.anwKontrolleMinDate:null),maxDate:Vue.computed(()=>this.anwKontrolleMaxDate?this.anwKontrolleMaxDate:null)}},props:{permissions:{default:"",type:String},activetabstudent:null},methods:{initTabs(){const t=[],e=JSON.parse(this.permissions);this.$entryParams.activetabstudent=this.activetabstudent??null;const n=window.location.search,i=new URLSearchParams(n),a=i.get("lvid"),s=i.get("stg_kz"),r=i.get("sem_kurzbz"),l=a&&s&&r||this.$entryParams.notMissingParams;function o(t){return t?t[0].toUpperCase()+t.slice(1):""}if((e.lektor||e.admin)&&l){const e=Vue.computed(()=>this.phrasenResolved?o(this.$p.t("global/kontrolle")):"K");t.push({key:"Kontrolle",title:e,component:"../../extensions/FHC-Core-Anwesenheiten/js/components/Lektor/LektorComponent.js"})}if((e.student||e.admin)&&l){const e=Vue.computed(()=>this.phrasenResolved?o(this.$p.t("global/profil")):"P");t.push({key:"Profil",title:e,component:"../../extensions/FHC-Core-Anwesenheiten/js/components/Student/StudentComponent.js"})}if((e.admin||e.assistenz)&&e.entschuldigungen_enabled){const e=Vue.computed(()=>this.phrasenResolved?o(this.$p.t("global/admin")):"A");t.push({key:"Admin",title:e,component:"../../extensions/FHC-Core-Anwesenheiten/js/components/Assistenz/AssistenzComponent.js"})}const d={};return t.forEach((t,e)=>{d["tab"+e]=t}),this.setCurrentTab(e.controller,t),this.setDefaultTabHeight(),d},setDefaultTabHeight(){this.$entryParams.tabHeights={},this.$entryParams.tabHeights.studentByLva=Vue.ref(400),this.$entryParams.tabHeights.lektor=Vue.ref(400),this.$entryParams.tabHeights.studentAnw=Vue.ref(400),this.$entryParams.tabHeights.studentEnt=Vue.ref(400),this.$entryParams.tabHeights.assistenz=Vue.ref(400)},setCurrentTab(t,e){switch(t){case"Admin":this.currentTab=e.findIndex(t=>"Admin"===t.key);break;case"Kontrolle":this.currentTab=e.findIndex(t=>"Kontrolle"===t.key);break;case"Profil":this.currentTab=e.findIndex(t=>"Profil"===t.key);break;default:this.currentTab=0}},async createdSetup(){await new Promise(t=>{const e=window.location.search,n=new URLSearchParams(e);this.$entryParams.lv_id=n.get("lvid"),this.$entryParams.stg_kz=n.get("stg_kz"),this.$entryParams.sem_kurzbz=n.get("sem_kurzbz"),this.$entryParams.sem=n.get("sem"),this.$entryParams.handleLeSetup=this.handleLeSetup,this.$entryParams.findClosestTermin=this.findClosestTermin,this.$entryParams.notMissingParams=!!(this.$entryParams.lv_id&&this.$entryParams.stg_kz&&this.$entryParams.sem_kurzbz),this.setupViewDataRefs(),this.$entryParams.lv_id&&this.loadLvViewData(),this.$entryParams.phrasenPromise=this.$p.loadCategory(["ui","person","lehre","table","filter","global"]),this.$entryParams.phrasenPromise.then(()=>{this.phrasenResolved=!0});const i=document.getElementById("main");this.$entryParams.permissions=JSON.parse(i.attributes.permissions.nodeValue),this.$entryParams.cis4=JSON.parse(i.attributes.cis4.nodeValue),this.anwKontrolleMinDate=new Date(Date.now()).setDate(new Date(Date.now()).getDate()-this.$entryParams.permissions.kontrolleCreateMaxReachPast),this.anwKontrolleMaxDate=new Date(Date.now()).setDate(new Date(Date.now()).getDate()+this.$entryParams.permissions.kontrolleCreateMaxReachFuture),i.removeAttribute("permissions"),t()})},setupViewDataRefs(){this.$entryParams.viewDataLv={},this.$entryParams.viewDataLv.benotung=Vue.ref(""),this.$entryParams.viewDataLv.bezeichnung=Vue.ref(""),this.$entryParams.viewDataLv.kurzbz=Vue.ref(""),this.$entryParams.viewDataLv.lehrveranstaltung_id=Vue.ref(""),this.$entryParams.viewDataLv.oe_kurzbz=Vue.ref(""),this.$entryParams.viewDataLv.orgform_kurzbz=Vue.ref(""),this.$entryParams.viewDataLv.raumtyp_kurzbz=Vue.ref(""),this.$entryParams.viewDataStudent={},this.$entryParams.viewDataStudent.vorname=Vue.ref(""),this.$entryParams.viewDataStudent.nachname=Vue.ref(""),this.$entryParams.viewDataStudent.uid=Vue.ref(""),this.$entryParams.viewDataStudent.person_id=Vue.ref(""),this.$entryParams.viewDataStudent.prestudent_id=Vue.ref(""),this.$entryParams.viewDataStudent.gruppe=Vue.ref(""),this.$entryParams.viewDataStudent.verband=Vue.ref(""),this.$entryParams.viewDataStudent.semester=Vue.ref("")},loadLvViewData(){this.$api.call(L.getLvViewDataInfo(this.$entryParams.lv_id)).then(t=>{t?.data?.retval?.[0]&&this.setLvViewData(t.data.retval[0])})},async handleSetup(){if(!this.$entryParams.setupPromise)return new Promise(t=>{const e=this.$entryParams.permissions.authID,n=this.$entryParams.sem_kurzbz,i=this.$entryParams.lv_id,a=[],s=[];if(this.$entryParams.permissions.admin&&i&&n&&a){this.handleMaSetup(i,n,e).then(()=>{s.push(this.handleLeSetup(i,this.$entryParams.selected_maUID.value?.mitarbeiter_uid,n,a)),s.push(this.handleStudentsSetup(i,n)),Promise.all(s).then(()=>{t()})})}else this.$entryParams.permissions.lektor&&i&&n&&a?this.handleLeSetup(i,e,n,a).finally(()=>{t(!0)}):t(!0)})},handleStudentsSetup(t,e){return new Promise(n=>{this.$api.call(L.getStudentsForLvaInSemester(t,e)).then(t=>{this.$entryParams.availableStudents=[],t?.data?.retval?.forEach(t=>{const e=t.semester+t.verband+t.gruppe+" "+t.vorname+" "+t.nachname;this.$entryParams.availableStudents.push({vorname:t.vorname,nachname:t.nachname,prestudent_id:t.prestudent_id,studiensemester_kurzbz:t.studiensemester_kurzbz,lehreinheit_id:t.lehreinheit_id,lehrveranstaltung_id:t.lehrveranstaltung_id,semester:t.semester,verband:t.verband,gruppe:t.gruppe,uid:t.uid,person_id:t.person_id,infoString:e})}),this.$entryParams.selected_student_info=this.$entryParams.availableStudents.length?this.$entryParams.availableStudents[0]:null}).finally(()=>{n()})})},handleMaSetup(t,e,n){return new Promise(i=>{this.$api.call(L.getLektorsForLvaInSemester(t,e)).then(t=>{this.$entryParams.available_maUID.value.splice(0,this.$entryParams.available_maUID.value.length);const e=t.data?.retval?.find(t=>t.mitarbeiter_uid===n),i=e??t.data.retval[0],a=i.anrede+" "+(i.titelpre?i.titelpre+" ":"")+i.vorname+(i.vornamen?" "+i.vornamen:"")+" "+i.nachname+(i.titelpost?" "+i.titelpost:"");this.$entryParams.selected_maUID.value=i?{mitarbeiter_uid:i.mitarbeiter_uid,infoString:a}:null,t.data?.retval?.forEach(t=>{const e=t.anrede+" "+(t.titelpre?t.titelpre+" ":"")+t.vorname+(t.vornamen?" "+t.vornamen:"")+" "+t.nachname+(t.titelpost?" "+t.titelpost:"");this.$entryParams.available_maUID.value.push({mitarbeiter_uid:t.mitarbeiter_uid,infoString:e})})}).finally(()=>{i()})})},handleLeSetup(t,e,n,i){return new Promise(a=>{this.$api.call(x.getLehreinheitenForLehrveranstaltungAndMaUid(t,e,n)).then(t=>{const e=[];t.data[1]&&Object.keys(t.data[1]).forEach(e=>{const n=t.data[1][e];n&&n.length&&n.forEach(t=>t.le_id=e)}),this.$entryParams.allLeTermine=t.data[1]??[],t.data[0].forEach(t=>{const n=e.find(e=>e.lehreinheit_id===t.lehreinheit_id);n?(n.infoString+=", ",null!==t.gruppe_kurzbz&&0==t.direktinskription?n.infoString+=t.gruppe_kurzbz:n.infoString+=t.kurzbzlang+"-"+t.semester+(t.verband?t.verband:"")+(t.gruppe?t.gruppe:"")):(t.infoString=t.kurzbz+" - "+t.lehrform_kurzbz+" - ",null!==t.gruppe_kurzbz&&0==t.direktinskription?t.infoString+=t.gruppe_kurzbz:t.infoString+=t.kurzbzlang+"-"+t.semester+(t.verband?t.verband:"")+(t.gruppe?t.gruppe:""),e.push(t))}),t.data[0].forEach(t=>{t.csvInfoString=t.infoString,t.infoString+=" | 👥"+t.studentcount+" | 📅"+t.termincount}),this.$entryParams.selected_le_info.value=this.$entryParams.selected_le_info.value??e.length?this.findLeWithClosestTermin(e,this.$entryParams.allLeTermine):null,this.$entryParams.available_le_info.value=[...e],e.forEach(t=>i.push(t.lehreinheit_id)),this.$entryParams.selected_le_id.value=this.$entryParams.selected_le_info.value?this.$entryParams.selected_le_info.value.lehreinheit_id:null,this.$entryParams.available_le_ids.value=[...i]}).finally(()=>{a()})})},setLvViewData(t){this.$entryParams.viewDataLv.benotung=t.benotung,this.$entryParams.viewDataLv.bezeichnung=t.bezeichnung,this.$entryParams.viewDataLv.kurzbz=t.kurzbz,this.$entryParams.viewDataLv.lehrveranstaltung_id=t.lehrveranstaltung_id,this.$entryParams.viewDataLv.oe_kurzbz=t.oe_kurzbz,this.$entryParams.viewDataLv.orgform_kurzbz=t.orgform_kurzbz,this.$entryParams.viewDataLv.raumtyp_kurzbz=t.raumtyp_kurzbz},handleTabChanged(t){this.$refs.tabsMain?._?.refs?.current&&this.$refs.tabsMain._.refs.current.redrawTable()},findLeWithClosestTermin(t,e){const n=Object.values(e).filter(Array.isArray).flat();if(n&&n.length){const e=this.findClosestTermin(n);if(!e)return this.$fhcAlert.alertWarning(this.$p.t("global/noLePreselectTermineTooOld")),t[0];return t.find(t=>t.lehreinheit_id==e.le_id)}return t&&t.length?t[0]:null},findClosestTermin(t){const e=new Date(Date.now()).getTime();return t.forEach(t=>{t.timeDiff=Math.abs(new Date(t.datum).getTime()-e),t.time=new Date(t.datum).getTime()}),t.reduce((t,e)=>e.timeDiff<t.timeDiff?e:t,t[0])}},created(){this.$entryParams.permissions||this.createdSetup()},mounted(){this.$entryParams.setupPromise=this.handleSetup().then(()=>{this.loaded=!0,this.$entryParams.phrasenPromise.then(()=>this.phrasenResolved=!0)}),this.$entryParams.permissions.lektor&&this.permissioncount++,this.$entryParams.permissions.student&&this.permissioncount++,this.$entryParams.permissions.assistenz&&(this.permissioncount=3),this.$entryParams.permissions.admin&&(this.permissioncount=3)},computed:{getSubtitle(){return this.$entryParams?.viewDataLv?.kurzbz?.value&&this.$entryParams?.viewDataLv?.bezeichnung?.value?this.$entryParams.viewDataLv.kurzbz.value+" - "+this.$entryParams.viewDataLv.bezeichnung.value:""},getCurrentTab(){return"tab"+this.currentTab}},template:'\n\n\t<div style="position: relative;" ref="appContainer">\n\n\t\t<div v-if="$entryParams.permissions.show_guide" style="position: absolute; top: 10px; right: 10px; z-index: 1000;">\n\t\t\t<a :href="$entryParams.permissions.guide_link" target="_blank" class="ms-auto mb-2">\n\t\t\t\tWiki <i class="fa fa-arrow-up-right-from-square me-1"></i>\n\t\t\t</a>\n\t\t</div>\n\t\n\t\t<template  v-if="permissioncount > 1 && phrasenResolved">\n\t\t\t<core-tabs :default="getCurrentTab" :modelValue="currentTab" :config="tabs" @changed="handleTabChanged" ref="tabsMain"></core-tabs>\n\t\t</template>\n\t\t<template v-else-if="permissioncount === 1 && phrasenResolved">\n\t\t\t<LektorComponent v-if="$entryParams?.permissions?.lektor"></LektorComponent>\n\t\t\t<StudentComponent v-if="$entryParams?.permissions?.student"></StudentComponent>\n\t\t\t<AssistenzComponent v-if="$entryParams?.permissions?.assistenz || $entryParams?.permissions?.admin"></AssistenzComponent>\n\t\t</template>\n\t</div>\n\n'};const jt=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router,Ut=VueRouter.createRouter({history:VueRouter.createWebHistory(`/${jt}/extensions/FHC-Core-Anwesenheiten/`),routes:[{path:"/Administration",name:"Administration",component:It},{path:"/Profil/Scan/:zugangscode?",name:"Scan",component:Rt,props:!0},{path:"/Profil/Entschuldigung",name:"Profil",component:It,props:{activetabstudent:"entschuldigungen"}},{path:"/",name:"LandingPage",component:It},{path:"/:catchAll(.*)",redirect:{name:"LandingPage"},props:!0}]}),Nt=Vue.createApp({components:{LektorComponent:O,StudentByLvaComponent:R,StudentComponent:xt,StudentAnwesenheitComponent:Et,StudentEntschuldigungComponent:Lt},data:()=>({title:"AnwesenheitApp"}),props:{},methods:{},created(){}});Nt.config.globalProperties.$entryParams={patchdate:"2025-09-11",isInFrame:!!window.frameElement,isMobile:Math.min(window.screen.width,window.screen.height)<768||navigator.userAgent.indexOf("Mobi")>-1,available_le_ids:Vue.ref([]),available_le_info:Vue.ref([]),selected_le_id:Vue.ref(),selected_le_info:Vue.ref(),available_maUID:Vue.ref([]),selected_maUID:Vue.ref(),available_termine:Vue.ref(),selected_termin:Vue.ref()},Nt.config.globalProperties.$capitalize=t=>t?t[0].toUpperCase()+t.slice(1):"",Nt.config.globalProperties.$formatTime=(t,e="-",n="YYYY-MM-DD")=>{const i=new Date(t);switch(n){case"YYYY-MM-DD":return i.getFullYear()+e+String(i.getMonth()+1).padStart(2,"0")+e+String(i.getDate()).padStart(2,"0");case"DD-MM-YYYY":return String(i.getDate()).padStart(2,"0")+e+String(i.getMonth()+1).padStart(2,"0")+e+i.getFullYear()}},Nt.use(Ut),Nt.use(primevue.config.default,{zIndex:{overlay:9e3,tooltip:8e3}}),Nt.use(Ct),Nt.directive("tooltip",{mounted(t){const e=function(t){return primevue.utils.DomHandler.hasClass(t,"p-inputwrapper")?primevue.utils.DomHandler.findSingle(t,"input"):t}(t);e.$_ptooltipZIndex??=Nt.config.globalProperties.$primevue.config.zIndex.tooltip},...primevue.tooltip}),Nt.mount("#main");
//# sourceMappingURL=AnwesenheitApp.js.map
